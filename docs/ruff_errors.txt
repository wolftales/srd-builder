
0s
Run ruff check .
PLR2004 Magic value used in comparison, consider replacing `300` with a constant variable
  --> scripts/analyze_reference.py:32:20
   |
31 |         # Monsters section starts around page 300
32 |         if page >= 300 and entry_type in ("h1", "h2", "h3", "h4"):
   |                    ^^^
33 |             # Extract text from subelements
34 |             text = ""
   |

PLC0415 `import` should be at the top-level of a file
  --> scripts/bump_version.py:56:5
   |
54 |     # Import after version update
55 |     sys.path.insert(0, str(Path.cwd() / "src"))
56 |     from srd_builder import __version__
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
57 |     from srd_builder.constants import SCHEMA_VERSION
58 |     from srd_builder.parse_equipment import parse_equipment_records
   |

PLC0415 `import` should be at the top-level of a file
  --> scripts/bump_version.py:57:5
   |
55 |     sys.path.insert(0, str(Path.cwd() / "src"))
56 |     from srd_builder import __version__
57 |     from srd_builder.constants import SCHEMA_VERSION
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
58 |     from srd_builder.parse_equipment import parse_equipment_records
59 |     from srd_builder.parse_monsters import parse_monster_records
   |

PLC0415 `import` should be at the top-level of a file
  --> scripts/bump_version.py:58:5
   |
56 |     from srd_builder import __version__
57 |     from srd_builder.constants import SCHEMA_VERSION
58 |     from srd_builder.parse_equipment import parse_equipment_records
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
59 |     from srd_builder.parse_monsters import parse_monster_records
60 |     from srd_builder.parse_spells import parse_spell_records
   |

PLC0415 `import` should be at the top-level of a file
  --> scripts/bump_version.py:59:5
   |
57 |     from srd_builder.constants import SCHEMA_VERSION
58 |     from srd_builder.parse_equipment import parse_equipment_records
59 |     from srd_builder.parse_monsters import parse_monster_records
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
60 |     from srd_builder.parse_spells import parse_spell_records
61 |     from srd_builder.postprocess import (
   |

PLC0415 `import` should be at the top-level of a file
  --> scripts/bump_version.py:60:5
   |
58 |     from srd_builder.parse_equipment import parse_equipment_records
59 |     from srd_builder.parse_monsters import parse_monster_records
60 |     from srd_builder.parse_spells import parse_spell_records
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
61 |     from srd_builder.postprocess import (
62 |         clean_equipment_record,
   |

PLC0415 `import` should be at the top-level of a file
  --> scripts/bump_version.py:61:5
   |
59 |       from srd_builder.parse_monsters import parse_monster_records
60 |       from srd_builder.parse_spells import parse_spell_records
61 | /     from srd_builder.postprocess import (
62 | |         clean_equipment_record,
63 | |         clean_monster_record,
64 | |         clean_spell_record,
65 | |     )
   | |_____^
66 |
67 |       fixtures = [
   |

PLR0912 Too many branches (25 > 12)
  --> scripts/compare_with_blackmoor.py:11:5
   |
11 | def main() -> None:  # noqa: C901
   |     ^^^^
12 |     """Run comparison analysis."""
13 |     ours_path = Path("dist/srd_5_1/data/monsters.json")
   |

PLR0915 Too many statements (132 > 50)
  --> scripts/compare_with_blackmoor.py:11:5
   |
11 | def main() -> None:  # noqa: C901
   |     ^^^^
12 |     """Run comparison analysis."""
13 |     ours_path = Path("dist/srd_5_1/data/monsters.json")
   |

PLR2004 Magic value used in comparison, consider replacing `20` with a constant variable
  --> scripts/compare_with_blackmoor.py:64:32
   |
62 |         for name in sorted(only_in_ours)[:20]:
63 |             print(f"  + {name}")
64 |         if len(only_in_ours) > 20:
   |                                ^^
65 |             print(f"  ... and {len(only_in_ours) - 20} more")
   |

PLR2004 Magic value used in comparison, consider replacing `11.5` with a constant variable
  --> scripts/count_monsters_in_pdf.py:46:35
   |
44 |                         # We look for 12pt, Bold, and reasonable text
45 |                         is_bold = (flags & 2**4) != 0  # Bold flag
46 |                         is_12pt = 11.5 <= size <= 12.5
   |                                   ^^^^
47 |                         is_calibri = "Calibri" in font
   |

PLR2004 Magic value used in comparison, consider replacing `12.5` with a constant variable
  --> scripts/count_monsters_in_pdf.py:46:51
   |
44 |                         # We look for 12pt, Bold, and reasonable text
45 |                         is_bold = (flags & 2**4) != 0  # Bold flag
46 |                         is_12pt = 11.5 <= size <= 12.5
   |                                                   ^^^^
47 |                         is_calibri = "Calibri" in font
   |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
  --> scripts/count_monsters_in_pdf.py:51:41
   |
49 |                         # Filter: reasonable monster name length and structure
50 |                         is_reasonable_name = (
51 |                             len(text) > 2
   |                                         ^
52 |                             and len(text) < 80
53 |                             and text[0].isupper()
   |

PLR2004 Magic value used in comparison, consider replacing `80` with a constant variable
  --> scripts/count_monsters_in_pdf.py:52:45
   |
50 |                         is_reasonable_name = (
51 |                             len(text) > 2
52 |                             and len(text) < 80
   |                                             ^^
53 |                             and text[0].isupper()
54 |                             and not text.endswith(":")
   |

PLR0915 Too many statements (55 > 50)
  --> scripts/count_monsters_in_pdf.py:66:5
   |
66 | def main() -> None:  # noqa: C901
   |     ^^^^
67 |     """Main entry point."""
68 |     print("=" * 80)
   |

PLR2004 Magic value used in comparison, consider replacing `20` with a constant variable
  --> scripts/count_monsters_in_pdf.py:94:20
   |
92 |             print(f"  • {name}")
93 |
94 |         if count > 20:
   |                    ^^
95 |             print(f"  ... and {count - 20} more")
   |

PLC0415 `import` should be at the top-level of a file
   --> scripts/count_monsters_in_pdf.py:108:5
    |
107 |     # Load our extraction
108 |     import json
    |     ^^^^^^^^^^^
109 |
110 |     our_path = Path("dist/srd_5_1/data/monsters.json")
    |

PLR0912 Too many branches (15 > 12)
  --> scripts/coverage_report.py:9:5
   |
 9 | def count_expected_from_raw(raw_path: Path) -> dict[str, int]:  # noqa: C901
   |     ^^^^^^^^^^^^^^^^^^^^^^^
10 |     """Count expected fields by analyzing raw PDF extraction."""
11 |     with open(raw_path) as f:
   |

PLR2004 Magic value used in comparison, consider replacing `10.8` with a constant variable
  --> scripts/coverage_report.py:91:62
   |
89 |         for i, block in enumerate(blocks):
90 |             text = " ".join(block.get("text", "").split()).strip()
91 |             if text == "Actions" and block.get("size", 0) >= 10.8:
   |                                                              ^^^^
92 |                 actions_idx = i
93 |                 actions_count += 1  # Monster has Actions section
   |

PLR2004 Magic value used in comparison, consider replacing `9.84` with a constant variable
   --> scripts/coverage_report.py:102:46
    |
100 |                 if (
101 |                     block.get("font") == "Calibri-BoldItalic"
102 |                     and block.get("size") == 9.84
    |                                              ^^^^
103 |                     and block.get("text", "").strip().endswith(".")
104 |                 ):
    |

PLR2004 Magic value used in comparison, consider replacing `10.8` with a constant variable
   --> scripts/coverage_report.py:117:64
    |
115 |         for block in blocks:
116 |             text = " ".join(block.get("text", "").split()).strip()
117 |             if text == "Reactions" and block.get("size", 0) >= 10.8:
    |                                                                ^^^^
118 |                 reactions_count += 1
119 |                 break
    |

PLR2004 Magic value used in comparison, consider replacing `100` with a constant variable
   --> scripts/coverage_report.py:237:23
    |
236 |         # Status indicator
237 |         if percent >= 100:
    |                       ^^^
238 |             status = "✓ Complete"
239 |         elif percent >= 90:
    |

PLR2004 Magic value used in comparison, consider replacing `90` with a constant variable
   --> scripts/coverage_report.py:239:25
    |
237 |         if percent >= 100:
238 |             status = "✓ Complete"
239 |         elif percent >= 90:
    |                         ^^
240 |             status = "✓ Excellent"
241 |         elif percent >= 75:
    |

PLR2004 Magic value used in comparison, consider replacing `75` with a constant variable
   --> scripts/coverage_report.py:241:25
    |
239 |         elif percent >= 90:
240 |             status = "✓ Excellent"
241 |         elif percent >= 75:
    |                         ^^
242 |             status = "△ Good"
243 |         elif percent >= 50:
    |

PLR2004 Magic value used in comparison, consider replacing `50` with a constant variable
   --> scripts/coverage_report.py:243:25
    |
241 |         elif percent >= 75:
242 |             status = "△ Good"
243 |         elif percent >= 50:
    |                         ^^
244 |             status = "△ Partial"
245 |         else:
    |

PLR2004 Magic value used in comparison, consider replacing `4` with a constant variable
  --> scripts/explore_pdf.py:29:66
   |
27 |                 size = span.get("size", 0.0)
28 |                 fonts[(font, round(size, 2))] += len(text)
29 |                 if not (bbox := span.get("bbox")) or len(bbox) < 4:
   |                                                                  ^
30 |                     continue
31 |                 column_edges.append(bbox[0])
   |

PLR0912 Too many branches (13 > 12)
  --> scripts/find_missing_monsters.py:49:5
   |
49 | def compare_sources() -> None:  # noqa: C901
   |     ^^^^^^^^^^^^^^^
50 |     """Compare our monsters against all available sources."""
51 |     print("=" * 80)
   |

PLR2004 Magic value used in comparison, consider replacing `20` with a constant variable
  --> scripts/find_missing_monsters.py:85:45
   |
83 |             for name in sorted(in_blackmoor_not_ours)[:20]:
84 |                 print(f"  • {name}")
85 |             if len(in_blackmoor_not_ours) > 20:
   |                                             ^^
86 |                 print(f"  ... and {len(in_blackmoor_not_ours) - 20} more")
   |

PLR2004 Magic value used in comparison, consider replacing `20` with a constant variable
  --> scripts/find_missing_monsters.py:92:45
   |
90 |             for name in sorted(in_ours_not_blackmoor)[:20]:
91 |                 print(f"  • {name}")
92 |             if len(in_ours_not_blackmoor) > 20:
   |                                             ^^
93 |                 print(f"  ... and {len(in_ours_not_blackmoor) - 20} more")
94 |     else:
   |

PLR0912 Too many branches (32 > 12)
  --> scripts/quality_report.py:11:5
   |
11 | def analyze_quality(parsed_path: Path, raw_path: Path) -> None:  # noqa: C901
   |     ^^^^^^^^^^^^^^^
12 |     """Generate quality analysis report."""
13 |     with open(parsed_path) as f:
   |

PLR0915 Too many statements (131 > 50)
  --> scripts/quality_report.py:11:5
   |
11 | def analyze_quality(parsed_path: Path, raw_path: Path) -> None:  # noqa: C901
   |     ^^^^^^^^^^^^^^^
12 |     """Generate quality analysis report."""
13 |     with open(parsed_path) as f:
   |

PLR2004 Magic value used in comparison, consider replacing `6` with a constant variable
  --> scripts/quality_report.py:76:34
   |
74 |     for count in sorted(ability_counts.keys()):
75 |         pct = (ability_counts[count] / total) * 100
76 |         status = "✅" if count == 6 else "⚠️"
   |                                   ^
77 |         print(f"{status} {count} abilities: {ability_counts[count]:3d} monsters ({pct:5.1f}%)")
78 |     print()
   |

PLR2004 Magic value used in comparison, consider replacing `5` with a constant variable
   --> scripts/quality_report.py:101:77
    |
100 |     # Check for suspiciously high counts
101 |     high_trait = [m["name"] for m in monsters if len(m.get("traits", [])) > 5]
    |                                                                             ^
102 |     high_action = [m["name"] for m in monsters if len(m.get("actions", [])) > 8]
    |

PLR2004 Magic value used in comparison, consider replacing `8` with a constant variable
   --> scripts/quality_report.py:102:79
    |
100 |     # Check for suspiciously high counts
101 |     high_trait = [m["name"] for m in monsters if len(m.get("traits", [])) > 5]
102 |     high_action = [m["name"] for m in monsters if len(m.get("actions", [])) > 8]
    |                                                                               ^
103 |
104 |     if high_trait:
    |

PLR2004 Magic value used in comparison, consider replacing `10` with a constant variable
   --> scripts/quality_report.py:151:37
    |
149 |         for trait in m.get("traits", []):
150 |             text = trait.get("text", "")
151 |             if text and len(text) < 10:
    |                                     ^^
152 |                 issues.append(f"{m['name']}: Short trait '{trait.get('name')}': {text}")
    |

PLR1722 Use `sys.exit()` instead of `exit`
   --> scripts/quality_report.py:204:9
    |
202 |     if not parsed_path.exists():
203 |         print(f"Error: {parsed_path} not found. Run build first.")
204 |         exit(1)
    |         ^^^^
205 |
206 |     analyze_quality(parsed_path, raw_path)
    |
help: Replace `exit` with `sys.exit()`

PLR0913 Too many arguments in function definition (10 > 5)
  --> src/srd_builder/build.py:85:5
   |
85 | def _generate_meta_json(
   |     ^^^^^^^^^^^^^^^^^^^
86 |     *,
87 |     pdf_hash: str | None,
   |

PLR0913 Too many arguments in function definition (8 > 5)
   --> src/srd_builder/build.py:176:5
    |
176 | def _write_datasets(
    |     ^^^^^^^^^^^^^^^
177 |     *,
178 |     ruleset: str,
    |

PLR0912 Too many branches (14 > 12)
   --> src/srd_builder/build.py:623:5
    |
623 | def build(  # noqa: C901
    |     ^^^^^
624 |     ruleset: str, output_format: str, out_dir: Path, bundle: bool = False
625 | ) -> Path:
    |

PLR0915 Too many statements (63 > 50)
   --> src/srd_builder/build.py:623:5
    |
623 | def build(  # noqa: C901
    |     ^^^^^
624 |     ruleset: str, output_format: str, out_dir: Path, bundle: bool = False
625 | ) -> Path:
    |

PLC0415 `import` should be at the top-level of a file
   --> src/srd_builder/build.py:658:9
    |
656 |     parsed_tables = None
657 |     if raw_tables:
658 |         from scripts.table_targets import TARGET_TABLES
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
659 |
660 |         targets_by_id = {t["id"]: t for t in TARGET_TABLES}
    |

PLR0912 Too many branches (16 > 12)
  --> src/srd_builder/column_mapper.py:94:9
   |
92 |         return None
93 |
94 |     def _fill_from_heuristics(self, row: list[str]) -> None:  # noqa: C901
   |         ^^^^^^^^^^^^^^^^^^^^^
95 |         """Fill unmapped columns using content heuristics.
   |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
   --> src/srd_builder/column_mapper.py:151:64
    |
150 |         # Properties/special is usually the last column
151 |         if "properties" not in self._column_map and len(row) > 2:
    |                                                                ^
152 |             # Don't map if last column looks like weight or cost
153 |             last_col = row[-1]
    |

PLR2004 Magic value used in comparison, consider replacing `10` with a constant variable
   --> src/srd_builder/column_mapper.py:170:20
    |
168 |         if self.category == "armor" and re.match(r"^\d{2}$", cell.strip()):
169 |             ac_val = int(cell.strip())
170 |             return 10 <= ac_val <= 20
    |                    ^^
171 |         return False
    |

PLR2004 Magic value used in comparison, consider replacing `20` with a constant variable
   --> src/srd_builder/column_mapper.py:170:36
    |
168 |         if self.category == "armor" and re.match(r"^\d{2}$", cell.strip()):
169 |             ac_val = int(cell.strip())
170 |             return 10 <= ac_val <= 20
    |                                    ^^
171 |         return False
    |

PLR0912 Too many branches (16 > 12)
   --> src/srd_builder/extract_equipment.py:153:5
    |
153 | def _get_section_markers(  # noqa: C901
    |     ^^^^^^^^^^^^^^^^^^^^
154 |     page: fitz.Page, page_num: int
155 | ) -> list[tuple[float, dict[str, str | None]]]:
    |

PLR2004 Magic value used in comparison, consider replacing `0.5` with a constant variable
   --> src/srd_builder/extract_equipment.py:178:54
    |
177 |                 # Section header (18pt)
178 |                 if abs(size - SECTION_HEADER_SIZE) < 0.5:
    |                                                      ^^^
179 |                     if "armor" in text:
180 |                         category = "armor"
    |

PLR2004 Magic value used in comparison, consider replacing `0.5` with a constant variable
   --> src/srd_builder/extract_equipment.py:191:59
    |
190 |                 # Subsection header (13.92pt)
191 |                 elif abs(size - SUBSECTION_HEADER_SIZE) < 0.5:
    |                                                           ^^^
192 |                     if "armor" in text:
193 |                         category = "armor"
    |

PLR0912 Too many branches (21 > 12)
   --> src/srd_builder/extract_equipment.py:207:5
    |
207 | def _detect_section_context(  # noqa: C901
    |     ^^^^^^^^^^^^^^^^^^^^^^^
208 |     page: fitz.Page, page_num: int
209 | ) -> dict[str, str | None] | None:
    |

PLR2004 Magic value used in comparison, consider replacing `0.5` with a constant variable
   --> src/srd_builder/extract_equipment.py:231:54
    |
230 |                 # Section header (18pt)
231 |                 if abs(size - SECTION_HEADER_SIZE) < 0.5:
    |                                                      ^^^
232 |                     if "armor" in text:
233 |                         category = "armor"
    |

PLR2004 Magic value used in comparison, consider replacing `0.5` with a constant variable
   --> src/srd_builder/extract_equipment.py:244:59
    |
243 |                 # Subsection header (13.92pt)
244 |                 elif abs(size - SUBSECTION_HEADER_SIZE) < 0.5:
    |                                                           ^^^
245 |                     if "armor" in text:
246 |                         # Armor subcategories also set the category
    |

PLR0911 Too many return statements (10 > 6)
   --> src/srd_builder/extract_equipment.py:272:5
    |
272 | def _is_equipment_row(row: list[str]) -> bool:  # noqa: C901
    |     ^^^^^^^^^^^^^^^^^
273 |     """Check if table row contains actual equipment (vs headers/descriptions).
    |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
   --> src/srd_builder/extract_equipment.py:282:30
    |
280 |     - Descriptive text
281 |     """
282 |     if not row or len(row) < 2:
    |                              ^
283 |         return False
    |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
   --> src/srd_builder/extract_equipment.py:315:20
    |
313 |     # Filter Food/Drink/Lodging incomplete extractions
314 |     # Single-word entries with only a price in second column are likely reference table fragments
315 |     if len(row) == 2 and len(name.split()) == 1:
    |                    ^
316 |         second_cell = row[1].strip()
317 |         # If second cell is just a price, this is likely a pricing reference, not equipment
    |

PLR2004 Magic value used in comparison, consider replacing `25` with a constant variable
   --> src/srd_builder/extract_equipment.py:346:74
    |
344 |         "ranged",
345 |     ]
346 |     if any(kw in name.lower() for kw in header_keywords) and len(name) < 25:
    |                                                                          ^^
347 |         return False
    |

PLR2004 Magic value used in comparison, consider replacing `100` with a constant variable
   --> src/srd_builder/extract_equipment.py:350:20
    |
349 |     # Skip descriptive text (usually long paragraphs)
350 |     if len(name) > 100:
    |                    ^^^
351 |         return False
    |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
   --> src/srd_builder/extract_equipment.py:364:19
    |
362 |     PyMuPDF sometimes splits names like "Longswor" + "d" → "Longsword"
363 |     """
364 |     if len(row) < 2:
    |                   ^
365 |         return row
    |

PLR2004 Magic value used in comparison, consider replacing `3` with a constant variable
   --> src/srd_builder/extract_equipment.py:371:34
    |
370 |     # If second column is very short (1-3 chars) and looks like a fragment, merge it
371 |     if second and len(second) <= 3 and second.isalpha() and not second.islower():
    |                                  ^
372 |         # Merge and remove second column
373 |         merged_name = first + second.lower()
    |

PLR2004 Magic value used in comparison, consider replacing `3` with a constant variable
   --> src/srd_builder/extract_equipment.py:377:34
    |
376 |     # If second column is very short and is lowercase, it's likely a fragment
377 |     if second and len(second) <= 3 and second.islower():
    |                                  ^
378 |         merged_name = first + second
379 |         return [merged_name] + row[2:]
    |

PLR2004 Magic value used in comparison, consider replacing `2.0` with a constant variable
   --> src/srd_builder/extract_monsters.py:265:31
    |
263 |     line_y = line["bbox"][1]  # Top Y of line
264 |     span_y = span["bbox"][1]  # Top Y of span
265 |     if abs(line_y - span_y) > 2.0:
    |                               ^^^
266 |         return False
    |

PLR2004 Magic value used in comparison, consider replacing `0.5` with a constant variable
   --> src/srd_builder/extract_monsters.py:272:43
    |
270 |     if line["font"] != span["font"]:
271 |         return False
272 |     if abs(line["size"] - span["size"]) > 0.5:
    |                                           ^^^
273 |         return False
    |

PLR2004 Magic value used in comparison, consider replacing `0.5` with a constant variable
   --> src/srd_builder/extract_monsters.py:385:60
    |
383 |         return False
384 |
385 |     if abs(line["size"] - config.monster_name_font_size) > 0.5:
    |                                                            ^^^
386 |         return False
    |

PLR2004 Magic value used in comparison, consider replacing `30` with a constant variable
   --> src/srd_builder/extract_monsters.py:444:33
    |
443 |         # Stop if we've gone too far vertically
444 |         if next_y - current_y > 30:
    |                                 ^^
445 |             break
    |

PLR2004 Magic value used in comparison, consider replacing `50` with a constant variable
   --> src/srd_builder/extract_monsters.py:496:46
    |
495 |     # Monster names are typically capitalized and not too long
496 |     return text[0].isupper() and len(text) < 50
    |                                              ^^
    |

PLC0415 `import` should be at the top-level of a file
   --> src/srd_builder/extract_monsters.py:596:5
    |
594 | def main() -> None:
595 |     """CLI entry point."""
596 |     import argparse
    |     ^^^^^^^^^^^^^^^
597 |
598 |     parser = argparse.ArgumentParser(description="Extract monsters from SRD PDF")
    |

PLC0415 `import` should be at the top-level of a file
   --> src/srd_builder/extract_pdf_metadata.py:102:5
    |
100 | def main() -> None:
101 |     """CLI entry point for testing."""
102 |     import argparse
    |     ^^^^^^^^^^^^^^^
103 |     import json
    |

PLC0415 `import` should be at the top-level of a file
   --> src/srd_builder/extract_pdf_metadata.py:103:5
    |
101 |     """CLI entry point for testing."""
102 |     import argparse
103 |     import json
    |     ^^^^^^^^^^^
104 |
105 |     parser = argparse.ArgumentParser(description="Extract metadata from SRD PDF")
    |

PLR0912 Too many branches (19 > 12)
   --> src/srd_builder/extract_spells.py:103:5
    |
103 | def _extract_page_spells(  # noqa: C901
    |     ^^^^^^^^^^^^^^^^^^^^
104 |     page: fitz.Page, page_num: int, config: ExtractionConfig
105 | ) -> list[dict[str, Any]]:
    |

PLR2004 Magic value used in comparison, consider replacing `0.5` with a constant variable
   --> src/srd_builder/extract_spells.py:135:92
    |
134 |                 # Detect spell name (12pt GillSans-SemiBold)
135 |                 if config.spell_name_font in font and abs(size - config.spell_name_size) < 0.5:
    |                                                                                            ^^^
136 |                     # Save previous spell
137 |                     if current_spell:
    |

PLR2004 Magic value used in comparison, consider replacing `50` with a constant variable
   --> src/srd_builder/extract_spells.py:253:28
    |
252 |             # Merge if: current incomplete AND next has no name (continuation)
253 |             if (desc_len < 50 or header_len < 30) and not next_has_name:
    |                            ^^
254 |                 # Merge with next spell's content
255 |                 current["header_text"] += " " + next_spell.get("header_text", "")
    |

PLR2004 Magic value used in comparison, consider replacing `30` with a constant variable
   --> src/srd_builder/extract_spells.py:253:47
    |
252 |             # Merge if: current incomplete AND next has no name (continuation)
253 |             if (desc_len < 50 or header_len < 30) and not next_has_name:
    |                                               ^^
254 |                 # Merge with next spell's content
255 |                 current["header_text"] += " " + next_spell.get("header_text", "")
    |

PLC0415 `import` should be at the top-level of a file
   --> src/srd_builder/extract_spells.py:271:5
    |
269 | def main() -> None:  # pragma: no cover
270 |     """CLI entry point for spell extraction."""
271 |     import sys
    |     ^^^^^^^^^^
272 |
273 |     if len(sys.argv) != 2:
    |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
   --> src/srd_builder/extract_spells.py:273:25
    |
271 |     import sys
272 |
273 |     if len(sys.argv) != 2:
    |                         ^
274 |         print(f"Usage: {sys.argv[0]} <pdf_path>")
275 |         sys.exit(1)
    |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
   --> src/srd_builder/extract_tables.py:208:33
    |
206 |         for table in tables:
207 |             extracted = table.extract()
208 |             if len(extracted) < 2:  # Need header + data
    |                                 ^
209 |                 continue
    |

PLR0911 Too many return statements (23 > 6)
   --> src/srd_builder/extract_tables.py:274:9
    |
272 |         )
273 |
274 |     def _extract_manual(
    |         ^^^^^^^^^^^^^^^
275 |         self, target: TableTarget, page: fitz.Page, page_num: int
276 |     ) -> RawTable:  # noqa: C901
    |

PLR0912 Too many branches (24 > 12)
   --> src/srd_builder/extract_tables.py:274:9
    |
272 |         )
273 |
274 |     def _extract_manual(
    |         ^^^^^^^^^^^^^^^
275 |         self, target: TableTarget, page: fitz.Page, page_num: int
276 |     ) -> RawTable:  # noqa: C901
    |

PLR2004 Magic value used in comparison, consider replacing `4` with a constant variable
   --> src/srd_builder/extract_tables.py:374:25
    |
372 |         rows = []
373 |         for level in range(1, 21):
374 |             if level <= 4:
    |                         ^
375 |                 bonus = "+2"
376 |             elif level <= 8:
    |

PLR2004 Magic value used in comparison, consider replacing `8` with a constant variable
   --> src/srd_builder/extract_tables.py:376:27
    |
374 |             if level <= 4:
375 |                 bonus = "+2"
376 |             elif level <= 8:
    |                           ^
377 |                 bonus = "+3"
378 |             elif level <= 12:
    |

PLR2004 Magic value used in comparison, consider replacing `12` with a constant variable
   --> src/srd_builder/extract_tables.py:378:27
    |
376 |             elif level <= 8:
377 |                 bonus = "+3"
378 |             elif level <= 12:
    |                           ^^
379 |                 bonus = "+4"
380 |             elif level <= 16:
    |

PLR2004 Magic value used in comparison, consider replacing `16` with a constant variable
   --> src/srd_builder/extract_tables.py:380:27
    |
378 |             elif level <= 12:
379 |                 bonus = "+4"
380 |             elif level <= 16:
    |                           ^^
381 |                 bonus = "+5"
382 |             else:
    |

PLC0415 `import` should be at the top-level of a file
    --> src/srd_builder/extract_tables.py:1450:5
     |
1448 |         skip_failures: If True, skip tables that fail extraction
1449 |     """
1450 |     import json
     |     ^^^^^^^^^^^
1451 |
1452 |     with TableExtractor(pdf_path) as extractor:
     |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
    --> src/srd_builder/extract_tables.py:1484:24
     |
1482 |     logging.basicConfig(level=logging.INFO, format="%(levelname)s: %(message)s")
1483 |
1484 |     if len(sys.argv) < 2:
     |                        ^
1485 |         print("Usage: python -m srd_builder.extract_tables <pdf_path> [output_path]")
1486 |         sys.exit(1)
     |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
    --> src/srd_builder/extract_tables.py:1489:50
     |
1488 |     pdf_path = sys.argv[1]
1489 |     output_path = sys.argv[2] if len(sys.argv) > 2 else "tables_raw.json"
     |                                                  ^
1490 |
1491 |     extract_tables_to_json(pdf_path, output_path)
     |

PLR0913 Too many arguments in function definition (7 > 5)
   --> src/srd_builder/indexer.py:379:5
    |
379 | def build_indexes(  # noqa: C901
    |     ^^^^^^^^^^^^^
380 |     monsters: list[dict[str, Any]],
381 |     spells: list[dict[str, Any]] | None = None,
    |

PLR0912 Too many branches (17 > 12)
   --> src/srd_builder/indexer.py:379:5
    |
379 | def build_indexes(  # noqa: C901
    |     ^^^^^^^^^^^^^
380 |     monsters: list[dict[str, Any]],
381 |     spells: list[dict[str, Any]] | None = None,
    |

PLR0915 Too many statements (83 > 50)
   --> src/srd_builder/indexer.py:379:5
    |
379 | def build_indexes(  # noqa: C901
    |     ^^^^^^^^^^^^^
380 |     monsters: list[dict[str, Any]],
381 |     spells: list[dict[str, Any]] | None = None,
    |

PLR0912 Too many branches (16 > 12)
  --> src/srd_builder/parse_actions.py:29:5
   |
29 | def parse_action_fields(action: dict[str, Any]) -> dict[str, Any]:  # noqa: C901
   |     ^^^^^^^^^^^^^^^^^^^
30 |     """Parse structured fields from action text.
   |

PLR0915 Too many statements (55 > 50)
  --> src/srd_builder/parse_actions.py:29:5
   |
29 | def parse_action_fields(action: dict[str, Any]) -> dict[str, Any]:  # noqa: C901
   |     ^^^^^^^^^^^^^^^^^^^
30 |     """Parse structured fields from action text.
   |

PLR0912 Too many branches (16 > 12)
  --> src/srd_builder/parse_equipment.py:30:5
   |
30 | def parse_equipment_records(raw_items: list[dict[str, Any]]) -> list[dict[str, Any]]:  # noqa: C901
   |     ^^^^^^^^^^^^^^^^^^^^^^^
31 |     """Parse raw equipment items into structured records."""
   |

PLR0911 Too many return statements (7 > 6)
  --> src/srd_builder/parse_monsters.py:32:5
   |
32 | def _coerce_int(value: Any) -> int | None:
   |     ^^^^^^^^^^^
33 |     if value is None:
34 |         return None
   |

PLR2004 Magic value used in comparison, consider replacing `9.0` with a constant variable
   --> src/srd_builder/parse_monsters.py:420:29
    |
419 |         # Only collect regular text blocks (9.84pt Calibri)
420 |         if text and size >= 9.0 and size <= 10.0 and "Calibri" in font:
    |                             ^^^
421 |             # Clean whitespace: tabs, newlines, carriage returns
422 |             cleaned_text = " ".join(text.split())
    |

PLR2004 Magic value used in comparison, consider replacing `10.0` with a constant variable
   --> src/srd_builder/parse_monsters.py:420:45
    |
419 |         # Only collect regular text blocks (9.84pt Calibri)
420 |         if text and size >= 9.0 and size <= 10.0 and "Calibri" in font:
    |                                             ^^^^
421 |             # Clean whitespace: tabs, newlines, carriage returns
422 |             cleaned_text = " ".join(text.split())
    |

PLR0912 Too many branches (46 > 12)
   --> src/srd_builder/parse_monsters.py:433:5
    |
433 | def parse_monster_from_blocks(monster: dict[str, Any]) -> dict[str, Any]:  # noqa: C901
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^
434 |     """Parse monster fields from blocks array (v0.3.0 extraction format).
    |

PLR0915 Too many statements (159 > 50)
   --> src/srd_builder/parse_monsters.py:433:5
    |
433 | def parse_monster_from_blocks(monster: dict[str, Any]) -> dict[str, Any]:  # noqa: C901
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^
434 |     """Parse monster fields from blocks array (v0.3.0 extraction format).
    |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
   --> src/srd_builder/parse_monsters.py:470:38
    |
468 |         # Size/type/alignment line (Calibri-Italic, right after name)
469 |         # Handle split across multiple Italic blocks (e.g., Kraken, Mummy, Unicorn)
470 |         if "Italic" in font and i <= 2:
    |                                      ^
471 |             # Collect all consecutive Italic blocks (may be split with comma blocks between)
472 |             italic_parts = [text]
    |

PLR2004 Magic value used in comparison, consider replacing `6` with a constant variable
   --> src/srd_builder/parse_monsters.py:514:42
    |
512 |                 # Case 1: Next block is Bold and looks like label continuation (e.g., "Sense" + "s")
513 |                 if "Bold" in peek_font and peek_text and not peek_text[0].isdigit():
514 |                     if len(peek_text) <= 6 and not any(c in peek_text for c in "():,"):
    |                                          ^
515 |                         label_clean += " " + " ".join(peek_text.split()).lower()
516 |                         j += 1
    |

PLR2004 Magic value used in comparison, consider replacing `6` with a constant variable
   --> src/srd_builder/parse_monsters.py:601:45
    |
600 |                     # Safety: stop after collecting reasonable amount (up to 6 blocks for edge cases)
601 |                     if len(values_parts) >= 6:
    |                                             ^
602 |                         break
    |

PLR1714 Consider merging multiple comparisons: `label_clean in {"senses", "sense s"}`.
   --> src/srd_builder/parse_monsters.py:626:16
    |
625 |             # Senses
626 |             if label_clean == "senses" or label_clean == "sense s":
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
627 |                 parsed["senses"] = next_text
628 |                 i = j
    |
help: Merge multiple comparisons

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
   --> src/srd_builder/parse_monsters.py:700:21
    |
699 |     parts = [p.strip() for p in text.split(",")]
700 |     if len(parts) < 2:
    |                     ^
701 |         return {}
    |

PLR2004 Magic value used in comparison, consider replacing `6` with a constant variable
   --> src/srd_builder/parse_monsters.py:730:23
    |
728 |         scores.append(int(match.group(1)))
729 |
730 |     if len(scores) != 6:
    |                       ^
731 |         return {}
    |

PLR0912 Too many branches (15 > 12)
   --> src/srd_builder/parse_monsters.py:743:5
    |
743 | def _parse_traits_and_actions(  # noqa: C901
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^
744 |     blocks: list[dict],
745 | ) -> tuple[list[dict], list[dict], list[dict], list[dict]]:
    |

PLR0915 Too many statements (62 > 50)
   --> src/srd_builder/parse_monsters.py:743:5
    |
743 | def _parse_traits_and_actions(  # noqa: C901
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^
744 |     blocks: list[dict],
745 | ) -> tuple[list[dict], list[dict], list[dict], list[dict]]:
    |

PLR2004 Magic value used in comparison, consider replacing `10.8` with a constant variable
   --> src/srd_builder/parse_monsters.py:775:25
    |
774 |         # Detect section headers
775 |         if font_size >= 10.8 and "bold" in font.lower():
    |                         ^^^^
776 |             if text.lower() == "actions":
777 |                 current_section = "actions"
    |

PLR2004 Magic value used in comparison, consider replacing `9.5` with a constant variable
   --> src/srd_builder/parse_monsters.py:796:26
    |
795 |         is_name_block = (
796 |             font_size >= 9.5
    |                          ^^^
797 |             and text.endswith(".")
798 |             and (is_bold_italic or (is_just_bold and is_legendary_section))
    |

PLR2004 Magic value used in comparison, consider replacing `10.8` with a constant variable
   --> src/srd_builder/parse_monsters.py:822:38
    |
821 |                 # Stop at section header
822 |                 if next_font_size >= 10.8 and "bold" in next_font.lower():
    |                                      ^^^^
823 |                     break
    |

PLR2004 Magic value used in comparison, consider replacing `9.5` with a constant variable
   --> src/srd_builder/parse_monsters.py:826:38
    |
825 |                 # Stop at next BoldItalic name (trait/action)
826 |                 if next_font_size >= 9.5 and next_is_bold_italic and next_text.endswith("."):
    |                                      ^^^
827 |                     break
    |

PLR2004 Magic value used in comparison, consider replacing `9.5` with a constant variable
   --> src/srd_builder/parse_monsters.py:831:39
    |
829 |                 # Stop at next Bold name (legendary action) if in legendary section
830 |                 if (
831 |                     next_font_size >= 9.5
    |                                       ^^^
832 |                     and next_is_just_bold
833 |                     and is_legendary_section
    |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
  --> src/srd_builder/parse_spells.py:50:30
   |
48 |             # Split at the SRD marker - everything after is the description
49 |             parts = re.split(r"System\s+Reference\s+Document\s+5\.1\s+\d+", header_text, maxsplit=1)
50 |             if len(parts) == 2:
   |                              ^
51 |                 header_text = parts[0].strip()
52 |                 extracted_desc = parts[1].strip()
   |

PLC0415 `import` should be at the top-level of a file
   --> src/srd_builder/parse_spells.py:140:5
    |
138 |         Tuple of (level, school)
139 |     """
140 |     import re
    |     ^^^^^^^^^
141 |
142 |     text = level_school_text.lower().strip()
    |

PLC0415 `import` should be at the top-level of a file
   --> src/srd_builder/parse_spells.py:182:5
    |
180 |         Structured range object or string for special cases
181 |     """
182 |     import re
    |     ^^^^^^^^^
183 |
184 |     text_lower = text.lower().strip()
    |

PLC0415 `import` should be at the top-level of a file
   --> src/srd_builder/parse_spells.py:242:5
    |
240 |         Components dict with verbal, somatic, material, material_description
241 |     """
242 |     import re
    |     ^^^^^^^^^
243 |
244 |     components: dict[str, Any] = {
    |

PLC0415 `import` should be at the top-level of a file
   --> src/srd_builder/parse_spells.py:267:5
    |
265 |         Effects dict (may be empty if no extractable effects)
266 |     """
267 |     import re
    |     ^^^^^^^^^
268 |
269 |     effects: dict[str, Any] = {}
    |

PLC0415 `import` should be at the top-level of a file
   --> src/srd_builder/parse_spells.py:345:5
    |
343 |         Scaling dict or None if spell doesn't scale
344 |     """
345 |     import re
    |     ^^^^^^^^^
346 |
347 |     # Check for "At Higher Levels" section (slot scaling)
    |

PLR0911 Too many return statements (8 > 6)
  --> src/srd_builder/parse_tables.py:32:5
   |
32 | def detect_column_type(values: list[Any]) -> str:
   |     ^^^^^^^^^^^^^^^^^^
33 |     """Detect the type of a column based on its values.
   |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
   --> src/srd_builder/parse_tables.py:176:24
    |
174 |     logging.basicConfig(level=logging.INFO, format="%(levelname)s: %(message)s")
175 |
176 |     if len(sys.argv) < 2:
    |                        ^
177 |         print("Usage: python -m srd_builder.parse_tables <raw_tables.json> [output.json]")
178 |         sys.exit(1)
    |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
   --> src/srd_builder/parse_tables.py:181:50
    |
180 |     raw_path = sys.argv[1]
181 |     output_path = sys.argv[2] if len(sys.argv) > 2 else "tables.json"
    |                                                  ^
182 |
183 |     parse_tables(raw_path, output_path)
    |

PLC0415 `import` should be at the top-level of a file
   --> src/srd_builder/postprocess.py:305:5
    |
303 |     action text while preserving original text for fallback.
304 |     """
305 |     from srd_builder.parse_actions import parse_action_fields
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
306 |
307 |     patched = {**monster}
    |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
   --> src/srd_builder/table_indexer.py:150:44
    |
148 |                 rows = table.extract()
149 |
150 |                 if not rows or len(rows) < 2:  # Need at least header + 1 data row
    |                                            ^
151 |                     continue
    |

PLR2004 Magic value used in comparison, consider replacing `18.0` with a constant variable
   --> src/srd_builder/table_indexer.py:208:36
    |
207 |                         # Large headers (18pt+) are usually section markers
208 |                         if size >= 18.0 and len(text) > 3:
    |                                    ^^^^
209 |                             return text
    |

PLR2004 Magic value used in comparison, consider replacing `3` with a constant variable
   --> src/srd_builder/table_indexer.py:208:57
    |
207 |                         # Large headers (18pt+) are usually section markers
208 |                         if size >= 18.0 and len(text) > 3:
    |                                                         ^
209 |                             return text
    |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
   --> src/srd_builder/table_indexer.py:250:27
    |
248 |             # Check if multiple keywords appear in headers
249 |             matches = sum(1 for kw in keywords if kw in header_text)
250 |             if matches >= 2:  # At least 2 keywords match
    |                           ^
251 |                 return table_id
    |

PLC0415 `import` should be at the top-level of a file
   --> src/srd_builder/table_indexer.py:328:17
    |
326 |         try:
327 |             try:
328 |                 from scripts.table_targets import TARGET_TABLES
    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
329 |             except ModuleNotFoundError:
330 |                 import sys
    |

PLC0415 `import` should be at the top-level of a file
   --> src/srd_builder/table_indexer.py:330:17
    |
328 |                 from scripts.table_targets import TARGET_TABLES
329 |             except ModuleNotFoundError:
330 |                 import sys
    |                 ^^^^^^^^^^
331 |                 from pathlib import Path
    |

PLC0415 `import` should be at the top-level of a file
   --> src/srd_builder/table_indexer.py:331:17
    |
329 |             except ModuleNotFoundError:
330 |                 import sys
331 |                 from pathlib import Path
    |                 ^^^^^^^^^^^^^^^^^^^^^^^^
332 |
333 |                 sys.path.insert(0, str(Path(__file__).parent.parent.parent))
    |

PLC0415 `import` should be at the top-level of a file
   --> src/srd_builder/table_indexer.py:334:17
    |
333 |                 sys.path.insert(0, str(Path(__file__).parent.parent.parent))
334 |                 from scripts.table_targets import TARGET_TABLES
    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
335 |
336 |             for target in TARGET_TABLES:
    |

PLC0415 `import` should be at the top-level of a file
   --> src/srd_builder/table_indexer.py:389:9
    |
387 |             output_path: Path for output JSON file
388 |         """
389 |         import json
    |         ^^^^^^^^^^^
390 |
391 |         report = self.generate_report()
    |

PLC0415 `import` should be at the top-level of a file
 --> tests/test_ability_modifiers.py:6:5
  |
4 | def test_add_ability_modifiers_calculates_correctly():
5 |     """Verify D&D 5e modifier formula: (score - 10) // 2."""
6 |     from srd_builder.postprocess import add_ability_modifiers
  |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
7 |
8 |     monster = {
  |

PLR2004 Magic value used in comparison, consider replacing `21` with a constant variable
  --> tests/test_ability_modifiers.py:22:52
   |
20 |     result = add_ability_modifiers(monster)
21 |
22 |     assert result["ability_scores"]["strength"] == 21
   |                                                    ^^
23 |     assert result["ability_scores"]["strength_modifier"] == 5
   |

PLR2004 Magic value used in comparison, consider replacing `5` with a constant variable
  --> tests/test_ability_modifiers.py:23:61
   |
22 |     assert result["ability_scores"]["strength"] == 21
23 |     assert result["ability_scores"]["strength_modifier"] == 5
   |                                                             ^
24 |
25 |     assert result["ability_scores"]["dexterity"] == 10
   |

PLR2004 Magic value used in comparison, consider replacing `10` with a constant variable
  --> tests/test_ability_modifiers.py:25:53
   |
23 |     assert result["ability_scores"]["strength_modifier"] == 5
24 |
25 |     assert result["ability_scores"]["dexterity"] == 10
   |                                                     ^^
26 |     assert result["ability_scores"]["dexterity_modifier"] == 0
   |

PLR2004 Magic value used in comparison, consider replacing `18` with a constant variable
  --> tests/test_ability_modifiers.py:28:56
   |
26 |     assert result["ability_scores"]["dexterity_modifier"] == 0
27 |
28 |     assert result["ability_scores"]["constitution"] == 18
   |                                                        ^^
29 |     assert result["ability_scores"]["constitution_modifier"] == 4
   |

PLR2004 Magic value used in comparison, consider replacing `4` with a constant variable
  --> tests/test_ability_modifiers.py:29:65
   |
28 |     assert result["ability_scores"]["constitution"] == 18
29 |     assert result["ability_scores"]["constitution_modifier"] == 4
   |                                                                 ^
30 |
31 |     assert result["ability_scores"]["intelligence"] == 8
   |

PLR2004 Magic value used in comparison, consider replacing `8` with a constant variable
  --> tests/test_ability_modifiers.py:31:56
   |
29 |     assert result["ability_scores"]["constitution_modifier"] == 4
30 |
31 |     assert result["ability_scores"]["intelligence"] == 8
   |                                                        ^
32 |     assert result["ability_scores"]["intelligence_modifier"] == -1
   |

PLR2004 Magic value used in comparison, consider replacing `13` with a constant variable
  --> tests/test_ability_modifiers.py:34:50
   |
32 |     assert result["ability_scores"]["intelligence_modifier"] == -1
33 |
34 |     assert result["ability_scores"]["wisdom"] == 13
   |                                                  ^^
35 |     assert result["ability_scores"]["wisdom_modifier"] == 1
   |

PLR2004 Magic value used in comparison, consider replacing `6` with a constant variable
  --> tests/test_ability_modifiers.py:37:52
   |
35 |     assert result["ability_scores"]["wisdom_modifier"] == 1
36 |
37 |     assert result["ability_scores"]["charisma"] == 6
   |                                                    ^
38 |     assert result["ability_scores"]["charisma_modifier"] == -2
   |

PLR2004 Magic value used in comparison, consider replacing `-2` with a constant variable
  --> tests/test_ability_modifiers.py:38:61
   |
37 |     assert result["ability_scores"]["charisma"] == 6
38 |     assert result["ability_scores"]["charisma_modifier"] == -2
   |                                                             ^^
   |

PLC0415 `import` should be at the top-level of a file
  --> tests/test_ability_modifiers.py:43:5
   |
41 | def test_add_ability_modifiers_handles_missing_scores():
42 |     """Handle monsters with no ability scores."""
43 |     from srd_builder.postprocess import add_ability_modifiers
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
44 |
45 |     monster = {"name": "Test", "ability_scores": {}}
   |

PLC0415 `import` should be at the top-level of a file
  --> tests/test_ability_modifiers.py:56:5
   |
54 | def test_add_ability_modifiers_handles_partial_scores():
55 |     """Handle monsters with only some ability scores."""
56 |     from srd_builder.postprocess import add_ability_modifiers
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
57 |
58 |     monster = {
   |

PLR2004 Magic value used in comparison, consider replacing `16` with a constant variable
  --> tests/test_ability_modifiers.py:68:52
   |
66 |     result = add_ability_modifiers(monster)
67 |
68 |     assert result["ability_scores"]["strength"] == 16
   |                                                    ^^
69 |     assert result["ability_scores"]["strength_modifier"] == 3
70 |     assert result["ability_scores"]["intelligence"] == 3
   |

PLR2004 Magic value used in comparison, consider replacing `3` with a constant variable
  --> tests/test_ability_modifiers.py:69:61
   |
68 |     assert result["ability_scores"]["strength"] == 16
69 |     assert result["ability_scores"]["strength_modifier"] == 3
   |                                                             ^
70 |     assert result["ability_scores"]["intelligence"] == 3
71 |     assert result["ability_scores"]["intelligence_modifier"] == -4
   |

PLR2004 Magic value used in comparison, consider replacing `3` with a constant variable
  --> tests/test_ability_modifiers.py:70:56
   |
68 |     assert result["ability_scores"]["strength"] == 16
69 |     assert result["ability_scores"]["strength_modifier"] == 3
70 |     assert result["ability_scores"]["intelligence"] == 3
   |                                                        ^
71 |     assert result["ability_scores"]["intelligence_modifier"] == -4
72 |     assert "dexterity_modifier" not in result["ability_scores"]
   |

PLR2004 Magic value used in comparison, consider replacing `-4` with a constant variable
  --> tests/test_ability_modifiers.py:71:65
   |
69 |     assert result["ability_scores"]["strength_modifier"] == 3
70 |     assert result["ability_scores"]["intelligence"] == 3
71 |     assert result["ability_scores"]["intelligence_modifier"] == -4
   |                                                                 ^^
72 |     assert "dexterity_modifier" not in result["ability_scores"]
   |

PLC0415 `import` should be at the top-level of a file
  --> tests/test_ability_modifiers.py:77:5
   |
75 | def test_add_ability_modifiers_in_pipeline():
76 |     """Verify modifiers are added during clean_monster_record."""
77 |     from srd_builder.postprocess import clean_monster_record
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
78 |
79 |     monster = {
   |

PLR2004 Magic value used in comparison, consider replacing `14` with a constant variable
   --> tests/test_ability_modifiers.py:99:52
    |
 98 |     # Verify original scores preserved
 99 |     assert result["ability_scores"]["strength"] == 14
    |                                                    ^^
100 |     assert result["ability_scores"]["wisdom"] == 8
    |

PLR2004 Magic value used in comparison, consider replacing `8` with a constant variable
   --> tests/test_ability_modifiers.py:100:50
    |
 98 |     # Verify original scores preserved
 99 |     assert result["ability_scores"]["strength"] == 14
100 |     assert result["ability_scores"]["wisdom"] == 8
    |                                                  ^
101 |
102 |     # Verify modifiers calculated
    |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
   --> tests/test_ability_modifiers.py:103:61
    |
102 |     # Verify modifiers calculated
103 |     assert result["ability_scores"]["strength_modifier"] == 2
    |                                                             ^
104 |     assert result["ability_scores"]["dexterity_modifier"] == 1
105 |     assert result["ability_scores"]["constitution_modifier"] == 3
    |

PLR2004 Magic value used in comparison, consider replacing `3` with a constant variable
   --> tests/test_ability_modifiers.py:105:65
    |
103 |     assert result["ability_scores"]["strength_modifier"] == 2
104 |     assert result["ability_scores"]["dexterity_modifier"] == 1
105 |     assert result["ability_scores"]["constitution_modifier"] == 3
    |                                                                 ^
106 |     assert result["ability_scores"]["intelligence_modifier"] == 0
107 |     assert result["ability_scores"]["wisdom_modifier"] == -1
    |

PLR2004 Magic value used in comparison, consider replacing `-2` with a constant variable
   --> tests/test_ability_modifiers.py:108:61
    |
106 |     assert result["ability_scores"]["intelligence_modifier"] == 0
107 |     assert result["ability_scores"]["wisdom_modifier"] == -1
108 |     assert result["ability_scores"]["charisma_modifier"] == -2
    |                                                             ^^
    |

PLC0415 `import` should be at the top-level of a file
   --> tests/test_ability_modifiers.py:113:5
    |
111 | def test_ability_modifiers_edge_cases():
112 |     """Test edge cases for ability scores."""
113 |     from srd_builder.postprocess import add_ability_modifiers
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
114 |
115 |     # Score of 1 (common for constructs' mental stats)
    |

PLR2004 Magic value used in comparison, consider replacing `-5` with a constant variable
   --> tests/test_ability_modifiers.py:118:65
    |
116 |     monster = {"ability_scores": {"intelligence": 1}}  # -5
117 |     result = add_ability_modifiers(monster)
118 |     assert result["ability_scores"]["intelligence_modifier"] == -5
    |                                                                 ^^
119 |
120 |     # Score of 30 (legendary creatures)
    |

PLR2004 Magic value used in comparison, consider replacing `10` with a constant variable
   --> tests/test_ability_modifiers.py:123:61
    |
121 |     monster = {"ability_scores": {"strength": 30}}  # +10
122 |     result = add_ability_modifiers(monster)
123 |     assert result["ability_scores"]["strength_modifier"] == 10
    |                                                             ^^
124 |
125 |     # Odd scores
    |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
   --> tests/test_ability_modifiers.py:128:62
    |
126 |     monster = {"ability_scores": {"dexterity": 15}}  # +2
127 |     result = add_ability_modifiers(monster)
128 |     assert result["ability_scores"]["dexterity_modifier"] == 2
    |                                                              ^
    |

PLR0915 Too many statements (57 > 50)
  --> tests/test_build_pipeline.py:11:5
   |
11 | def test_build_pipeline(tmp_path, monkeypatch):
   |     ^^^^^^^^^^^^^^^^^^^
12 |     class _DummyValidator:
13 |         def __init__(self, _schema):
   |

PLC0415 `import` should be at the top-level of a file
  --> tests/test_build_pipeline.py:21:5
   |
19 |     monkeypatch.setattr(jsonschema, "Draft202012Validator", _DummyValidator)
20 |
21 |     from srd_builder import validate as validate_module
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
22 |
23 |     ruleset = "srd_5_1"
   |

PLC0415 `import` should be at the top-level of a file
  --> tests/test_build_pipeline.py:41:5
   |
40 |     # Mock extract_monsters to avoid PDF parsing issues with fake PDF
41 |     from srd_builder import build as build_module
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
42 |
43 |     def mock_extract_monsters(_pdf_path):
   |

PLR2004 Magic value used in comparison, consider replacing `63` with a constant variable
  --> tests/test_context_tracker.py:21:40
   |
20 |     assert tracker.current() == {"category": "armor", "subcategory": "medium"}
21 |     assert tracker.history[-1].page == 63
   |                                        ^^
22 |     assert tracker.history[-1].subcategory == "medium"
   |

PLR2004 Magic value used in comparison, consider replacing `296` with a constant variable
  --> tests/test_extract_basic.py:31:33
   |
29 | def test_extraction_completeness(monsters_raw):
30 |     """Verify we extract the expected number of monsters."""
31 |     assert len(monsters_raw) == 296, f"Expected 296 monsters, got {len(monsters_raw)}"
   |                                 ^^^
   |

PLR2004 Magic value used in comparison, consider replacing `5` with a constant variable
  --> tests/test_extract_basic.py:81:31
   |
79 |     # Find Bold blocks (stat labels like "Armor Class", "Hit Points")
80 |     bold_blocks = [b for b in goblin["blocks"] if "Bold" in b.get("font", "")]
81 |     assert len(bold_blocks) > 5, "Goblin should have multiple Bold blocks for stat labels"
   |                               ^
82 |
83 |     # Find Italic blocks (size/type/alignment line)
   |

PLR2004 Magic value used in comparison, consider replacing `261` with a constant variable
   --> tests/test_extract_basic.py:110:20
    |
109 |         for page in pages:
110 |             assert 261 <= page <= 394, f"{name}: page {page} outside SRD monster section (261-394)"
    |                    ^^^
    |

PLR2004 Magic value used in comparison, consider replacing `394` with a constant variable
   --> tests/test_extract_basic.py:110:35
    |
109 |         for page in pages:
110 |             assert 261 <= page <= 394, f"{name}: page {page} outside SRD monster section (261-394)"
    |                                   ^^^
    |

PLR2004 Magic value used in comparison, consider replacing `0.05` with a constant variable
   --> tests/test_extract_basic.py:122:24
    |
120 |     warning_rate = len(monsters_with_warnings) / len(monsters_raw)
121 |     assert (
122 |         warning_rate < 0.05
    |                        ^^^^
123 |     ), f"Too many monsters with warnings: {len(monsters_with_warnings)}/296 ({warning_rate:.1%})"
    |

PLR2004 Magic value used in comparison, consider replacing `10` with a constant variable
   --> tests/test_extract_basic.py:130:31
    |
128 |     for name, monster in list(monsters_raw.items())[:50]:  # Sample 50 monsters
129 |         block_count = len(monster.get("blocks", []))
130 |         assert block_count >= 10, f"{name}: too few blocks ({block_count}), stat block incomplete?"
    |                               ^^
131 |         assert block_count <= 500, f"{name}: too many blocks ({block_count}), extraction error?"
    |

PLR2004 Magic value used in comparison, consider replacing `500` with a constant variable
   --> tests/test_extract_basic.py:131:31
    |
129 |         block_count = len(monster.get("blocks", []))
130 |         assert block_count >= 10, f"{name}: too few blocks ({block_count}), stat block incomplete?"
131 |         assert block_count <= 500, f"{name}: too many blocks ({block_count}), extraction error?"
    |                               ^^^
    |

PLR2004 Magic value used in comparison, consider replacing `8` with a constant variable
   --> tests/test_extract_basic.py:145:17
    |
143 |         if size > 0:  # Skip blocks without size info
144 |             assert (
145 |                 8 <= size <= 14
    |                 ^
146 |             ), f"Goblin block has unusual font size: {size}pt (text: {block.get('text', '')[:50]})"
    |

PLR2004 Magic value used in comparison, consider replacing `14` with a constant variable
   --> tests/test_extract_basic.py:145:30
    |
143 |         if size > 0:  # Skip blocks without size info
144 |             assert (
145 |                 8 <= size <= 14
    |                              ^^
146 |             ), f"Goblin block has unusual font size: {size}pt (text: {block.get('text', '')[:50]})"
    |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
  --> tests/test_extract_cross_page.py:38:34
   |
37 |     # Must span multiple pages
38 |     assert len(deva["pages"]) >= 2, f"Deva should span 2+ pages, got {deva['pages']}"
   |                                  ^
39 |     assert 261 in deva["pages"], "Deva should include page 261"
40 |     assert 262 in deva["pages"], "Deva should include page 262"
   |

PLR2004 Magic value used in comparison, consider replacing `261` with a constant variable
  --> tests/test_extract_cross_page.py:39:12
   |
37 |     # Must span multiple pages
38 |     assert len(deva["pages"]) >= 2, f"Deva should span 2+ pages, got {deva['pages']}"
39 |     assert 261 in deva["pages"], "Deva should include page 261"
   |            ^^^
40 |     assert 262 in deva["pages"], "Deva should include page 262"
   |

PLR2004 Magic value used in comparison, consider replacing `262` with a constant variable
  --> tests/test_extract_cross_page.py:40:12
   |
38 |     assert len(deva["pages"]) >= 2, f"Deva should span 2+ pages, got {deva['pages']}"
39 |     assert 261 in deva["pages"], "Deva should include page 261"
40 |     assert 262 in deva["pages"], "Deva should include page 262"
   |            ^^^
41 |
42 |     # Must have complete stat block (70+ blocks)
   |

PLR2004 Magic value used in comparison, consider replacing `70` with a constant variable
  --> tests/test_extract_cross_page.py:45:24
   |
43 |     block_count = len(deva["blocks"])
44 |     assert (
45 |         block_count >= 70
   |                        ^^
46 |     ), f"Deva should have 70+ blocks for complete stat block, got {block_count}"
   |

PLR2004 Magic value used in comparison, consider replacing `70` with a constant variable
  --> tests/test_extract_cross_page.py:67:24
   |
65 |     block_count = len(solar["blocks"])
66 |     assert (
67 |         block_count >= 70
   |                        ^^
68 |     ), f"Solar should have 70+ blocks for complete stat block, got {block_count}"
   |

PLR2004 Magic value used in comparison, consider replacing `70` with a constant variable
  --> tests/test_extract_cross_page.py:86:27
   |
84 |     # Must have substantial block count
85 |     block_count = len(planetar["blocks"])
86 |     assert block_count >= 70, f"Planetar should have 70+ blocks, got {block_count}"
   |                           ^^
   |

PLR2004 Magic value used in comparison, consider replacing `20` with a constant variable
   --> tests/test_extract_cross_page.py:99:26
    |
 97 |     for name, monster in monsters_raw.items():
 98 |         block_count = len(monster["blocks"])
 99 |         if block_count < 20:
    |                          ^^
100 |             too_short.append((name, block_count))
    |

PLR2004 Magic value used in comparison, consider replacing `30` with a constant variable
   --> tests/test_extract_cross_page.py:124:31
    |
122 |     for name, monster in cross_page_monsters:
123 |         block_count = len(monster["blocks"])
124 |         assert block_count >= 30, (
    |                               ^^
125 |             f"{name} spans pages {monster['pages']} but only has {block_count} blocks - "
126 |             "possible extraction truncation"
    |

PLR2004 Magic value used in comparison, consider replacing `296` with a constant variable
   --> tests/test_extract_cross_page.py:144:33
    |
142 | def test_extraction_coverage(monsters_raw):
143 |     """Verify we extracted all 296 expected monsters."""
144 |     assert len(monsters_raw) == 296, f"Expected 296 monsters, got {len(monsters_raw)}"
    |                                 ^^^
    |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
   --> tests/test_extract_cross_page.py:188:27
    |
186 |         for i in range(len(pages) - 1):
187 |             gap = pages[i + 1] - pages[i]
188 |             assert gap <= 2, (
    |                           ^
189 |                 f"{name} has suspicious page gap: {pages} "
190 |                 f"(gap of {gap} between pages {pages[i]} and {pages[i+1]})"
    |

PLC0415 `import` should be at the top-level of a file
 --> tests/test_indexer.py:2:5
  |
1 | def test_build_monster_index():
2 |     from srd_builder.indexer import build_monster_index
  |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
3 |
4 |     mons = [
  |

PLC0415 `import` should be at the top-level of a file
 --> tests/test_parse_actions.py:6:5
  |
4 | def test_parse_melee_weapon_attack():
5 |     """Parse typical melee weapon attack."""
6 |     from srd_builder.parse_actions import parse_action_fields
  |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
7 |
8 |     action = {
  |

PLR2004 Magic value used in comparison, consider replacing `7` with a constant variable
  --> tests/test_parse_actions.py:16:32
   |
15 |     assert result["attack_type"] == "melee_weapon"
16 |     assert result["to_hit"] == 7
   |                                ^
17 |     assert result["reach"] == 5
18 |     assert result["damage"] == {
   |

PLR2004 Magic value used in comparison, consider replacing `5` with a constant variable
  --> tests/test_parse_actions.py:17:31
   |
15 |     assert result["attack_type"] == "melee_weapon"
16 |     assert result["to_hit"] == 7
17 |     assert result["reach"] == 5
   |                               ^
18 |     assert result["damage"] == {
19 |         "average": 17,
   |

PLC0415 `import` should be at the top-level of a file
  --> tests/test_parse_actions.py:28:5
   |
26 | def test_parse_ranged_weapon_attack():
27 |     """Parse ranged weapon attack with range."""
28 |     from srd_builder.parse_actions import parse_action_fields
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
29 |
30 |     action = {
   |

PLR2004 Magic value used in comparison, consider replacing `4` with a constant variable
  --> tests/test_parse_actions.py:38:32
   |
37 |     assert result["attack_type"] == "ranged_weapon"
38 |     assert result["to_hit"] == 4
   |                                ^
39 |     assert result["range"] == {"normal": 150, "long": 600}
40 |     assert result["damage"] == {
   |

PLC0415 `import` should be at the top-level of a file
  --> tests/test_parse_actions.py:50:5
   |
48 | def test_parse_action_with_saving_throw():
49 |     """Parse action with DC saving throw."""
50 |     from srd_builder.parse_actions import parse_action_fields
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
51 |
52 |     action = {
   |

PLC0415 `import` should be at the top-level of a file
  --> tests/test_parse_actions.py:72:5
   |
70 | def test_parse_action_multiple_damage_types():
71 |     """Parse action with multiple damage instances."""
72 |     from srd_builder.parse_actions import parse_action_fields
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
73 |
74 |     action = {
   |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
  --> tests/test_parse_actions.py:87:45
   |
85 |     }
86 |     assert "damage_options" in result
87 |     assert len(result["damage_options"]) == 2
   |                                             ^
88 |     assert result["damage_options"][1] == {
89 |         "average": 3,
   |

PLC0415 `import` should be at the top-level of a file
  --> tests/test_parse_actions.py:97:5
   |
95 | def test_parse_melee_spell_attack():
96 |     """Parse melee spell attack."""
97 |     from srd_builder.parse_actions import parse_action_fields
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
98 |
99 |     action = {
   |

PLR2004 Magic value used in comparison, consider replacing `5` with a constant variable
   --> tests/test_parse_actions.py:107:32
    |
106 |     assert result["attack_type"] == "melee_spell"
107 |     assert result["to_hit"] == 5
    |                                ^
108 |     assert result["reach"] == 5
    |

PLR2004 Magic value used in comparison, consider replacing `5` with a constant variable
   --> tests/test_parse_actions.py:108:31
    |
106 |     assert result["attack_type"] == "melee_spell"
107 |     assert result["to_hit"] == 5
108 |     assert result["reach"] == 5
    |                               ^
    |

PLC0415 `import` should be at the top-level of a file
   --> tests/test_parse_actions.py:113:5
    |
111 | def test_parse_ranged_spell_attack():
112 |     """Parse ranged spell attack."""
113 |     from srd_builder.parse_actions import parse_action_fields
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
114 |
115 |     action = {
    |

PLR2004 Magic value used in comparison, consider replacing `7` with a constant variable
   --> tests/test_parse_actions.py:123:32
    |
122 |     assert result["attack_type"] == "ranged_spell"
123 |     assert result["to_hit"] == 7
    |                                ^
124 |     assert result["range"] == {"normal": 120, "long": 480}
    |

PLC0415 `import` should be at the top-level of a file
   --> tests/test_parse_actions.py:129:5
    |
127 | def test_parse_negative_to_hit():
128 |     """Parse action with negative to-hit modifier."""
129 |     from srd_builder.parse_actions import parse_action_fields
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
130 |
131 |     action = {
    |

PLC0415 `import` should be at the top-level of a file
   --> tests/test_parse_actions.py:144:5
    |
142 | def test_parse_action_without_attack():
143 |     """Non-attack actions should not be parsed."""
144 |     from srd_builder.parse_actions import parse_action_fields
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
145 |
146 |     action = {
    |

PLC0415 `import` should be at the top-level of a file
   --> tests/test_parse_actions.py:161:5
    |
159 | def test_parse_action_preserves_all_fields():
160 |     """Parsing should add fields without removing existing ones."""
161 |     from srd_builder.parse_actions import parse_action_fields
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
162 |
163 |     action = {
    |

PLR2004 Magic value used in comparison, consider replacing `10` with a constant variable
   --> tests/test_parse_actions.py:176:32
    |
174 |     assert result["custom_field"] == "should be preserved"
175 |     assert result["attack_type"] == "melee_weapon"
176 |     assert result["to_hit"] == 10
    |                                ^^
    |

PLC0415 `import` should be at the top-level of a file
   --> tests/test_parse_actions.py:181:5
    |
179 | def test_parse_action_in_pipeline():
180 |     """Test action parsing integrated into clean_monster_record."""
181 |     from srd_builder.postprocess import clean_monster_record
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
182 |
183 |     monster = {
    |

PLR2004 Magic value used in comparison, consider replacing `5` with a constant variable
   --> tests/test_parse_actions.py:205:32
    |
203 |     action = result["actions"][0]
204 |     assert action["attack_type"] == "melee_weapon"
205 |     assert action["to_hit"] == 5
    |                                ^
206 |     assert action["reach"] == 5
207 |     assert action["damage"]["dice"] == "1d8+3"
    |

PLR2004 Magic value used in comparison, consider replacing `5` with a constant variable
   --> tests/test_parse_actions.py:206:31
    |
204 |     assert action["attack_type"] == "melee_weapon"
205 |     assert action["to_hit"] == 5
206 |     assert action["reach"] == 5
    |                               ^
207 |     assert action["damage"]["dice"] == "1d8+3"
208 |     assert action["damage"]["type"] == "bludgeoning"
    |

PLC0415 `import` should be at the top-level of a file
   --> tests/test_parse_actions.py:213:5
    |
211 | def test_parse_legendary_actions():
212 |     """Test action parsing applies to legendary actions."""
213 |     from srd_builder.postprocess import clean_monster_record
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
214 |
215 |     monster = {
    |

PLR2004 Magic value used in comparison, consider replacing `15` with a constant variable
   --> tests/test_parse_actions.py:236:35
    |
234 |     legendary = result["legendary_actions"][0]
235 |     assert legendary["attack_type"] == "melee_weapon"
236 |     assert legendary["to_hit"] == 15
    |                                   ^^
237 |     assert legendary["reach"] == 20
    |

PLR2004 Magic value used in comparison, consider replacing `20` with a constant variable
   --> tests/test_parse_actions.py:237:34
    |
235 |     assert legendary["attack_type"] == "melee_weapon"
236 |     assert legendary["to_hit"] == 15
237 |     assert legendary["reach"] == 20
    |                                  ^^
    |

PLC0415 `import` should be at the top-level of a file
   --> tests/test_parse_actions.py:242:5
    |
240 | def test_parse_reactions():
241 |     """Test action parsing applies to reactions."""
242 |     from srd_builder.postprocess import clean_monster_record
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
243 |
244 |     monster = {
    |

PLR2004 Magic value used in comparison, consider replacing `8` with a constant variable
   --> tests/test_parse_actions.py:265:34
    |
263 |     reaction = result["reactions"][0]
264 |     assert reaction["attack_type"] == "melee_weapon"
265 |     assert reaction["to_hit"] == 8
    |                                  ^
    |

PLC0415 `import` should be at the top-level of a file
   --> tests/test_parse_actions.py:270:5
    |
268 | def test_parse_constitution_saving_throw():
269 |     """Test full ability name expansion from short form."""
270 |     from srd_builder.parse_actions import parse_action_fields
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
271 |
272 |     action = {
    |

PLC0415 `import` should be at the top-level of a file
   --> tests/test_parse_actions.py:287:5
    |
285 | def test_parse_damage_without_spacing():
286 |     """Test damage parsing handles various spacing."""
287 |     from srd_builder.parse_actions import parse_action_fields
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
288 |
289 |     # Compact formatting
    |

PLR2004 Magic value used in comparison, consider replacing `13` with a constant variable
  --> tests/test_parse_equipment.py:37:36
   |
35 |         "max_bonus": 2,
36 |     }
37 |     assert item["strength_req"] == 13
   |                                    ^^
38 |     assert item["stealth_disadvantage"] is True
39 |     assert item["weight_lb"] == 40.0
   |

PLR2004 Magic value used in comparison, consider replacing `40.0` with a constant variable
  --> tests/test_parse_equipment.py:39:33
   |
37 |     assert item["strength_req"] == 13
38 |     assert item["stealth_disadvantage"] is True
39 |     assert item["weight_lb"] == 40.0
   |                                 ^^^^
40 |     assert item["weight_raw"] == "40 lb."
41 |     assert item["cost"] == {"amount": 50, "currency": "gp"}
   |

PLR2004 Magic value used in comparison, consider replacing `3.0` with a constant variable
   --> tests/test_parse_equipment.py:108:33
    |
106 |     assert item["weapon_type"] == "melee"
107 |     assert item["sub_category"] == "martial_melee"
108 |     assert item["weight_lb"] == 3.0
    |                                 ^^^
109 |     assert item["weight_raw"] == "3 lb."
    |

PLR2004 Magic value used in comparison, consider replacing `0.5` with a constant variable
   --> tests/test_parse_equipment.py:122:33
    |
120 |     item = parse_equipment_records([raw_item])[0]
121 |
122 |     assert item["weight_lb"] == 0.5
    |                                 ^^^
123 |     assert item["weight_raw"] == "1/2 lb."
124 |     assert item["cost"] == {"amount": 25, "currency": "gp"}
    |

PLR2004 Magic value used in comparison, consider replacing `3` with a constant variable
   --> tests/test_parse_spells.py:108:36
    |
106 |     assert result is not None
107 |     assert result["type"] == "slot"
108 |     assert result["base_level"] == 3
    |                                    ^
109 |     assert "1d6" in result["formula"]
    |

PLC0415 `import` should be at the top-level of a file
 --> tests/test_postprocess.py:2:5
  |
1 | def test_clean_monster_record_basic():
2 |     from srd_builder.postprocess import clean_monster_record
  |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
3 |
4 |     m = {
  |

PLC0415 `import` should be at the top-level of a file
 --> tests/test_postprocess_cr.py:2:5
  |
1 | def test_standardize_challenge_handles_strings_and_fractions():
2 |     from srd_builder.postprocess import standardize_challenge
  |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
3 |
4 |     monster = {"challenge_rating": "1/2"}
  |

PLR2004 Magic value used in comparison, consider replacing `0.5` with a constant variable
 --> tests/test_postprocess_cr.py:5:66
  |
4 |     monster = {"challenge_rating": "1/2"}
5 |     assert standardize_challenge(monster)["challenge_rating"] == 0.5
  |                                                                  ^^^
6 |
7 |     monster = {"challenge_rating": "10"}
  |

PLR2004 Magic value used in comparison, consider replacing `10` with a constant variable
  --> tests/test_postprocess_cr.py:8:66
   |
 7 |     monster = {"challenge_rating": "10"}
 8 |     assert standardize_challenge(monster)["challenge_rating"] == 10
   |                                                                  ^^
 9 |
10 |     monster = {"challenge_rating": 3.0}
   |

PLR2004 Magic value used in comparison, consider replacing `3` with a constant variable
  --> tests/test_postprocess_cr.py:11:66
   |
10 |     monster = {"challenge_rating": 3.0}
11 |     assert standardize_challenge(monster)["challenge_rating"] == 3
   |                                                                  ^
   |

PLC0415 `import` should be at the top-level of a file
 --> tests/test_postprocess_defenses.py:2:5
  |
1 | def test_structure_defenses_normalizes_strings():
2 |     from srd_builder.postprocess import structure_defenses
  |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
3 |
4 |     monster = {
  |

PLR2004 Magic value used in comparison, consider replacing `0.5` with a constant variable
  --> tests/test_postprocess_functions.py:76:66
   |
74 | def test_standardize_challenge_handles_fraction_and_numeric() -> None:
75 |     monster: dict[str, Any] = {"challenge_rating": "1/2"}
76 |     assert standardize_challenge(monster)["challenge_rating"] == 0.5
   |                                                                  ^^^
77 |
78 |     monster = {"challenge_rating": "5"}
   |

PLR2004 Magic value used in comparison, consider replacing `5` with a constant variable
  --> tests/test_postprocess_functions.py:79:66
   |
78 |     monster = {"challenge_rating": "5"}
79 |     assert standardize_challenge(monster)["challenge_rating"] == 5
   |                                                                  ^
80 |
81 |     monster = {"challenge_rating": 7.0}
   |

PLR2004 Magic value used in comparison, consider replacing `7` with a constant variable
  --> tests/test_postprocess_functions.py:82:66
   |
81 |     monster = {"challenge_rating": 7.0}
82 |     assert standardize_challenge(monster)["challenge_rating"] == 7
   |                                                                  ^
   |

PLC0415 `import` should be at the top-level of a file
 --> tests/test_postprocess_ids.py:2:5
  |
1 | def test_unify_simple_name_updates_monster_and_children():
2 |     from srd_builder.postprocess import unify_simple_name
  |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
3 |
4 |     monster = {
  |

PLC0415 `import` should be at the top-level of a file
 --> tests/test_postprocess_legendary.py:2:5
  |
1 |   def test_split_legendary_moves_actions():
2 | /     from srd_builder.postprocess import (
3 | |         polish_text_fields,
4 | |         rename_abilities_to_traits,
5 | |         split_legendary,
6 | |     )
  | |_____^
7 |
8 |       monster = {
  |

PLC0415 `import` should be at the top-level of a file
 --> tests/test_postprocess_text.py:2:5
  |
1 | def test_polish_text_fields_cleans_boilerplate_and_spacing():
2 |     from srd_builder.postprocess import polish_text_fields
  |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
3 |
4 |     monster = {
  |

PLR2004 Magic value used in comparison, consider replacing `3` with a constant variable
  --> tests/test_schema_versions.py:30:30
   |
28 |         # Version should be semantic versioning format (e.g., "1.1.0")
29 |         parts = schema["version"].split(".")
30 |         assert len(parts) == 3, f"{schema_file.name} version must be MAJOR.MINOR.PATCH format"
   |                              ^
31 |         assert all(p.isdigit() for p in parts), f"{schema_file.name} version parts must be numeric"
   |

PLR2004 Magic value used in comparison, consider replacing `3` with a constant variable
   --> tests/test_schema_versions.py:99:26
    |
 97 |     version = meta["$schema_version"]
 98 |     parts = version.split(".")
 99 |     assert len(parts) == 3, "$schema_version must be MAJOR.MINOR.PATCH format"
    |                          ^
100 |     assert all(p.isdigit() for p in parts), "$schema_version parts must be numeric"
    |

PLR2004 Magic value used in comparison, consider replacing `6` with a constant variable
  --> tests/test_validate_monsters.py:84:42
   |
82 |     # Check that some categories pass
83 |     assert results["Giants"]["complete"] is True
84 |     assert results["Giants"]["found"] == 6
   |                                          ^
85 |     assert results["Giants"]["missing"] == []
   |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
   --> tests/test_validate_monsters.py:101:42
    |
 99 |     results = validate_category_completeness(incomplete)
100 |     assert results["Giants"]["complete"] is False
101 |     assert results["Giants"]["found"] == 2
    |                                          ^
102 |     assert len(results["Giants"]["missing"]) == 4
    |

PLR2004 Magic value used in comparison, consider replacing `4` with a constant variable
   --> tests/test_validate_monsters.py:102:49
    |
100 |     assert results["Giants"]["complete"] is False
101 |     assert results["Giants"]["found"] == 2
102 |     assert len(results["Giants"]["missing"]) == 4
    |                                                 ^
    |

PLR2004 Magic value used in comparison, consider replacing `295` with a constant variable
   --> tests/test_validate_monsters.py:111:31
    |
109 |     result = validate_monster_count(monsters)
110 |
111 |     assert result["count"] == 295
    |                               ^^^
112 |     assert result["in_range"] is True
    |

PLR2004 Magic value used in comparison, consider replacing `100` with a constant variable
   --> tests/test_validate_monsters.py:121:31
    |
119 |     result = validate_monster_count(monsters)
120 |
121 |     assert result["count"] == 100
    |                               ^^^
122 |     assert result["in_range"] is False
    |

PLR2004 Magic value used in comparison, consider replacing `3` with a constant variable
   --> tests/test_validate_monsters.py:135:31
    |
134 |     assert result["all_unique"] is True
135 |     assert result["total"] == 3
    |                               ^
136 |     assert result["unique"] == 3
137 |     assert result["duplicates"] == {}
    |

PLR2004 Magic value used in comparison, consider replacing `3` with a constant variable
   --> tests/test_validate_monsters.py:136:32
    |
134 |     assert result["all_unique"] is True
135 |     assert result["total"] == 3
136 |     assert result["unique"] == 3
    |                                ^
137 |     assert result["duplicates"] == {}
    |

PLR2004 Magic value used in comparison, consider replacing `3` with a constant variable
   --> tests/test_validate_monsters.py:150:31
    |
149 |     assert result["all_unique"] is False
150 |     assert result["total"] == 3
    |                               ^
151 |     assert result["unique"] == 2
152 |     assert result["duplicates"] == {"Dragon": 2}
    |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
   --> tests/test_validate_monsters.py:151:32
    |
149 |     assert result["all_unique"] is False
150 |     assert result["total"] == 3
151 |     assert result["unique"] == 2
    |                                ^
152 |     assert result["duplicates"] == {"Dragon": 2}
    |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
   --> tests/test_validate_monsters.py:165:27
    |
163 |     result = validate_alphabetic_coverage(monsters)
164 |
165 |     assert result["A"] == 2
    |                           ^
166 |     assert result["B"] == 1
167 |     assert result["G"] == 1
    |

Found 232 errors.
No fixes available (2 hidden fixes can be enabled with the `--unsafe-fixes` option).
Error: Process completed with exit code 1.
Run ruff check .
PLR2004 Magic value used in comparison, consider replacing `300` with a constant variable
  --> scripts/analyze_reference.py:32:20
   |
31 |         # Monsters section starts around page 300
32 |         if page >= 300 and entry_type in ("h1", "h2", "h3", "h4"):
   |                    ^^^
33 |             # Extract text from subelements
34 |             text = ""
   |

PLC0415 `import` should be at the top-level of a file
  --> scripts/bump_version.py:56:5
   |
54 |     # Import after version update
55 |     sys.path.insert(0, str(Path.cwd() / "src"))
56 |     from srd_builder import __version__
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
57 |     from srd_builder.constants import SCHEMA_VERSION
58 |     from srd_builder.parse_equipment import parse_equipment_records
   |

PLC0415 `import` should be at the top-level of a file
  --> scripts/bump_version.py:57:5
   |
55 |     sys.path.insert(0, str(Path.cwd() / "src"))
56 |     from srd_builder import __version__
57 |     from srd_builder.constants import SCHEMA_VERSION
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
58 |     from srd_builder.parse_equipment import parse_equipment_records
59 |     from srd_builder.parse_monsters import parse_monster_records
   |

PLC0415 `import` should be at the top-level of a file
  --> scripts/bump_version.py:58:5
   |
56 |     from srd_builder import __version__
57 |     from srd_builder.constants import SCHEMA_VERSION
58 |     from srd_builder.parse_equipment import parse_equipment_records
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
59 |     from srd_builder.parse_monsters import parse_monster_records
60 |     from srd_builder.parse_spells import parse_spell_records
   |

PLC0415 `import` should be at the top-level of a file
  --> scripts/bump_version.py:59:5
   |
57 |     from srd_builder.constants import SCHEMA_VERSION
58 |     from srd_builder.parse_equipment import parse_equipment_records
59 |     from srd_builder.parse_monsters import parse_monster_records
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
60 |     from srd_builder.parse_spells import parse_spell_records
61 |     from srd_builder.postprocess import (
   |

PLC0415 `import` should be at the top-level of a file
  --> scripts/bump_version.py:60:5
   |
58 |     from srd_builder.parse_equipment import parse_equipment_records
59 |     from srd_builder.parse_monsters import parse_monster_records
60 |     from srd_builder.parse_spells import parse_spell_records
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
61 |     from srd_builder.postprocess import (
62 |         clean_equipment_record,
   |

PLC0415 `import` should be at the top-level of a file
  --> scripts/bump_version.py:61:5
   |
59 |       from srd_builder.parse_monsters import parse_monster_records
60 |       from srd_builder.parse_spells import parse_spell_records
61 | /     from srd_builder.postprocess import (
62 | |         clean_equipment_record,
63 | |         clean_monster_record,
64 | |         clean_spell_record,
65 | |     )
   | |_____^
66 |
67 |       fixtures = [
   |

PLR0912 Too many branches (25 > 12)
  --> scripts/compare_with_blackmoor.py:11:5
   |
11 | def main() -> None:  # noqa: C901
   |     ^^^^
12 |     """Run comparison analysis."""
13 |     ours_path = Path("dist/srd_5_1/data/monsters.json")
   |

PLR0915 Too many statements (132 > 50)
  --> scripts/compare_with_blackmoor.py:11:5
   |
11 | def main() -> None:  # noqa: C901
   |     ^^^^
12 |     """Run comparison analysis."""
13 |     ours_path = Path("dist/srd_5_1/data/monsters.json")
   |

PLR2004 Magic value used in comparison, consider replacing `20` with a constant variable
  --> scripts/compare_with_blackmoor.py:64:32
   |
62 |         for name in sorted(only_in_ours)[:20]:
63 |             print(f"  + {name}")
64 |         if len(only_in_ours) > 20:
   |                                ^^
65 |             print(f"  ... and {len(only_in_ours) - 20} more")
   |

PLR2004 Magic value used in comparison, consider replacing `11.5` with a constant variable
  --> scripts/count_monsters_in_pdf.py:46:35
   |
44 |                         # We look for 12pt, Bold, and reasonable text
45 |                         is_bold = (flags & 2**4) != 0  # Bold flag
46 |                         is_12pt = 11.5 <= size <= 12.5
   |                                   ^^^^
47 |                         is_calibri = "Calibri" in font
   |

PLR2004 Magic value used in comparison, consider replacing `12.5` with a constant variable
  --> scripts/count_monsters_in_pdf.py:46:51
   |
44 |                         # We look for 12pt, Bold, and reasonable text
45 |                         is_bold = (flags & 2**4) != 0  # Bold flag
46 |                         is_12pt = 11.5 <= size <= 12.5
   |                                                   ^^^^
47 |                         is_calibri = "Calibri" in font
   |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
  --> scripts/count_monsters_in_pdf.py:51:41
   |
49 |                         # Filter: reasonable monster name length and structure
50 |                         is_reasonable_name = (
51 |                             len(text) > 2
   |                                         ^
52 |                             and len(text) < 80
53 |                             and text[0].isupper()
   |

PLR2004 Magic value used in comparison, consider replacing `80` with a constant variable
  --> scripts/count_monsters_in_pdf.py:52:45
   |
50 |                         is_reasonable_name = (
51 |                             len(text) > 2
52 |                             and len(text) < 80
   |                                             ^^
53 |                             and text[0].isupper()
54 |                             and not text.endswith(":")
   |

PLR0915 Too many statements (55 > 50)
  --> scripts/count_monsters_in_pdf.py:66:5
   |
66 | def main() -> None:  # noqa: C901
   |     ^^^^
67 |     """Main entry point."""
68 |     print("=" * 80)
   |

PLR2004 Magic value used in comparison, consider replacing `20` with a constant variable
  --> scripts/count_monsters_in_pdf.py:94:20
   |
92 |             print(f"  • {name}")
93 |
94 |         if count > 20:
   |                    ^^
95 |             print(f"  ... and {count - 20} more")
   |

PLC0415 `import` should be at the top-level of a file
   --> scripts/count_monsters_in_pdf.py:108:5
    |
107 |     # Load our extraction
108 |     import json
    |     ^^^^^^^^^^^
109 |
110 |     our_path = Path("dist/srd_5_1/data/monsters.json")
    |

PLR0912 Too many branches (15 > 12)
  --> scripts/coverage_report.py:9:5
   |
 9 | def count_expected_from_raw(raw_path: Path) -> dict[str, int]:  # noqa: C901
   |     ^^^^^^^^^^^^^^^^^^^^^^^
10 |     """Count expected fields by analyzing raw PDF extraction."""
11 |     with open(raw_path) as f:
   |

PLR2004 Magic value used in comparison, consider replacing `10.8` with a constant variable
  --> scripts/coverage_report.py:91:62
   |
89 |         for i, block in enumerate(blocks):
90 |             text = " ".join(block.get("text", "").split()).strip()
91 |             if text == "Actions" and block.get("size", 0) >= 10.8:
   |                                                              ^^^^
92 |                 actions_idx = i
93 |                 actions_count += 1  # Monster has Actions section
   |

PLR2004 Magic value used in comparison, consider replacing `9.84` with a constant variable
   --> scripts/coverage_report.py:102:46
    |
100 |                 if (
101 |                     block.get("font") == "Calibri-BoldItalic"
102 |                     and block.get("size") == 9.84
    |                                              ^^^^
103 |                     and block.get("text", "").strip().endswith(".")
104 |                 ):
    |

PLR2004 Magic value used in comparison, consider replacing `10.8` with a constant variable
   --> scripts/coverage_report.py:117:64
    |
115 |         for block in blocks:
116 |             text = " ".join(block.get("text", "").split()).strip()
117 |             if text == "Reactions" and block.get("size", 0) >= 10.8:
    |                                                                ^^^^
118 |                 reactions_count += 1
119 |                 break
    |

PLR2004 Magic value used in comparison, consider replacing `100` with a constant variable
   --> scripts/coverage_report.py:237:23
    |
236 |         # Status indicator
237 |         if percent >= 100:
    |                       ^^^
238 |             status = "✓ Complete"
239 |         elif percent >= 90:
    |

PLR2004 Magic value used in comparison, consider replacing `90` with a constant variable
   --> scripts/coverage_report.py:239:25
    |
237 |         if percent >= 100:
238 |             status = "✓ Complete"
239 |         elif percent >= 90:
    |                         ^^
240 |             status = "✓ Excellent"
241 |         elif percent >= 75:
    |

PLR2004 Magic value used in comparison, consider replacing `75` with a constant variable
   --> scripts/coverage_report.py:241:25
    |
239 |         elif percent >= 90:
240 |             status = "✓ Excellent"
241 |         elif percent >= 75:
    |                         ^^
242 |             status = "△ Good"
243 |         elif percent >= 50:
    |

PLR2004 Magic value used in comparison, consider replacing `50` with a constant variable
   --> scripts/coverage_report.py:243:25
    |
241 |         elif percent >= 75:
242 |             status = "△ Good"
243 |         elif percent >= 50:
    |                         ^^
244 |             status = "△ Partial"
245 |         else:
    |

PLR2004 Magic value used in comparison, consider replacing `4` with a constant variable
  --> scripts/explore_pdf.py:29:66
   |
27 |                 size = span.get("size", 0.0)
28 |                 fonts[(font, round(size, 2))] += len(text)
29 |                 if not (bbox := span.get("bbox")) or len(bbox) < 4:
   |                                                                  ^
30 |                     continue
31 |                 column_edges.append(bbox[0])
   |

PLR0912 Too many branches (13 > 12)
  --> scripts/find_missing_monsters.py:49:5
   |
49 | def compare_sources() -> None:  # noqa: C901
   |     ^^^^^^^^^^^^^^^
50 |     """Compare our monsters against all available sources."""
51 |     print("=" * 80)
   |

PLR2004 Magic value used in comparison, consider replacing `20` with a constant variable
  --> scripts/find_missing_monsters.py:85:45
   |
83 |             for name in sorted(in_blackmoor_not_ours)[:20]:
84 |                 print(f"  • {name}")
85 |             if len(in_blackmoor_not_ours) > 20:
   |                                             ^^
86 |                 print(f"  ... and {len(in_blackmoor_not_ours) - 20} more")
   |

PLR2004 Magic value used in comparison, consider replacing `20` with a constant variable
  --> scripts/find_missing_monsters.py:92:45
   |
90 |             for name in sorted(in_ours_not_blackmoor)[:20]:
91 |                 print(f"  • {name}")
92 |             if len(in_ours_not_blackmoor) > 20:
   |                                             ^^
93 |                 print(f"  ... and {len(in_ours_not_blackmoor) - 20} more")
94 |     else:
   |

PLR0912 Too many branches (32 > 12)
  --> scripts/quality_report.py:11:5
   |
11 | def analyze_quality(parsed_path: Path, raw_path: Path) -> None:  # noqa: C901
   |     ^^^^^^^^^^^^^^^
12 |     """Generate quality analysis report."""
13 |     with open(parsed_path) as f:
   |

PLR0915 Too many statements (131 > 50)
  --> scripts/quality_report.py:11:5
   |
11 | def analyze_quality(parsed_path: Path, raw_path: Path) -> None:  # noqa: C901
   |     ^^^^^^^^^^^^^^^
12 |     """Generate quality analysis report."""
13 |     with open(parsed_path) as f:
   |

PLR2004 Magic value used in comparison, consider replacing `6` with a constant variable
  --> scripts/quality_report.py:76:34
   |
74 |     for count in sorted(ability_counts.keys()):
75 |         pct = (ability_counts[count] / total) * 100
76 |         status = "✅" if count == 6 else "⚠️"
   |                                   ^
77 |         print(f"{status} {count} abilities: {ability_counts[count]:3d} monsters ({pct:5.1f}%)")
78 |     print()
   |

PLR2004 Magic value used in comparison, consider replacing `5` with a constant variable
   --> scripts/quality_report.py:101:77
    |
100 |     # Check for suspiciously high counts
101 |     high_trait = [m["name"] for m in monsters if len(m.get("traits", [])) > 5]
    |                                                                             ^
102 |     high_action = [m["name"] for m in monsters if len(m.get("actions", [])) > 8]
    |

PLR2004 Magic value used in comparison, consider replacing `8` with a constant variable
   --> scripts/quality_report.py:102:79
    |
100 |     # Check for suspiciously high counts
101 |     high_trait = [m["name"] for m in monsters if len(m.get("traits", [])) > 5]
102 |     high_action = [m["name"] for m in monsters if len(m.get("actions", [])) > 8]
    |                                                                               ^
103 |
104 |     if high_trait:
    |

PLR2004 Magic value used in comparison, consider replacing `10` with a constant variable
   --> scripts/quality_report.py:151:37
    |
149 |         for trait in m.get("traits", []):
150 |             text = trait.get("text", "")
151 |             if text and len(text) < 10:
    |                                     ^^
152 |                 issues.append(f"{m['name']}: Short trait '{trait.get('name')}': {text}")
    |

PLR1722 Use `sys.exit()` instead of `exit`
   --> scripts/quality_report.py:204:9
    |
202 |     if not parsed_path.exists():
203 |         print(f"Error: {parsed_path} not found. Run build first.")
204 |         exit(1)
    |         ^^^^
205 |
206 |     analyze_quality(parsed_path, raw_path)
    |
help: Replace `exit` with `sys.exit()`

PLR0913 Too many arguments in function definition (10 > 5)
  --> src/srd_builder/build.py:85:5
   |
85 | def _generate_meta_json(
   |     ^^^^^^^^^^^^^^^^^^^
86 |     *,
87 |     pdf_hash: str | None,
   |

PLR0913 Too many arguments in function definition (8 > 5)
   --> src/srd_builder/build.py:176:5
    |
176 | def _write_datasets(
    |     ^^^^^^^^^^^^^^^
177 |     *,
178 |     ruleset: str,
    |

PLR0912 Too many branches (14 > 12)
   --> src/srd_builder/build.py:623:5
    |
623 | def build(  # noqa: C901
    |     ^^^^^
624 |     ruleset: str, output_format: str, out_dir: Path, bundle: bool = False
625 | ) -> Path:
    |

PLR0915 Too many statements (63 > 50)
   --> src/srd_builder/build.py:623:5
    |
623 | def build(  # noqa: C901
    |     ^^^^^
624 |     ruleset: str, output_format: str, out_dir: Path, bundle: bool = False
625 | ) -> Path:
    |

PLC0415 `import` should be at the top-level of a file
   --> src/srd_builder/build.py:658:9
    |
656 |     parsed_tables = None
657 |     if raw_tables:
658 |         from scripts.table_targets import TARGET_TABLES
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
659 |
660 |         targets_by_id = {t["id"]: t for t in TARGET_TABLES}
    |

PLR0912 Too many branches (16 > 12)
  --> src/srd_builder/column_mapper.py:94:9
   |
92 |         return None
93 |
94 |     def _fill_from_heuristics(self, row: list[str]) -> None:  # noqa: C901
   |         ^^^^^^^^^^^^^^^^^^^^^
95 |         """Fill unmapped columns using content heuristics.
   |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
   --> src/srd_builder/column_mapper.py:151:64
    |
150 |         # Properties/special is usually the last column
151 |         if "properties" not in self._column_map and len(row) > 2:
    |                                                                ^
152 |             # Don't map if last column looks like weight or cost
153 |             last_col = row[-1]
    |

PLR2004 Magic value used in comparison, consider replacing `10` with a constant variable
   --> src/srd_builder/column_mapper.py:170:20
    |
168 |         if self.category == "armor" and re.match(r"^\d{2}$", cell.strip()):
169 |             ac_val = int(cell.strip())
170 |             return 10 <= ac_val <= 20
    |                    ^^
171 |         return False
    |

PLR2004 Magic value used in comparison, consider replacing `20` with a constant variable
   --> src/srd_builder/column_mapper.py:170:36
    |
168 |         if self.category == "armor" and re.match(r"^\d{2}$", cell.strip()):
169 |             ac_val = int(cell.strip())
170 |             return 10 <= ac_val <= 20
    |                                    ^^
171 |         return False
    |

PLR0912 Too many branches (16 > 12)
   --> src/srd_builder/extract_equipment.py:153:5
    |
153 | def _get_section_markers(  # noqa: C901
    |     ^^^^^^^^^^^^^^^^^^^^
154 |     page: fitz.Page, page_num: int
155 | ) -> list[tuple[float, dict[str, str | None]]]:
    |

PLR2004 Magic value used in comparison, consider replacing `0.5` with a constant variable
   --> src/srd_builder/extract_equipment.py:178:54
    |
177 |                 # Section header (18pt)
178 |                 if abs(size - SECTION_HEADER_SIZE) < 0.5:
    |                                                      ^^^
179 |                     if "armor" in text:
180 |                         category = "armor"
    |

PLR2004 Magic value used in comparison, consider replacing `0.5` with a constant variable
   --> src/srd_builder/extract_equipment.py:191:59
    |
190 |                 # Subsection header (13.92pt)
191 |                 elif abs(size - SUBSECTION_HEADER_SIZE) < 0.5:
    |                                                           ^^^
192 |                     if "armor" in text:
193 |                         category = "armor"
    |

PLR0912 Too many branches (21 > 12)
   --> src/srd_builder/extract_equipment.py:207:5
    |
207 | def _detect_section_context(  # noqa: C901
    |     ^^^^^^^^^^^^^^^^^^^^^^^
208 |     page: fitz.Page, page_num: int
209 | ) -> dict[str, str | None] | None:
    |

PLR2004 Magic value used in comparison, consider replacing `0.5` with a constant variable
   --> src/srd_builder/extract_equipment.py:231:54
    |
230 |                 # Section header (18pt)
231 |                 if abs(size - SECTION_HEADER_SIZE) < 0.5:
    |                                                      ^^^
232 |                     if "armor" in text:
233 |                         category = "armor"
    |

PLR2004 Magic value used in comparison, consider replacing `0.5` with a constant variable
   --> src/srd_builder/extract_equipment.py:244:59
    |
243 |                 # Subsection header (13.92pt)
244 |                 elif abs(size - SUBSECTION_HEADER_SIZE) < 0.5:
    |                                                           ^^^
245 |                     if "armor" in text:
246 |                         # Armor subcategories also set the category
    |

PLR0911 Too many return statements (10 > 6)
   --> src/srd_builder/extract_equipment.py:272:5
    |
272 | def _is_equipment_row(row: list[str]) -> bool:  # noqa: C901
    |     ^^^^^^^^^^^^^^^^^
273 |     """Check if table row contains actual equipment (vs headers/descriptions).
    |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
   --> src/srd_builder/extract_equipment.py:282:30
    |
280 |     - Descriptive text
281 |     """
282 |     if not row or len(row) < 2:
    |                              ^
283 |         return False
    |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
   --> src/srd_builder/extract_equipment.py:315:20
    |
313 |     # Filter Food/Drink/Lodging incomplete extractions
314 |     # Single-word entries with only a price in second column are likely reference table fragments
315 |     if len(row) == 2 and len(name.split()) == 1:
    |                    ^
316 |         second_cell = row[1].strip()
317 |         # If second cell is just a price, this is likely a pricing reference, not equipment
    |

PLR2004 Magic value used in comparison, consider replacing `25` with a constant variable
   --> src/srd_builder/extract_equipment.py:346:74
    |
344 |         "ranged",
345 |     ]
346 |     if any(kw in name.lower() for kw in header_keywords) and len(name) < 25:
    |                                                                          ^^
347 |         return False
    |

PLR2004 Magic value used in comparison, consider replacing `100` with a constant variable
   --> src/srd_builder/extract_equipment.py:350:20
    |
349 |     # Skip descriptive text (usually long paragraphs)
350 |     if len(name) > 100:
    |                    ^^^
351 |         return False
    |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
   --> src/srd_builder/extract_equipment.py:364:19
    |
362 |     PyMuPDF sometimes splits names like "Longswor" + "d" → "Longsword"
363 |     """
364 |     if len(row) < 2:
    |                   ^
365 |         return row
    |

PLR2004 Magic value used in comparison, consider replacing `3` with a constant variable
   --> src/srd_builder/extract_equipment.py:371:34
    |
370 |     # If second column is very short (1-3 chars) and looks like a fragment, merge it
371 |     if second and len(second) <= 3 and second.isalpha() and not second.islower():
    |                                  ^
372 |         # Merge and remove second column
373 |         merged_name = first + second.lower()
    |

PLR2004 Magic value used in comparison, consider replacing `3` with a constant variable
   --> src/srd_builder/extract_equipment.py:377:34
    |
376 |     # If second column is very short and is lowercase, it's likely a fragment
377 |     if second and len(second) <= 3 and second.islower():
    |                                  ^
378 |         merged_name = first + second
379 |         return [merged_name] + row[2:]
    |

PLR2004 Magic value used in comparison, consider replacing `2.0` with a constant variable
   --> src/srd_builder/extract_monsters.py:265:31
    |
263 |     line_y = line["bbox"][1]  # Top Y of line
264 |     span_y = span["bbox"][1]  # Top Y of span
265 |     if abs(line_y - span_y) > 2.0:
    |                               ^^^
266 |         return False
    |

PLR2004 Magic value used in comparison, consider replacing `0.5` with a constant variable
   --> src/srd_builder/extract_monsters.py:272:43
    |
270 |     if line["font"] != span["font"]:
271 |         return False
272 |     if abs(line["size"] - span["size"]) > 0.5:
    |                                           ^^^
273 |         return False
    |

PLR2004 Magic value used in comparison, consider replacing `0.5` with a constant variable
   --> src/srd_builder/extract_monsters.py:385:60
    |
383 |         return False
384 |
385 |     if abs(line["size"] - config.monster_name_font_size) > 0.5:
    |                                                            ^^^
386 |         return False
    |

PLR2004 Magic value used in comparison, consider replacing `30` with a constant variable
   --> src/srd_builder/extract_monsters.py:444:33
    |
443 |         # Stop if we've gone too far vertically
444 |         if next_y - current_y > 30:
    |                                 ^^
445 |             break
    |

PLR2004 Magic value used in comparison, consider replacing `50` with a constant variable
   --> src/srd_builder/extract_monsters.py:496:46
    |
495 |     # Monster names are typically capitalized and not too long
496 |     return text[0].isupper() and len(text) < 50
    |                                              ^^
    |

PLC0415 `import` should be at the top-level of a file
   --> src/srd_builder/extract_monsters.py:596:5
    |
594 | def main() -> None:
595 |     """CLI entry point."""
596 |     import argparse
    |     ^^^^^^^^^^^^^^^
597 |
598 |     parser = argparse.ArgumentParser(description="Extract monsters from SRD PDF")
    |

PLC0415 `import` should be at the top-level of a file
   --> src/srd_builder/extract_pdf_metadata.py:102:5
    |
100 | def main() -> None:
101 |     """CLI entry point for testing."""
102 |     import argparse
    |     ^^^^^^^^^^^^^^^
103 |     import json
    |

PLC0415 `import` should be at the top-level of a file
   --> src/srd_builder/extract_pdf_metadata.py:103:5
    |
101 |     """CLI entry point for testing."""
102 |     import argparse
103 |     import json
    |     ^^^^^^^^^^^
104 |
105 |     parser = argparse.ArgumentParser(description="Extract metadata from SRD PDF")
    |

PLR0912 Too many branches (19 > 12)
   --> src/srd_builder/extract_spells.py:103:5
    |
103 | def _extract_page_spells(  # noqa: C901
    |     ^^^^^^^^^^^^^^^^^^^^
104 |     page: fitz.Page, page_num: int, config: ExtractionConfig
105 | ) -> list[dict[str, Any]]:
    |

PLR2004 Magic value used in comparison, consider replacing `0.5` with a constant variable
   --> src/srd_builder/extract_spells.py:135:92
    |
134 |                 # Detect spell name (12pt GillSans-SemiBold)
135 |                 if config.spell_name_font in font and abs(size - config.spell_name_size) < 0.5:
    |                                                                                            ^^^
136 |                     # Save previous spell
137 |                     if current_spell:
    |

PLR2004 Magic value used in comparison, consider replacing `50` with a constant variable
   --> src/srd_builder/extract_spells.py:253:28
    |
252 |             # Merge if: current incomplete AND next has no name (continuation)
253 |             if (desc_len < 50 or header_len < 30) and not next_has_name:
    |                            ^^
254 |                 # Merge with next spell's content
255 |                 current["header_text"] += " " + next_spell.get("header_text", "")
    |

PLR2004 Magic value used in comparison, consider replacing `30` with a constant variable
   --> src/srd_builder/extract_spells.py:253:47
    |
252 |             # Merge if: current incomplete AND next has no name (continuation)
253 |             if (desc_len < 50 or header_len < 30) and not next_has_name:
    |                                               ^^
254 |                 # Merge with next spell's content
255 |                 current["header_text"] += " " + next_spell.get("header_text", "")
    |

PLC0415 `import` should be at the top-level of a file
   --> src/srd_builder/extract_spells.py:271:5
    |
269 | def main() -> None:  # pragma: no cover
270 |     """CLI entry point for spell extraction."""
271 |     import sys
    |     ^^^^^^^^^^
272 |
273 |     if len(sys.argv) != 2:
    |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
   --> src/srd_builder/extract_spells.py:273:25
    |
271 |     import sys
272 |
273 |     if len(sys.argv) != 2:
    |                         ^
274 |         print(f"Usage: {sys.argv[0]} <pdf_path>")
275 |         sys.exit(1)
    |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
   --> src/srd_builder/extract_tables.py:208:33
    |
206 |         for table in tables:
207 |             extracted = table.extract()
208 |             if len(extracted) < 2:  # Need header + data
    |                                 ^
209 |                 continue
    |

PLR0911 Too many return statements (23 > 6)
   --> src/srd_builder/extract_tables.py:274:9
    |
272 |         )
273 |
274 |     def _extract_manual(
    |         ^^^^^^^^^^^^^^^
275 |         self, target: TableTarget, page: fitz.Page, page_num: int
276 |     ) -> RawTable:  # noqa: C901
    |

PLR0912 Too many branches (24 > 12)
   --> src/srd_builder/extract_tables.py:274:9
    |
272 |         )
273 |
274 |     def _extract_manual(
    |         ^^^^^^^^^^^^^^^
275 |         self, target: TableTarget, page: fitz.Page, page_num: int
276 |     ) -> RawTable:  # noqa: C901
    |

PLR2004 Magic value used in comparison, consider replacing `4` with a constant variable
   --> src/srd_builder/extract_tables.py:374:25
    |
372 |         rows = []
373 |         for level in range(1, 21):
374 |             if level <= 4:
    |                         ^
375 |                 bonus = "+2"
376 |             elif level <= 8:
    |

PLR2004 Magic value used in comparison, consider replacing `8` with a constant variable
   --> src/srd_builder/extract_tables.py:376:27
    |
374 |             if level <= 4:
375 |                 bonus = "+2"
376 |             elif level <= 8:
    |                           ^
377 |                 bonus = "+3"
378 |             elif level <= 12:
    |

PLR2004 Magic value used in comparison, consider replacing `12` with a constant variable
   --> src/srd_builder/extract_tables.py:378:27
    |
376 |             elif level <= 8:
377 |                 bonus = "+3"
378 |             elif level <= 12:
    |                           ^^
379 |                 bonus = "+4"
380 |             elif level <= 16:
    |

PLR2004 Magic value used in comparison, consider replacing `16` with a constant variable
   --> src/srd_builder/extract_tables.py:380:27
    |
378 |             elif level <= 12:
379 |                 bonus = "+4"
380 |             elif level <= 16:
    |                           ^^
381 |                 bonus = "+5"
382 |             else:
    |

PLC0415 `import` should be at the top-level of a file
    --> src/srd_builder/extract_tables.py:1450:5
     |
1448 |         skip_failures: If True, skip tables that fail extraction
1449 |     """
1450 |     import json
     |     ^^^^^^^^^^^
1451 |
1452 |     with TableExtractor(pdf_path) as extractor:
     |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
    --> src/srd_builder/extract_tables.py:1484:24
     |
1482 |     logging.basicConfig(level=logging.INFO, format="%(levelname)s: %(message)s")
1483 |
1484 |     if len(sys.argv) < 2:
     |                        ^
1485 |         print("Usage: python -m srd_builder.extract_tables <pdf_path> [output_path]")
1486 |         sys.exit(1)
     |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
    --> src/srd_builder/extract_tables.py:1489:50
     |
1488 |     pdf_path = sys.argv[1]
1489 |     output_path = sys.argv[2] if len(sys.argv) > 2 else "tables_raw.json"
     |                                                  ^
1490 |
1491 |     extract_tables_to_json(pdf_path, output_path)
     |

PLR0913 Too many arguments in function definition (7 > 5)
   --> src/srd_builder/indexer.py:379:5
    |
379 | def build_indexes(  # noqa: C901
    |     ^^^^^^^^^^^^^
380 |     monsters: list[dict[str, Any]],
381 |     spells: list[dict[str, Any]] | None = None,
    |

PLR0912 Too many branches (17 > 12)
   --> src/srd_builder/indexer.py:379:5
    |
379 | def build_indexes(  # noqa: C901
    |     ^^^^^^^^^^^^^
380 |     monsters: list[dict[str, Any]],
381 |     spells: list[dict[str, Any]] | None = None,
    |

PLR0915 Too many statements (83 > 50)
   --> src/srd_builder/indexer.py:379:5
    |
379 | def build_indexes(  # noqa: C901
    |     ^^^^^^^^^^^^^
380 |     monsters: list[dict[str, Any]],
381 |     spells: list[dict[str, Any]] | None = None,
    |

PLR0912 Too many branches (16 > 12)
  --> src/srd_builder/parse_actions.py:29:5
   |
29 | def parse_action_fields(action: dict[str, Any]) -> dict[str, Any]:  # noqa: C901
   |     ^^^^^^^^^^^^^^^^^^^
30 |     """Parse structured fields from action text.
   |

PLR0915 Too many statements (55 > 50)
  --> src/srd_builder/parse_actions.py:29:5
   |
29 | def parse_action_fields(action: dict[str, Any]) -> dict[str, Any]:  # noqa: C901
   |     ^^^^^^^^^^^^^^^^^^^
30 |     """Parse structured fields from action text.
   |

PLR0912 Too many branches (16 > 12)
  --> src/srd_builder/parse_equipment.py:30:5
   |
30 | def parse_equipment_records(raw_items: list[dict[str, Any]]) -> list[dict[str, Any]]:  # noqa: C901
   |     ^^^^^^^^^^^^^^^^^^^^^^^
31 |     """Parse raw equipment items into structured records."""
   |

PLR0911 Too many return statements (7 > 6)
  --> src/srd_builder/parse_monsters.py:32:5
   |
32 | def _coerce_int(value: Any) -> int | None:
   |     ^^^^^^^^^^^
33 |     if value is None:
34 |         return None
   |

PLR2004 Magic value used in comparison, consider replacing `9.0` with a constant variable
   --> src/srd_builder/parse_monsters.py:420:29
    |
419 |         # Only collect regular text blocks (9.84pt Calibri)
420 |         if text and size >= 9.0 and size <= 10.0 and "Calibri" in font:
    |                             ^^^
421 |             # Clean whitespace: tabs, newlines, carriage returns
422 |             cleaned_text = " ".join(text.split())
    |

PLR2004 Magic value used in comparison, consider replacing `10.0` with a constant variable
   --> src/srd_builder/parse_monsters.py:420:45
    |
419 |         # Only collect regular text blocks (9.84pt Calibri)
420 |         if text and size >= 9.0 and size <= 10.0 and "Calibri" in font:
    |                                             ^^^^
421 |             # Clean whitespace: tabs, newlines, carriage returns
422 |             cleaned_text = " ".join(text.split())
    |

PLR0912 Too many branches (46 > 12)
   --> src/srd_builder/parse_monsters.py:433:5
    |
433 | def parse_monster_from_blocks(monster: dict[str, Any]) -> dict[str, Any]:  # noqa: C901
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^
434 |     """Parse monster fields from blocks array (v0.3.0 extraction format).
    |

PLR0915 Too many statements (159 > 50)
   --> src/srd_builder/parse_monsters.py:433:5
    |
433 | def parse_monster_from_blocks(monster: dict[str, Any]) -> dict[str, Any]:  # noqa: C901
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^
434 |     """Parse monster fields from blocks array (v0.3.0 extraction format).
    |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
   --> src/srd_builder/parse_monsters.py:470:38
    |
468 |         # Size/type/alignment line (Calibri-Italic, right after name)
469 |         # Handle split across multiple Italic blocks (e.g., Kraken, Mummy, Unicorn)
470 |         if "Italic" in font and i <= 2:
    |                                      ^
471 |             # Collect all consecutive Italic blocks (may be split with comma blocks between)
472 |             italic_parts = [text]
    |

PLR2004 Magic value used in comparison, consider replacing `6` with a constant variable
   --> src/srd_builder/parse_monsters.py:514:42
    |
512 |                 # Case 1: Next block is Bold and looks like label continuation (e.g., "Sense" + "s")
513 |                 if "Bold" in peek_font and peek_text and not peek_text[0].isdigit():
514 |                     if len(peek_text) <= 6 and not any(c in peek_text for c in "():,"):
    |                                          ^
515 |                         label_clean += " " + " ".join(peek_text.split()).lower()
516 |                         j += 1
    |

PLR2004 Magic value used in comparison, consider replacing `6` with a constant variable
   --> src/srd_builder/parse_monsters.py:601:45
    |
600 |                     # Safety: stop after collecting reasonable amount (up to 6 blocks for edge cases)
601 |                     if len(values_parts) >= 6:
    |                                             ^
602 |                         break
    |

PLR1714 Consider merging multiple comparisons: `label_clean in {"senses", "sense s"}`.
   --> src/srd_builder/parse_monsters.py:626:16
    |
625 |             # Senses
626 |             if label_clean == "senses" or label_clean == "sense s":
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
627 |                 parsed["senses"] = next_text
628 |                 i = j
    |
help: Merge multiple comparisons

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
   --> src/srd_builder/parse_monsters.py:700:21
    |
699 |     parts = [p.strip() for p in text.split(",")]
700 |     if len(parts) < 2:
    |                     ^
701 |         return {}
    |

PLR2004 Magic value used in comparison, consider replacing `6` with a constant variable
   --> src/srd_builder/parse_monsters.py:730:23
    |
728 |         scores.append(int(match.group(1)))
729 |
730 |     if len(scores) != 6:
    |                       ^
731 |         return {}
    |

PLR0912 Too many branches (15 > 12)
   --> src/srd_builder/parse_monsters.py:743:5
    |
743 | def _parse_traits_and_actions(  # noqa: C901
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^
744 |     blocks: list[dict],
745 | ) -> tuple[list[dict], list[dict], list[dict], list[dict]]:
    |

PLR0915 Too many statements (62 > 50)
   --> src/srd_builder/parse_monsters.py:743:5
    |
743 | def _parse_traits_and_actions(  # noqa: C901
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^
744 |     blocks: list[dict],
745 | ) -> tuple[list[dict], list[dict], list[dict], list[dict]]:
    |

PLR2004 Magic value used in comparison, consider replacing `10.8` with a constant variable
   --> src/srd_builder/parse_monsters.py:775:25
    |
774 |         # Detect section headers
775 |         if font_size >= 10.8 and "bold" in font.lower():
    |                         ^^^^
776 |             if text.lower() == "actions":
777 |                 current_section = "actions"
    |

PLR2004 Magic value used in comparison, consider replacing `9.5` with a constant variable
   --> src/srd_builder/parse_monsters.py:796:26
    |
795 |         is_name_block = (
796 |             font_size >= 9.5
    |                          ^^^
797 |             and text.endswith(".")
798 |             and (is_bold_italic or (is_just_bold and is_legendary_section))
    |

PLR2004 Magic value used in comparison, consider replacing `10.8` with a constant variable
   --> src/srd_builder/parse_monsters.py:822:38
    |
821 |                 # Stop at section header
822 |                 if next_font_size >= 10.8 and "bold" in next_font.lower():
    |                                      ^^^^
823 |                     break
    |

PLR2004 Magic value used in comparison, consider replacing `9.5` with a constant variable
   --> src/srd_builder/parse_monsters.py:826:38
    |
825 |                 # Stop at next BoldItalic name (trait/action)
826 |                 if next_font_size >= 9.5 and next_is_bold_italic and next_text.endswith("."):
    |                                      ^^^
827 |                     break
    |

PLR2004 Magic value used in comparison, consider replacing `9.5` with a constant variable
   --> src/srd_builder/parse_monsters.py:831:39
    |
829 |                 # Stop at next Bold name (legendary action) if in legendary section
830 |                 if (
831 |                     next_font_size >= 9.5
    |                                       ^^^
832 |                     and next_is_just_bold
833 |                     and is_legendary_section
    |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
  --> src/srd_builder/parse_spells.py:50:30
   |
48 |             # Split at the SRD marker - everything after is the description
49 |             parts = re.split(r"System\s+Reference\s+Document\s+5\.1\s+\d+", header_text, maxsplit=1)
50 |             if len(parts) == 2:
   |                              ^
51 |                 header_text = parts[0].strip()
52 |                 extracted_desc = parts[1].strip()
   |

PLC0415 `import` should be at the top-level of a file
   --> src/srd_builder/parse_spells.py:140:5
    |
138 |         Tuple of (level, school)
139 |     """
140 |     import re
    |     ^^^^^^^^^
141 |
142 |     text = level_school_text.lower().strip()
    |

PLC0415 `import` should be at the top-level of a file
   --> src/srd_builder/parse_spells.py:182:5
    |
180 |         Structured range object or string for special cases
181 |     """
182 |     import re
    |     ^^^^^^^^^
183 |
184 |     text_lower = text.lower().strip()
    |

PLC0415 `import` should be at the top-level of a file
   --> src/srd_builder/parse_spells.py:242:5
    |
240 |         Components dict with verbal, somatic, material, material_description
241 |     """
242 |     import re
    |     ^^^^^^^^^
243 |
244 |     components: dict[str, Any] = {
    |

PLC0415 `import` should be at the top-level of a file
   --> src/srd_builder/parse_spells.py:267:5
    |
265 |         Effects dict (may be empty if no extractable effects)
266 |     """
267 |     import re
    |     ^^^^^^^^^
268 |
269 |     effects: dict[str, Any] = {}
    |

PLC0415 `import` should be at the top-level of a file
   --> src/srd_builder/parse_spells.py:345:5
    |
343 |         Scaling dict or None if spell doesn't scale
344 |     """
345 |     import re
    |     ^^^^^^^^^
346 |
347 |     # Check for "At Higher Levels" section (slot scaling)
    |

PLR0911 Too many return statements (8 > 6)
  --> src/srd_builder/parse_tables.py:32:5
   |
32 | def detect_column_type(values: list[Any]) -> str:
   |     ^^^^^^^^^^^^^^^^^^
33 |     """Detect the type of a column based on its values.
   |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
   --> src/srd_builder/parse_tables.py:176:24
    |
174 |     logging.basicConfig(level=logging.INFO, format="%(levelname)s: %(message)s")
175 |
176 |     if len(sys.argv) < 2:
    |                        ^
177 |         print("Usage: python -m srd_builder.parse_tables <raw_tables.json> [output.json]")
178 |         sys.exit(1)
    |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
   --> src/srd_builder/parse_tables.py:181:50
    |
180 |     raw_path = sys.argv[1]
181 |     output_path = sys.argv[2] if len(sys.argv) > 2 else "tables.json"
    |                                                  ^
182 |
183 |     parse_tables(raw_path, output_path)
    |

PLC0415 `import` should be at the top-level of a file
   --> src/srd_builder/postprocess.py:305:5
    |
303 |     action text while preserving original text for fallback.
304 |     """
305 |     from srd_builder.parse_actions import parse_action_fields
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
306 |
307 |     patched = {**monster}
    |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
   --> src/srd_builder/table_indexer.py:150:44
    |
148 |                 rows = table.extract()
149 |
150 |                 if not rows or len(rows) < 2:  # Need at least header + 1 data row
    |                                            ^
151 |                     continue
    |

PLR2004 Magic value used in comparison, consider replacing `18.0` with a constant variable
   --> src/srd_builder/table_indexer.py:208:36
    |
207 |                         # Large headers (18pt+) are usually section markers
208 |                         if size >= 18.0 and len(text) > 3:
    |                                    ^^^^
209 |                             return text
    |

PLR2004 Magic value used in comparison, consider replacing `3` with a constant variable
   --> src/srd_builder/table_indexer.py:208:57
    |
207 |                         # Large headers (18pt+) are usually section markers
208 |                         if size >= 18.0 and len(text) > 3:
    |                                                         ^
209 |                             return text
    |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
   --> src/srd_builder/table_indexer.py:250:27
    |
248 |             # Check if multiple keywords appear in headers
249 |             matches = sum(1 for kw in keywords if kw in header_text)
250 |             if matches >= 2:  # At least 2 keywords match
    |                           ^
251 |                 return table_id
    |

PLC0415 `import` should be at the top-level of a file
   --> src/srd_builder/table_indexer.py:328:17
    |
326 |         try:
327 |             try:
328 |                 from scripts.table_targets import TARGET_TABLES
    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
329 |             except ModuleNotFoundError:
330 |                 import sys
    |

PLC0415 `import` should be at the top-level of a file
   --> src/srd_builder/table_indexer.py:330:17
    |
328 |                 from scripts.table_targets import TARGET_TABLES
329 |             except ModuleNotFoundError:
330 |                 import sys
    |                 ^^^^^^^^^^
331 |                 from pathlib import Path
    |

PLC0415 `import` should be at the top-level of a file
   --> src/srd_builder/table_indexer.py:331:17
    |
329 |             except ModuleNotFoundError:
330 |                 import sys
331 |                 from pathlib import Path
    |                 ^^^^^^^^^^^^^^^^^^^^^^^^
332 |
333 |                 sys.path.insert(0, str(Path(__file__).parent.parent.parent))
    |

PLC0415 `import` should be at the top-level of a file
   --> src/srd_builder/table_indexer.py:334:17
    |
333 |                 sys.path.insert(0, str(Path(__file__).parent.parent.parent))
334 |                 from scripts.table_targets import TARGET_TABLES
    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
335 |
336 |             for target in TARGET_TABLES:
    |

PLC0415 `import` should be at the top-level of a file
   --> src/srd_builder/table_indexer.py:389:9
    |
387 |             output_path: Path for output JSON file
388 |         """
389 |         import json
    |         ^^^^^^^^^^^
390 |
391 |         report = self.generate_report()
    |

PLC0415 `import` should be at the top-level of a file
 --> tests/test_ability_modifiers.py:6:5
  |
4 | def test_add_ability_modifiers_calculates_correctly():
5 |     """Verify D&D 5e modifier formula: (score - 10) // 2."""
6 |     from srd_builder.postprocess import add_ability_modifiers
  |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
7 |
8 |     monster = {
  |

PLR2004 Magic value used in comparison, consider replacing `21` with a constant variable
  --> tests/test_ability_modifiers.py:22:52
   |
20 |     result = add_ability_modifiers(monster)
21 |
22 |     assert result["ability_scores"]["strength"] == 21
   |                                                    ^^
23 |     assert result["ability_scores"]["strength_modifier"] == 5
   |

PLR2004 Magic value used in comparison, consider replacing `5` with a constant variable
  --> tests/test_ability_modifiers.py:23:61
   |
22 |     assert result["ability_scores"]["strength"] == 21
23 |     assert result["ability_scores"]["strength_modifier"] == 5
   |                                                             ^
24 |
25 |     assert result["ability_scores"]["dexterity"] == 10
   |

PLR2004 Magic value used in comparison, consider replacing `10` with a constant variable
  --> tests/test_ability_modifiers.py:25:53
   |
23 |     assert result["ability_scores"]["strength_modifier"] == 5
24 |
25 |     assert result["ability_scores"]["dexterity"] == 10
   |                                                     ^^
26 |     assert result["ability_scores"]["dexterity_modifier"] == 0
   |

PLR2004 Magic value used in comparison, consider replacing `18` with a constant variable
  --> tests/test_ability_modifiers.py:28:56
   |
26 |     assert result["ability_scores"]["dexterity_modifier"] == 0
27 |
28 |     assert result["ability_scores"]["constitution"] == 18
   |                                                        ^^
29 |     assert result["ability_scores"]["constitution_modifier"] == 4
   |

PLR2004 Magic value used in comparison, consider replacing `4` with a constant variable
  --> tests/test_ability_modifiers.py:29:65
   |
28 |     assert result["ability_scores"]["constitution"] == 18
29 |     assert result["ability_scores"]["constitution_modifier"] == 4
   |                                                                 ^
30 |
31 |     assert result["ability_scores"]["intelligence"] == 8
   |

PLR2004 Magic value used in comparison, consider replacing `8` with a constant variable
  --> tests/test_ability_modifiers.py:31:56
   |
29 |     assert result["ability_scores"]["constitution_modifier"] == 4
30 |
31 |     assert result["ability_scores"]["intelligence"] == 8
   |                                                        ^
32 |     assert result["ability_scores"]["intelligence_modifier"] == -1
   |

PLR2004 Magic value used in comparison, consider replacing `13` with a constant variable
  --> tests/test_ability_modifiers.py:34:50
   |
32 |     assert result["ability_scores"]["intelligence_modifier"] == -1
33 |
34 |     assert result["ability_scores"]["wisdom"] == 13
   |                                                  ^^
35 |     assert result["ability_scores"]["wisdom_modifier"] == 1
   |

PLR2004 Magic value used in comparison, consider replacing `6` with a constant variable
  --> tests/test_ability_modifiers.py:37:52
   |
35 |     assert result["ability_scores"]["wisdom_modifier"] == 1
36 |
37 |     assert result["ability_scores"]["charisma"] == 6
   |                                                    ^
38 |     assert result["ability_scores"]["charisma_modifier"] == -2
   |

PLR2004 Magic value used in comparison, consider replacing `-2` with a constant variable
  --> tests/test_ability_modifiers.py:38:61
   |
37 |     assert result["ability_scores"]["charisma"] == 6
38 |     assert result["ability_scores"]["charisma_modifier"] == -2
   |                                                             ^^
   |

PLC0415 `import` should be at the top-level of a file
  --> tests/test_ability_modifiers.py:43:5
   |
41 | def test_add_ability_modifiers_handles_missing_scores():
42 |     """Handle monsters with no ability scores."""
43 |     from srd_builder.postprocess import add_ability_modifiers
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
44 |
45 |     monster = {"name": "Test", "ability_scores": {}}
   |

PLC0415 `import` should be at the top-level of a file
  --> tests/test_ability_modifiers.py:56:5
   |
54 | def test_add_ability_modifiers_handles_partial_scores():
55 |     """Handle monsters with only some ability scores."""
56 |     from srd_builder.postprocess import add_ability_modifiers
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
57 |
58 |     monster = {
   |

PLR2004 Magic value used in comparison, consider replacing `16` with a constant variable
  --> tests/test_ability_modifiers.py:68:52
   |
66 |     result = add_ability_modifiers(monster)
67 |
68 |     assert result["ability_scores"]["strength"] == 16
   |                                                    ^^
69 |     assert result["ability_scores"]["strength_modifier"] == 3
70 |     assert result["ability_scores"]["intelligence"] == 3
   |

PLR2004 Magic value used in comparison, consider replacing `3` with a constant variable
  --> tests/test_ability_modifiers.py:69:61
   |
68 |     assert result["ability_scores"]["strength"] == 16
69 |     assert result["ability_scores"]["strength_modifier"] == 3
   |                                                             ^
70 |     assert result["ability_scores"]["intelligence"] == 3
71 |     assert result["ability_scores"]["intelligence_modifier"] == -4
   |

PLR2004 Magic value used in comparison, consider replacing `3` with a constant variable
  --> tests/test_ability_modifiers.py:70:56
   |
68 |     assert result["ability_scores"]["strength"] == 16
69 |     assert result["ability_scores"]["strength_modifier"] == 3
70 |     assert result["ability_scores"]["intelligence"] == 3
   |                                                        ^
71 |     assert result["ability_scores"]["intelligence_modifier"] == -4
72 |     assert "dexterity_modifier" not in result["ability_scores"]
   |

PLR2004 Magic value used in comparison, consider replacing `-4` with a constant variable
  --> tests/test_ability_modifiers.py:71:65
   |
69 |     assert result["ability_scores"]["strength_modifier"] == 3
70 |     assert result["ability_scores"]["intelligence"] == 3
71 |     assert result["ability_scores"]["intelligence_modifier"] == -4
   |                                                                 ^^
72 |     assert "dexterity_modifier" not in result["ability_scores"]
   |

PLC0415 `import` should be at the top-level of a file
  --> tests/test_ability_modifiers.py:77:5
   |
75 | def test_add_ability_modifiers_in_pipeline():
76 |     """Verify modifiers are added during clean_monster_record."""
77 |     from srd_builder.postprocess import clean_monster_record
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
78 |
79 |     monster = {
   |

PLR2004 Magic value used in comparison, consider replacing `14` with a constant variable
   --> tests/test_ability_modifiers.py:99:52
    |
 98 |     # Verify original scores preserved
 99 |     assert result["ability_scores"]["strength"] == 14
    |                                                    ^^
100 |     assert result["ability_scores"]["wisdom"] == 8
    |

PLR2004 Magic value used in comparison, consider replacing `8` with a constant variable
   --> tests/test_ability_modifiers.py:100:50
    |
 98 |     # Verify original scores preserved
 99 |     assert result["ability_scores"]["strength"] == 14
100 |     assert result["ability_scores"]["wisdom"] == 8
    |                                                  ^
101 |
102 |     # Verify modifiers calculated
    |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
   --> tests/test_ability_modifiers.py:103:61
    |
102 |     # Verify modifiers calculated
103 |     assert result["ability_scores"]["strength_modifier"] == 2
    |                                                             ^
104 |     assert result["ability_scores"]["dexterity_modifier"] == 1
105 |     assert result["ability_scores"]["constitution_modifier"] == 3
    |

PLR2004 Magic value used in comparison, consider replacing `3` with a constant variable
   --> tests/test_ability_modifiers.py:105:65
    |
103 |     assert result["ability_scores"]["strength_modifier"] == 2
104 |     assert result["ability_scores"]["dexterity_modifier"] == 1
105 |     assert result["ability_scores"]["constitution_modifier"] == 3
    |                                                                 ^
106 |     assert result["ability_scores"]["intelligence_modifier"] == 0
107 |     assert result["ability_scores"]["wisdom_modifier"] == -1
    |

PLR2004 Magic value used in comparison, consider replacing `-2` with a constant variable
   --> tests/test_ability_modifiers.py:108:61
    |
106 |     assert result["ability_scores"]["intelligence_modifier"] == 0
107 |     assert result["ability_scores"]["wisdom_modifier"] == -1
108 |     assert result["ability_scores"]["charisma_modifier"] == -2
    |                                                             ^^
    |

PLC0415 `import` should be at the top-level of a file
   --> tests/test_ability_modifiers.py:113:5
    |
111 | def test_ability_modifiers_edge_cases():
112 |     """Test edge cases for ability scores."""
113 |     from srd_builder.postprocess import add_ability_modifiers
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
114 |
115 |     # Score of 1 (common for constructs' mental stats)
    |

PLR2004 Magic value used in comparison, consider replacing `-5` with a constant variable
   --> tests/test_ability_modifiers.py:118:65
    |
116 |     monster = {"ability_scores": {"intelligence": 1}}  # -5
117 |     result = add_ability_modifiers(monster)
118 |     assert result["ability_scores"]["intelligence_modifier"] == -5
    |                                                                 ^^
119 |
120 |     # Score of 30 (legendary creatures)
    |

PLR2004 Magic value used in comparison, consider replacing `10` with a constant variable
   --> tests/test_ability_modifiers.py:123:61
    |
121 |     monster = {"ability_scores": {"strength": 30}}  # +10
122 |     result = add_ability_modifiers(monster)
123 |     assert result["ability_scores"]["strength_modifier"] == 10
    |                                                             ^^
124 |
125 |     # Odd scores
    |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
   --> tests/test_ability_modifiers.py:128:62
    |
126 |     monster = {"ability_scores": {"dexterity": 15}}  # +2
127 |     result = add_ability_modifiers(monster)
128 |     assert result["ability_scores"]["dexterity_modifier"] == 2
    |                                                              ^
    |

PLR0915 Too many statements (57 > 50)
  --> tests/test_build_pipeline.py:11:5
   |
11 | def test_build_pipeline(tmp_path, monkeypatch):
   |     ^^^^^^^^^^^^^^^^^^^
12 |     class _DummyValidator:
13 |         def __init__(self, _schema):
   |

PLC0415 `import` should be at the top-level of a file
  --> tests/test_build_pipeline.py:21:5
   |
19 |     monkeypatch.setattr(jsonschema, "Draft202012Validator", _DummyValidator)
20 |
21 |     from srd_builder import validate as validate_module
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
22 |
23 |     ruleset = "srd_5_1"
   |

PLC0415 `import` should be at the top-level of a file
  --> tests/test_build_pipeline.py:41:5
   |
40 |     # Mock extract_monsters to avoid PDF parsing issues with fake PDF
41 |     from srd_builder import build as build_module
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
42 |
43 |     def mock_extract_monsters(_pdf_path):
   |

PLR2004 Magic value used in comparison, consider replacing `63` with a constant variable
  --> tests/test_context_tracker.py:21:40
   |
20 |     assert tracker.current() == {"category": "armor", "subcategory": "medium"}
21 |     assert tracker.history[-1].page == 63
   |                                        ^^
22 |     assert tracker.history[-1].subcategory == "medium"
   |

PLR2004 Magic value used in comparison, consider replacing `296` with a constant variable
  --> tests/test_extract_basic.py:31:33
   |
29 | def test_extraction_completeness(monsters_raw):
30 |     """Verify we extract the expected number of monsters."""
31 |     assert len(monsters_raw) == 296, f"Expected 296 monsters, got {len(monsters_raw)}"
   |                                 ^^^
   |

PLR2004 Magic value used in comparison, consider replacing `5` with a constant variable
  --> tests/test_extract_basic.py:81:31
   |
79 |     # Find Bold blocks (stat labels like "Armor Class", "Hit Points")
80 |     bold_blocks = [b for b in goblin["blocks"] if "Bold" in b.get("font", "")]
81 |     assert len(bold_blocks) > 5, "Goblin should have multiple Bold blocks for stat labels"
   |                               ^
82 |
83 |     # Find Italic blocks (size/type/alignment line)
   |

PLR2004 Magic value used in comparison, consider replacing `261` with a constant variable
   --> tests/test_extract_basic.py:110:20
    |
109 |         for page in pages:
110 |             assert 261 <= page <= 394, f"{name}: page {page} outside SRD monster section (261-394)"
    |                    ^^^
    |

PLR2004 Magic value used in comparison, consider replacing `394` with a constant variable
   --> tests/test_extract_basic.py:110:35
    |
109 |         for page in pages:
110 |             assert 261 <= page <= 394, f"{name}: page {page} outside SRD monster section (261-394)"
    |                                   ^^^
    |

PLR2004 Magic value used in comparison, consider replacing `0.05` with a constant variable
   --> tests/test_extract_basic.py:122:24
    |
120 |     warning_rate = len(monsters_with_warnings) / len(monsters_raw)
121 |     assert (
122 |         warning_rate < 0.05
    |                        ^^^^
123 |     ), f"Too many monsters with warnings: {len(monsters_with_warnings)}/296 ({warning_rate:.1%})"
    |

PLR2004 Magic value used in comparison, consider replacing `10` with a constant variable
   --> tests/test_extract_basic.py:130:31
    |
128 |     for name, monster in list(monsters_raw.items())[:50]:  # Sample 50 monsters
129 |         block_count = len(monster.get("blocks", []))
130 |         assert block_count >= 10, f"{name}: too few blocks ({block_count}), stat block incomplete?"
    |                               ^^
131 |         assert block_count <= 500, f"{name}: too many blocks ({block_count}), extraction error?"
    |

PLR2004 Magic value used in comparison, consider replacing `500` with a constant variable
   --> tests/test_extract_basic.py:131:31
    |
129 |         block_count = len(monster.get("blocks", []))
130 |         assert block_count >= 10, f"{name}: too few blocks ({block_count}), stat block incomplete?"
131 |         assert block_count <= 500, f"{name}: too many blocks ({block_count}), extraction error?"
    |                               ^^^
    |

PLR2004 Magic value used in comparison, consider replacing `8` with a constant variable
   --> tests/test_extract_basic.py:145:17
    |
143 |         if size > 0:  # Skip blocks without size info
144 |             assert (
145 |                 8 <= size <= 14
    |                 ^
146 |             ), f"Goblin block has unusual font size: {size}pt (text: {block.get('text', '')[:50]})"
    |

PLR2004 Magic value used in comparison, consider replacing `14` with a constant variable
   --> tests/test_extract_basic.py:145:30
    |
143 |         if size > 0:  # Skip blocks without size info
144 |             assert (
145 |                 8 <= size <= 14
    |                              ^^
146 |             ), f"Goblin block has unusual font size: {size}pt (text: {block.get('text', '')[:50]})"
    |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
  --> tests/test_extract_cross_page.py:38:34
   |
37 |     # Must span multiple pages
38 |     assert len(deva["pages"]) >= 2, f"Deva should span 2+ pages, got {deva['pages']}"
   |                                  ^
39 |     assert 261 in deva["pages"], "Deva should include page 261"
40 |     assert 262 in deva["pages"], "Deva should include page 262"
   |

PLR2004 Magic value used in comparison, consider replacing `261` with a constant variable
  --> tests/test_extract_cross_page.py:39:12
   |
37 |     # Must span multiple pages
38 |     assert len(deva["pages"]) >= 2, f"Deva should span 2+ pages, got {deva['pages']}"
39 |     assert 261 in deva["pages"], "Deva should include page 261"
   |            ^^^
40 |     assert 262 in deva["pages"], "Deva should include page 262"
   |

PLR2004 Magic value used in comparison, consider replacing `262` with a constant variable
  --> tests/test_extract_cross_page.py:40:12
   |
38 |     assert len(deva["pages"]) >= 2, f"Deva should span 2+ pages, got {deva['pages']}"
39 |     assert 261 in deva["pages"], "Deva should include page 261"
40 |     assert 262 in deva["pages"], "Deva should include page 262"
   |            ^^^
41 |
42 |     # Must have complete stat block (70+ blocks)
   |

PLR2004 Magic value used in comparison, consider replacing `70` with a constant variable
  --> tests/test_extract_cross_page.py:45:24
   |
43 |     block_count = len(deva["blocks"])
44 |     assert (
45 |         block_count >= 70
   |                        ^^
46 |     ), f"Deva should have 70+ blocks for complete stat block, got {block_count}"
   |

PLR2004 Magic value used in comparison, consider replacing `70` with a constant variable
  --> tests/test_extract_cross_page.py:67:24
   |
65 |     block_count = len(solar["blocks"])
66 |     assert (
67 |         block_count >= 70
   |                        ^^
68 |     ), f"Solar should have 70+ blocks for complete stat block, got {block_count}"
   |

PLR2004 Magic value used in comparison, consider replacing `70` with a constant variable
  --> tests/test_extract_cross_page.py:86:27
   |
84 |     # Must have substantial block count
85 |     block_count = len(planetar["blocks"])
86 |     assert block_count >= 70, f"Planetar should have 70+ blocks, got {block_count}"
   |                           ^^
   |

PLR2004 Magic value used in comparison, consider replacing `20` with a constant variable
   --> tests/test_extract_cross_page.py:99:26
    |
 97 |     for name, monster in monsters_raw.items():
 98 |         block_count = len(monster["blocks"])
 99 |         if block_count < 20:
    |                          ^^
100 |             too_short.append((name, block_count))
    |

PLR2004 Magic value used in comparison, consider replacing `30` with a constant variable
   --> tests/test_extract_cross_page.py:124:31
    |
122 |     for name, monster in cross_page_monsters:
123 |         block_count = len(monster["blocks"])
124 |         assert block_count >= 30, (
    |                               ^^
125 |             f"{name} spans pages {monster['pages']} but only has {block_count} blocks - "
126 |             "possible extraction truncation"
    |

PLR2004 Magic value used in comparison, consider replacing `296` with a constant variable
   --> tests/test_extract_cross_page.py:144:33
    |
142 | def test_extraction_coverage(monsters_raw):
143 |     """Verify we extracted all 296 expected monsters."""
144 |     assert len(monsters_raw) == 296, f"Expected 296 monsters, got {len(monsters_raw)}"
    |                                 ^^^
    |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
   --> tests/test_extract_cross_page.py:188:27
    |
186 |         for i in range(len(pages) - 1):
187 |             gap = pages[i + 1] - pages[i]
188 |             assert gap <= 2, (
    |                           ^
189 |                 f"{name} has suspicious page gap: {pages} "
190 |                 f"(gap of {gap} between pages {pages[i]} and {pages[i+1]})"
    |

PLC0415 `import` should be at the top-level of a file
 --> tests/test_indexer.py:2:5
  |
1 | def test_build_monster_index():
2 |     from srd_builder.indexer import build_monster_index
  |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
3 |
4 |     mons = [
  |

PLC0415 `import` should be at the top-level of a file
 --> tests/test_parse_actions.py:6:5
  |
4 | def test_parse_melee_weapon_attack():
5 |     """Parse typical melee weapon attack."""
6 |     from srd_builder.parse_actions import parse_action_fields
  |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
7 |
8 |     action = {
  |

PLR2004 Magic value used in comparison, consider replacing `7` with a constant variable
  --> tests/test_parse_actions.py:16:32
   |
15 |     assert result["attack_type"] == "melee_weapon"
16 |     assert result["to_hit"] == 7
   |                                ^
17 |     assert result["reach"] == 5
18 |     assert result["damage"] == {
   |

PLR2004 Magic value used in comparison, consider replacing `5` with a constant variable
  --> tests/test_parse_actions.py:17:31
   |
15 |     assert result["attack_type"] == "melee_weapon"
16 |     assert result["to_hit"] == 7
17 |     assert result["reach"] == 5
   |                               ^
18 |     assert result["damage"] == {
19 |         "average": 17,
   |

PLC0415 `import` should be at the top-level of a file
  --> tests/test_parse_actions.py:28:5
   |
26 | def test_parse_ranged_weapon_attack():
27 |     """Parse ranged weapon attack with range."""
28 |     from srd_builder.parse_actions import parse_action_fields
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
29 |
30 |     action = {
   |

PLR2004 Magic value used in comparison, consider replacing `4` with a constant variable
  --> tests/test_parse_actions.py:38:32
   |
37 |     assert result["attack_type"] == "ranged_weapon"
38 |     assert result["to_hit"] == 4
   |                                ^
39 |     assert result["range"] == {"normal": 150, "long": 600}
40 |     assert result["damage"] == {
   |

PLC0415 `import` should be at the top-level of a file
  --> tests/test_parse_actions.py:50:5
   |
48 | def test_parse_action_with_saving_throw():
49 |     """Parse action with DC saving throw."""
50 |     from srd_builder.parse_actions import parse_action_fields
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
51 |
52 |     action = {
   |

PLC0415 `import` should be at the top-level of a file
  --> tests/test_parse_actions.py:72:5
   |
70 | def test_parse_action_multiple_damage_types():
71 |     """Parse action with multiple damage instances."""
72 |     from srd_builder.parse_actions import parse_action_fields
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
73 |
74 |     action = {
   |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
  --> tests/test_parse_actions.py:87:45
   |
85 |     }
86 |     assert "damage_options" in result
87 |     assert len(result["damage_options"]) == 2
   |                                             ^
88 |     assert result["damage_options"][1] == {
89 |         "average": 3,
   |

PLC0415 `import` should be at the top-level of a file
  --> tests/test_parse_actions.py:97:5
   |
95 | def test_parse_melee_spell_attack():
96 |     """Parse melee spell attack."""
97 |     from srd_builder.parse_actions import parse_action_fields
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
98 |
99 |     action = {
   |

PLR2004 Magic value used in comparison, consider replacing `5` with a constant variable
   --> tests/test_parse_actions.py:107:32
    |
106 |     assert result["attack_type"] == "melee_spell"
107 |     assert result["to_hit"] == 5
    |                                ^
108 |     assert result["reach"] == 5
    |

PLR2004 Magic value used in comparison, consider replacing `5` with a constant variable
   --> tests/test_parse_actions.py:108:31
    |
106 |     assert result["attack_type"] == "melee_spell"
107 |     assert result["to_hit"] == 5
108 |     assert result["reach"] == 5
    |                               ^
    |

PLC0415 `import` should be at the top-level of a file
   --> tests/test_parse_actions.py:113:5
    |
111 | def test_parse_ranged_spell_attack():
112 |     """Parse ranged spell attack."""
113 |     from srd_builder.parse_actions import parse_action_fields
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
114 |
115 |     action = {
    |

PLR2004 Magic value used in comparison, consider replacing `7` with a constant variable
   --> tests/test_parse_actions.py:123:32
    |
122 |     assert result["attack_type"] == "ranged_spell"
123 |     assert result["to_hit"] == 7
    |                                ^
124 |     assert result["range"] == {"normal": 120, "long": 480}
    |

PLC0415 `import` should be at the top-level of a file
   --> tests/test_parse_actions.py:129:5
    |
127 | def test_parse_negative_to_hit():
128 |     """Parse action with negative to-hit modifier."""
129 |     from srd_builder.parse_actions import parse_action_fields
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
130 |
131 |     action = {
    |

PLC0415 `import` should be at the top-level of a file
   --> tests/test_parse_actions.py:144:5
    |
142 | def test_parse_action_without_attack():
143 |     """Non-attack actions should not be parsed."""
144 |     from srd_builder.parse_actions import parse_action_fields
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
145 |
146 |     action = {
    |

PLC0415 `import` should be at the top-level of a file
   --> tests/test_parse_actions.py:161:5
    |
159 | def test_parse_action_preserves_all_fields():
160 |     """Parsing should add fields without removing existing ones."""
161 |     from srd_builder.parse_actions import parse_action_fields
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
162 |
163 |     action = {
    |

PLR2004 Magic value used in comparison, consider replacing `10` with a constant variable
   --> tests/test_parse_actions.py:176:32
    |
174 |     assert result["custom_field"] == "should be preserved"
175 |     assert result["attack_type"] == "melee_weapon"
176 |     assert result["to_hit"] == 10
    |                                ^^
    |

PLC0415 `import` should be at the top-level of a file
   --> tests/test_parse_actions.py:181:5
    |
179 | def test_parse_action_in_pipeline():
180 |     """Test action parsing integrated into clean_monster_record."""
181 |     from srd_builder.postprocess import clean_monster_record
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
182 |
183 |     monster = {
    |

PLR2004 Magic value used in comparison, consider replacing `5` with a constant variable
   --> tests/test_parse_actions.py:205:32
    |
203 |     action = result["actions"][0]
204 |     assert action["attack_type"] == "melee_weapon"
205 |     assert action["to_hit"] == 5
    |                                ^
206 |     assert action["reach"] == 5
207 |     assert action["damage"]["dice"] == "1d8+3"
    |

PLR2004 Magic value used in comparison, consider replacing `5` with a constant variable
   --> tests/test_parse_actions.py:206:31
    |
204 |     assert action["attack_type"] == "melee_weapon"
205 |     assert action["to_hit"] == 5
206 |     assert action["reach"] == 5
    |                               ^
207 |     assert action["damage"]["dice"] == "1d8+3"
208 |     assert action["damage"]["type"] == "bludgeoning"
    |

PLC0415 `import` should be at the top-level of a file
   --> tests/test_parse_actions.py:213:5
    |
211 | def test_parse_legendary_actions():
212 |     """Test action parsing applies to legendary actions."""
213 |     from srd_builder.postprocess import clean_monster_record
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
214 |
215 |     monster = {
    |

PLR2004 Magic value used in comparison, consider replacing `15` with a constant variable
   --> tests/test_parse_actions.py:236:35
    |
234 |     legendary = result["legendary_actions"][0]
235 |     assert legendary["attack_type"] == "melee_weapon"
236 |     assert legendary["to_hit"] == 15
    |                                   ^^
237 |     assert legendary["reach"] == 20
    |

PLR2004 Magic value used in comparison, consider replacing `20` with a constant variable
   --> tests/test_parse_actions.py:237:34
    |
235 |     assert legendary["attack_type"] == "melee_weapon"
236 |     assert legendary["to_hit"] == 15
237 |     assert legendary["reach"] == 20
    |                                  ^^
    |

PLC0415 `import` should be at the top-level of a file
   --> tests/test_parse_actions.py:242:5
    |
240 | def test_parse_reactions():
241 |     """Test action parsing applies to reactions."""
242 |     from srd_builder.postprocess import clean_monster_record
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
243 |
244 |     monster = {
    |

PLR2004 Magic value used in comparison, consider replacing `8` with a constant variable
   --> tests/test_parse_actions.py:265:34
    |
263 |     reaction = result["reactions"][0]
264 |     assert reaction["attack_type"] == "melee_weapon"
265 |     assert reaction["to_hit"] == 8
    |                                  ^
    |

PLC0415 `import` should be at the top-level of a file
   --> tests/test_parse_actions.py:270:5
    |
268 | def test_parse_constitution_saving_throw():
269 |     """Test full ability name expansion from short form."""
270 |     from srd_builder.parse_actions import parse_action_fields
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
271 |
272 |     action = {
    |

PLC0415 `import` should be at the top-level of a file
   --> tests/test_parse_actions.py:287:5
    |
285 | def test_parse_damage_without_spacing():
286 |     """Test damage parsing handles various spacing."""
287 |     from srd_builder.parse_actions import parse_action_fields
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
288 |
289 |     # Compact formatting
    |

PLR2004 Magic value used in comparison, consider replacing `13` with a constant variable
  --> tests/test_parse_equipment.py:37:36
   |
35 |         "max_bonus": 2,
36 |     }
37 |     assert item["strength_req"] == 13
   |                                    ^^
38 |     assert item["stealth_disadvantage"] is True
39 |     assert item["weight_lb"] == 40.0
   |

PLR2004 Magic value used in comparison, consider replacing `40.0` with a constant variable
  --> tests/test_parse_equipment.py:39:33
   |
37 |     assert item["strength_req"] == 13
38 |     assert item["stealth_disadvantage"] is True
39 |     assert item["weight_lb"] == 40.0
   |                                 ^^^^
40 |     assert item["weight_raw"] == "40 lb."
41 |     assert item["cost"] == {"amount": 50, "currency": "gp"}
   |

PLR2004 Magic value used in comparison, consider replacing `3.0` with a constant variable
   --> tests/test_parse_equipment.py:108:33
    |
106 |     assert item["weapon_type"] == "melee"
107 |     assert item["sub_category"] == "martial_melee"
108 |     assert item["weight_lb"] == 3.0
    |                                 ^^^
109 |     assert item["weight_raw"] == "3 lb."
    |

PLR2004 Magic value used in comparison, consider replacing `0.5` with a constant variable
   --> tests/test_parse_equipment.py:122:33
    |
120 |     item = parse_equipment_records([raw_item])[0]
121 |
122 |     assert item["weight_lb"] == 0.5
    |                                 ^^^
123 |     assert item["weight_raw"] == "1/2 lb."
124 |     assert item["cost"] == {"amount": 25, "currency": "gp"}
    |

PLR2004 Magic value used in comparison, consider replacing `3` with a constant variable
   --> tests/test_parse_spells.py:108:36
    |
106 |     assert result is not None
107 |     assert result["type"] == "slot"
108 |     assert result["base_level"] == 3
    |                                    ^
109 |     assert "1d6" in result["formula"]
    |

PLC0415 `import` should be at the top-level of a file
 --> tests/test_postprocess.py:2:5
  |
1 | def test_clean_monster_record_basic():
2 |     from srd_builder.postprocess import clean_monster_record
  |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
3 |
4 |     m = {
  |

PLC0415 `import` should be at the top-level of a file
 --> tests/test_postprocess_cr.py:2:5
  |
1 | def test_standardize_challenge_handles_strings_and_fractions():
2 |     from srd_builder.postprocess import standardize_challenge
  |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
3 |
4 |     monster = {"challenge_rating": "1/2"}
  |

PLR2004 Magic value used in comparison, consider replacing `0.5` with a constant variable
 --> tests/test_postprocess_cr.py:5:66
  |
4 |     monster = {"challenge_rating": "1/2"}
5 |     assert standardize_challenge(monster)["challenge_rating"] == 0.5
  |                                                                  ^^^
6 |
7 |     monster = {"challenge_rating": "10"}
  |

PLR2004 Magic value used in comparison, consider replacing `10` with a constant variable
  --> tests/test_postprocess_cr.py:8:66
   |
 7 |     monster = {"challenge_rating": "10"}
 8 |     assert standardize_challenge(monster)["challenge_rating"] == 10
   |                                                                  ^^
 9 |
10 |     monster = {"challenge_rating": 3.0}
   |

PLR2004 Magic value used in comparison, consider replacing `3` with a constant variable
  --> tests/test_postprocess_cr.py:11:66
   |
10 |     monster = {"challenge_rating": 3.0}
11 |     assert standardize_challenge(monster)["challenge_rating"] == 3
   |                                                                  ^
   |

PLC0415 `import` should be at the top-level of a file
 --> tests/test_postprocess_defenses.py:2:5
  |
1 | def test_structure_defenses_normalizes_strings():
2 |     from srd_builder.postprocess import structure_defenses
  |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
3 |
4 |     monster = {
  |

PLR2004 Magic value used in comparison, consider replacing `0.5` with a constant variable
  --> tests/test_postprocess_functions.py:76:66
   |
74 | def test_standardize_challenge_handles_fraction_and_numeric() -> None:
75 |     monster: dict[str, Any] = {"challenge_rating": "1/2"}
76 |     assert standardize_challenge(monster)["challenge_rating"] == 0.5
   |                                                                  ^^^
77 |
78 |     monster = {"challenge_rating": "5"}
   |

PLR2004 Magic value used in comparison, consider replacing `5` with a constant variable
  --> tests/test_postprocess_functions.py:79:66
   |
78 |     monster = {"challenge_rating": "5"}
79 |     assert standardize_challenge(monster)["challenge_rating"] == 5
   |                                                                  ^
80 |
81 |     monster = {"challenge_rating": 7.0}
   |

PLR2004 Magic value used in comparison, consider replacing `7` with a constant variable
  --> tests/test_postprocess_functions.py:82:66
   |
81 |     monster = {"challenge_rating": 7.0}
82 |     assert standardize_challenge(monster)["challenge_rating"] == 7
   |                                                                  ^
   |

PLC0415 `import` should be at the top-level of a file
 --> tests/test_postprocess_ids.py:2:5
  |
1 | def test_unify_simple_name_updates_monster_and_children():
2 |     from srd_builder.postprocess import unify_simple_name
  |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
3 |
4 |     monster = {
  |

PLC0415 `import` should be at the top-level of a file
 --> tests/test_postprocess_legendary.py:2:5
  |
1 |   def test_split_legendary_moves_actions():
2 | /     from srd_builder.postprocess import (
3 | |         polish_text_fields,
4 | |         rename_abilities_to_traits,
5 | |         split_legendary,
6 | |     )
  | |_____^
7 |
8 |       monster = {
  |

PLC0415 `import` should be at the top-level of a file
 --> tests/test_postprocess_text.py:2:5
  |
1 | def test_polish_text_fields_cleans_boilerplate_and_spacing():
2 |     from srd_builder.postprocess import polish_text_fields
  |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
3 |
4 |     monster = {
  |

PLR2004 Magic value used in comparison, consider replacing `3` with a constant variable
  --> tests/test_schema_versions.py:30:30
   |
28 |         # Version should be semantic versioning format (e.g., "1.1.0")
29 |         parts = schema["version"].split(".")
30 |         assert len(parts) == 3, f"{schema_file.name} version must be MAJOR.MINOR.PATCH format"
   |                              ^
31 |         assert all(p.isdigit() for p in parts), f"{schema_file.name} version parts must be numeric"
   |

PLR2004 Magic value used in comparison, consider replacing `3` with a constant variable
   --> tests/test_schema_versions.py:99:26
    |
 97 |     version = meta["$schema_version"]
 98 |     parts = version.split(".")
 99 |     assert len(parts) == 3, "$schema_version must be MAJOR.MINOR.PATCH format"
    |                          ^
100 |     assert all(p.isdigit() for p in parts), "$schema_version parts must be numeric"
    |

PLR2004 Magic value used in comparison, consider replacing `6` with a constant variable
  --> tests/test_validate_monsters.py:84:42
   |
82 |     # Check that some categories pass
83 |     assert results["Giants"]["complete"] is True
84 |     assert results["Giants"]["found"] == 6
   |                                          ^
85 |     assert results["Giants"]["missing"] == []
   |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
   --> tests/test_validate_monsters.py:101:42
    |
 99 |     results = validate_category_completeness(incomplete)
100 |     assert results["Giants"]["complete"] is False
101 |     assert results["Giants"]["found"] == 2
    |                                          ^
102 |     assert len(results["Giants"]["missing"]) == 4
    |

PLR2004 Magic value used in comparison, consider replacing `4` with a constant variable
   --> tests/test_validate_monsters.py:102:49
    |
100 |     assert results["Giants"]["complete"] is False
101 |     assert results["Giants"]["found"] == 2
102 |     assert len(results["Giants"]["missing"]) == 4
    |                                                 ^
    |

PLR2004 Magic value used in comparison, consider replacing `295` with a constant variable
   --> tests/test_validate_monsters.py:111:31
    |
109 |     result = validate_monster_count(monsters)
110 |
111 |     assert result["count"] == 295
    |                               ^^^
112 |     assert result["in_range"] is True
    |

PLR2004 Magic value used in comparison, consider replacing `100` with a constant variable
   --> tests/test_validate_monsters.py:121:31
    |
119 |     result = validate_monster_count(monsters)
120 |
121 |     assert result["count"] == 100
    |                               ^^^
122 |     assert result["in_range"] is False
    |

PLR2004 Magic value used in comparison, consider replacing `3` with a constant variable
   --> tests/test_validate_monsters.py:135:31
    |
134 |     assert result["all_unique"] is True
135 |     assert result["total"] == 3
    |                               ^
136 |     assert result["unique"] == 3
137 |     assert result["duplicates"] == {}
    |

PLR2004 Magic value used in comparison, consider replacing `3` with a constant variable
   --> tests/test_validate_monsters.py:136:32
    |
134 |     assert result["all_unique"] is True
135 |     assert result["total"] == 3
136 |     assert result["unique"] == 3
    |                                ^
137 |     assert result["duplicates"] == {}
    |

PLR2004 Magic value used in comparison, consider replacing `3` with a constant variable
   --> tests/test_validate_monsters.py:150:31
    |
149 |     assert result["all_unique"] is False
150 |     assert result["total"] == 3
    |                               ^
151 |     assert result["unique"] == 2
152 |     assert result["duplicates"] == {"Dragon": 2}
    |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
   --> tests/test_validate_monsters.py:151:32
    |
149 |     assert result["all_unique"] is False
150 |     assert result["total"] == 3
151 |     assert result["unique"] == 2
    |                                ^
152 |     assert result["duplicates"] == {"Dragon": 2}
    |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
   --> tests/test_validate_monsters.py:165:27
    |
163 |     result = validate_alphabetic_coverage(monsters)
164 |
165 |     assert result["A"] == 2
    |                           ^
166 |     assert result["B"] == 1
167 |     assert result["G"] == 1
    |

Found 232 errors.
No fixes available (2 hidden fixes can be enabled with the `--unsafe-fixes` option).
0s
Run ruff check .
PLR2004 Magic value used in comparison, consider replacing `300` with a constant variable
  --> scripts/analyze_reference.py:32:20
   |
31 |         # Monsters section starts around page 300
32 |         if page >= 300 and entry_type in ("h1", "h2", "h3", "h4"):
   |                    ^^^
33 |             # Extract text from subelements
34 |             text = ""
   |

PLC0415 `import` should be at the top-level of a file
  --> scripts/bump_version.py:56:5
   |
54 |     # Import after version update
55 |     sys.path.insert(0, str(Path.cwd() / "src"))
56 |     from srd_builder import __version__
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
57 |     from srd_builder.constants import SCHEMA_VERSION
58 |     from srd_builder.parse_equipment import parse_equipment_records
   |

PLC0415 `import` should be at the top-level of a file
  --> scripts/bump_version.py:57:5
   |
55 |     sys.path.insert(0, str(Path.cwd() / "src"))
56 |     from srd_builder import __version__
57 |     from srd_builder.constants import SCHEMA_VERSION
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
58 |     from srd_builder.parse_equipment import parse_equipment_records
59 |     from srd_builder.parse_monsters import parse_monster_records
   |

PLC0415 `import` should be at the top-level of a file
  --> scripts/bump_version.py:58:5
   |
56 |     from srd_builder import __version__
57 |     from srd_builder.constants import SCHEMA_VERSION
58 |     from srd_builder.parse_equipment import parse_equipment_records
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
59 |     from srd_builder.parse_monsters import parse_monster_records
60 |     from srd_builder.parse_spells import parse_spell_records
   |

PLC0415 `import` should be at the top-level of a file
  --> scripts/bump_version.py:59:5
   |
57 |     from srd_builder.constants import SCHEMA_VERSION
58 |     from srd_builder.parse_equipment import parse_equipment_records
59 |     from srd_builder.parse_monsters import parse_monster_records
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
60 |     from srd_builder.parse_spells import parse_spell_records
61 |     from srd_builder.postprocess import (
   |

PLC0415 `import` should be at the top-level of a file
  --> scripts/bump_version.py:60:5
   |
58 |     from srd_builder.parse_equipment import parse_equipment_records
59 |     from srd_builder.parse_monsters import parse_monster_records
60 |     from srd_builder.parse_spells import parse_spell_records
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
61 |     from srd_builder.postprocess import (
62 |         clean_equipment_record,
   |

PLC0415 `import` should be at the top-level of a file
  --> scripts/bump_version.py:61:5
   |
59 |       from srd_builder.parse_monsters import parse_monster_records
60 |       from srd_builder.parse_spells import parse_spell_records
61 | /     from srd_builder.postprocess import (
62 | |         clean_equipment_record,
63 | |         clean_monster_record,
64 | |         clean_spell_record,
65 | |     )
   | |_____^
66 |
67 |       fixtures = [
   |

PLR0912 Too many branches (25 > 12)
  --> scripts/compare_with_blackmoor.py:11:5
   |
11 | def main() -> None:  # noqa: C901
   |     ^^^^
12 |     """Run comparison analysis."""
13 |     ours_path = Path("dist/srd_5_1/data/monsters.json")
   |

PLR0915 Too many statements (132 > 50)
  --> scripts/compare_with_blackmoor.py:11:5
   |
11 | def main() -> None:  # noqa: C901
   |     ^^^^
12 |     """Run comparison analysis."""
13 |     ours_path = Path("dist/srd_5_1/data/monsters.json")
   |

PLR2004 Magic value used in comparison, consider replacing `20` with a constant variable
  --> scripts/compare_with_blackmoor.py:64:32
   |
62 |         for name in sorted(only_in_ours)[:20]:
63 |             print(f"  + {name}")
64 |         if len(only_in_ours) > 20:
   |                                ^^
65 |             print(f"  ... and {len(only_in_ours) - 20} more")
   |

PLR2004 Magic value used in comparison, consider replacing `11.5` with a constant variable
  --> scripts/count_monsters_in_pdf.py:46:35
   |
44 |                         # We look for 12pt, Bold, and reasonable text
45 |                         is_bold = (flags & 2**4) != 0  # Bold flag
46 |                         is_12pt = 11.5 <= size <= 12.5
   |                                   ^^^^
47 |                         is_calibri = "Calibri" in font
   |

PLR2004 Magic value used in comparison, consider replacing `12.5` with a constant variable
  --> scripts/count_monsters_in_pdf.py:46:51
   |
44 |                         # We look for 12pt, Bold, and reasonable text
45 |                         is_bold = (flags & 2**4) != 0  # Bold flag
46 |                         is_12pt = 11.5 <= size <= 12.5
   |                                                   ^^^^
47 |                         is_calibri = "Calibri" in font
   |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
  --> scripts/count_monsters_in_pdf.py:51:41
   |
49 |                         # Filter: reasonable monster name length and structure
50 |                         is_reasonable_name = (
51 |                             len(text) > 2
   |                                         ^
52 |                             and len(text) < 80
53 |                             and text[0].isupper()
   |

PLR2004 Magic value used in comparison, consider replacing `80` with a constant variable
  --> scripts/count_monsters_in_pdf.py:52:45
   |
50 |                         is_reasonable_name = (
51 |                             len(text) > 2
52 |                             and len(text) < 80
   |                                             ^^
53 |                             and text[0].isupper()
54 |                             and not text.endswith(":")
   |

PLR0915 Too many statements (55 > 50)
  --> scripts/count_monsters_in_pdf.py:66:5
   |
66 | def main() -> None:  # noqa: C901
   |     ^^^^
67 |     """Main entry point."""
68 |     print("=" * 80)
   |

PLR2004 Magic value used in comparison, consider replacing `20` with a constant variable
  --> scripts/count_monsters_in_pdf.py:94:20
   |
92 |             print(f"  • {name}")
93 |
94 |         if count > 20:
   |                    ^^
95 |             print(f"  ... and {count - 20} more")
   |

PLC0415 `import` should be at the top-level of a file
   --> scripts/count_monsters_in_pdf.py:108:5
    |
107 |     # Load our extraction
108 |     import json
    |     ^^^^^^^^^^^
109 |
110 |     our_path = Path("dist/srd_5_1/data/monsters.json")
    |

PLR0912 Too many branches (15 > 12)
  --> scripts/coverage_report.py:9:5
   |
 9 | def count_expected_from_raw(raw_path: Path) -> dict[str, int]:  # noqa: C901
   |     ^^^^^^^^^^^^^^^^^^^^^^^
10 |     """Count expected fields by analyzing raw PDF extraction."""
11 |     with open(raw_path) as f:
   |

PLR2004 Magic value used in comparison, consider replacing `10.8` with a constant variable
  --> scripts/coverage_report.py:91:62
   |
89 |         for i, block in enumerate(blocks):
90 |             text = " ".join(block.get("text", "").split()).strip()
91 |             if text == "Actions" and block.get("size", 0) >= 10.8:
   |                                                              ^^^^
92 |                 actions_idx = i
93 |                 actions_count += 1  # Monster has Actions section
   |

PLR2004 Magic value used in comparison, consider replacing `9.84` with a constant variable
   --> scripts/coverage_report.py:102:46
    |
100 |                 if (
101 |                     block.get("font") == "Calibri-BoldItalic"
102 |                     and block.get("size") == 9.84
    |                                              ^^^^
103 |                     and block.get("text", "").strip().endswith(".")
104 |                 ):
    |

PLR2004 Magic value used in comparison, consider replacing `10.8` with a constant variable
   --> scripts/coverage_report.py:117:64
    |
115 |         for block in blocks:
116 |             text = " ".join(block.get("text", "").split()).strip()
117 |             if text == "Reactions" and block.get("size", 0) >= 10.8:
    |                                                                ^^^^
118 |                 reactions_count += 1
119 |                 break
    |

PLR2004 Magic value used in comparison, consider replacing `100` with a constant variable
   --> scripts/coverage_report.py:237:23
    |
236 |         # Status indicator
237 |         if percent >= 100:
    |                       ^^^
238 |             status = "✓ Complete"
239 |         elif percent >= 90:
    |

PLR2004 Magic value used in comparison, consider replacing `90` with a constant variable
   --> scripts/coverage_report.py:239:25
    |
237 |         if percent >= 100:
238 |             status = "✓ Complete"
239 |         elif percent >= 90:
    |                         ^^
240 |             status = "✓ Excellent"
241 |         elif percent >= 75:
    |

PLR2004 Magic value used in comparison, consider replacing `75` with a constant variable
   --> scripts/coverage_report.py:241:25
    |
239 |         elif percent >= 90:
240 |             status = "✓ Excellent"
241 |         elif percent >= 75:
    |                         ^^
242 |             status = "△ Good"
243 |         elif percent >= 50:
    |

PLR2004 Magic value used in comparison, consider replacing `50` with a constant variable
   --> scripts/coverage_report.py:243:25
    |
241 |         elif percent >= 75:
242 |             status = "△ Good"
243 |         elif percent >= 50:
    |                         ^^
244 |             status = "△ Partial"
245 |         else:
    |

PLR2004 Magic value used in comparison, consider replacing `4` with a constant variable
  --> scripts/explore_pdf.py:29:66
   |
27 |                 size = span.get("size", 0.0)
28 |                 fonts[(font, round(size, 2))] += len(text)
29 |                 if not (bbox := span.get("bbox")) or len(bbox) < 4:
   |                                                                  ^
30 |                     continue
31 |                 column_edges.append(bbox[0])
   |

PLR0912 Too many branches (13 > 12)
  --> scripts/find_missing_monsters.py:49:5
   |
49 | def compare_sources() -> None:  # noqa: C901
   |     ^^^^^^^^^^^^^^^
50 |     """Compare our monsters against all available sources."""
51 |     print("=" * 80)
   |

PLR2004 Magic value used in comparison, consider replacing `20` with a constant variable
  --> scripts/find_missing_monsters.py:85:45
   |
83 |             for name in sorted(in_blackmoor_not_ours)[:20]:
84 |                 print(f"  • {name}")
85 |             if len(in_blackmoor_not_ours) > 20:
   |                                             ^^
86 |                 print(f"  ... and {len(in_blackmoor_not_ours) - 20} more")
   |

PLR2004 Magic value used in comparison, consider replacing `20` with a constant variable
  --> scripts/find_missing_monsters.py:92:45
   |
90 |             for name in sorted(in_ours_not_blackmoor)[:20]:
91 |                 print(f"  • {name}")
92 |             if len(in_ours_not_blackmoor) > 20:
   |                                             ^^
93 |                 print(f"  ... and {len(in_ours_not_blackmoor) - 20} more")
94 |     else:
   |

PLR0912 Too many branches (32 > 12)
  --> scripts/quality_report.py:11:5
   |
11 | def analyze_quality(parsed_path: Path, raw_path: Path) -> None:  # noqa: C901
   |     ^^^^^^^^^^^^^^^
12 |     """Generate quality analysis report."""
13 |     with open(parsed_path) as f:
   |

PLR0915 Too many statements (131 > 50)
  --> scripts/quality_report.py:11:5
   |
11 | def analyze_quality(parsed_path: Path, raw_path: Path) -> None:  # noqa: C901
   |     ^^^^^^^^^^^^^^^
12 |     """Generate quality analysis report."""
13 |     with open(parsed_path) as f:
   |

PLR2004 Magic value used in comparison, consider replacing `6` with a constant variable
  --> scripts/quality_report.py:76:34
   |
74 |     for count in sorted(ability_counts.keys()):
75 |         pct = (ability_counts[count] / total) * 100
76 |         status = "✅" if count == 6 else "⚠️"
   |                                   ^
77 |         print(f"{status} {count} abilities: {ability_counts[count]:3d} monsters ({pct:5.1f}%)")
78 |     print()
   |

PLR2004 Magic value used in comparison, consider replacing `5` with a constant variable
   --> scripts/quality_report.py:101:77
    |
100 |     # Check for suspiciously high counts
101 |     high_trait = [m["name"] for m in monsters if len(m.get("traits", [])) > 5]
    |                                                                             ^
102 |     high_action = [m["name"] for m in monsters if len(m.get("actions", [])) > 8]
    |

PLR2004 Magic value used in comparison, consider replacing `8` with a constant variable
   --> scripts/quality_report.py:102:79
    |
100 |     # Check for suspiciously high counts
101 |     high_trait = [m["name"] for m in monsters if len(m.get("traits", [])) > 5]
102 |     high_action = [m["name"] for m in monsters if len(m.get("actions", [])) > 8]
    |                                                                               ^
103 |
104 |     if high_trait:
    |

PLR2004 Magic value used in comparison, consider replacing `10` with a constant variable
   --> scripts/quality_report.py:151:37
    |
149 |         for trait in m.get("traits", []):
150 |             text = trait.get("text", "")
151 |             if text and len(text) < 10:
    |                                     ^^
152 |                 issues.append(f"{m['name']}: Short trait '{trait.get('name')}': {text}")
    |

PLR1722 Use `sys.exit()` instead of `exit`
   --> scripts/quality_report.py:204:9
    |
202 |     if not parsed_path.exists():
203 |         print(f"Error: {parsed_path} not found. Run build first.")
204 |         exit(1)
    |         ^^^^
205 |
206 |     analyze_quality(parsed_path, raw_path)
    |
help: Replace `exit` with `sys.exit()`

PLR0913 Too many arguments in function definition (10 > 5)
  --> src/srd_builder/build.py:85:5
   |
85 | def _generate_meta_json(
   |     ^^^^^^^^^^^^^^^^^^^
86 |     *,
87 |     pdf_hash: str | None,
   |

PLR0913 Too many arguments in function definition (8 > 5)
   --> src/srd_builder/build.py:176:5
    |
176 | def _write_datasets(
    |     ^^^^^^^^^^^^^^^
177 |     *,
178 |     ruleset: str,
    |

PLR0912 Too many branches (14 > 12)
   --> src/srd_builder/build.py:623:5
    |
623 | def build(  # noqa: C901
    |     ^^^^^
624 |     ruleset: str, output_format: str, out_dir: Path, bundle: bool = False
625 | ) -> Path:
    |

PLR0915 Too many statements (63 > 50)
   --> src/srd_builder/build.py:623:5
    |
623 | def build(  # noqa: C901
    |     ^^^^^
624 |     ruleset: str, output_format: str, out_dir: Path, bundle: bool = False
625 | ) -> Path:
    |

PLC0415 `import` should be at the top-level of a file
   --> src/srd_builder/build.py:658:9
    |
656 |     parsed_tables = None
657 |     if raw_tables:
658 |         from scripts.table_targets import TARGET_TABLES
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
659 |
660 |         targets_by_id = {t["id"]: t for t in TARGET_TABLES}
    |

PLR0912 Too many branches (16 > 12)
  --> src/srd_builder/column_mapper.py:94:9
   |
92 |         return None
93 |
94 |     def _fill_from_heuristics(self, row: list[str]) -> None:  # noqa: C901
   |         ^^^^^^^^^^^^^^^^^^^^^
95 |         """Fill unmapped columns using content heuristics.
   |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
   --> src/srd_builder/column_mapper.py:151:64
    |
150 |         # Properties/special is usually the last column
151 |         if "properties" not in self._column_map and len(row) > 2:
    |                                                                ^
152 |             # Don't map if last column looks like weight or cost
153 |             last_col = row[-1]
    |

PLR2004 Magic value used in comparison, consider replacing `10` with a constant variable
   --> src/srd_builder/column_mapper.py:170:20
    |
168 |         if self.category == "armor" and re.match(r"^\d{2}$", cell.strip()):
169 |             ac_val = int(cell.strip())
170 |             return 10 <= ac_val <= 20
    |                    ^^
171 |         return False
    |

PLR2004 Magic value used in comparison, consider replacing `20` with a constant variable
   --> src/srd_builder/column_mapper.py:170:36
    |
168 |         if self.category == "armor" and re.match(r"^\d{2}$", cell.strip()):
169 |             ac_val = int(cell.strip())
170 |             return 10 <= ac_val <= 20
    |                                    ^^
171 |         return False
    |

PLR0912 Too many branches (16 > 12)
   --> src/srd_builder/extract_equipment.py:153:5
    |
153 | def _get_section_markers(  # noqa: C901
    |     ^^^^^^^^^^^^^^^^^^^^
154 |     page: fitz.Page, page_num: int
155 | ) -> list[tuple[float, dict[str, str | None]]]:
    |

PLR2004 Magic value used in comparison, consider replacing `0.5` with a constant variable
   --> src/srd_builder/extract_equipment.py:178:54
    |
177 |                 # Section header (18pt)
178 |                 if abs(size - SECTION_HEADER_SIZE) < 0.5:
    |                                                      ^^^
179 |                     if "armor" in text:
180 |                         category = "armor"
    |

PLR2004 Magic value used in comparison, consider replacing `0.5` with a constant variable
   --> src/srd_builder/extract_equipment.py:191:59
    |
190 |                 # Subsection header (13.92pt)
191 |                 elif abs(size - SUBSECTION_HEADER_SIZE) < 0.5:
    |                                                           ^^^
192 |                     if "armor" in text:
193 |                         category = "armor"
    |

PLR0912 Too many branches (21 > 12)
   --> src/srd_builder/extract_equipment.py:207:5
    |
207 | def _detect_section_context(  # noqa: C901
    |     ^^^^^^^^^^^^^^^^^^^^^^^
208 |     page: fitz.Page, page_num: int
209 | ) -> dict[str, str | None] | None:
    |

PLR2004 Magic value used in comparison, consider replacing `0.5` with a constant variable
   --> src/srd_builder/extract_equipment.py:231:54
    |
230 |                 # Section header (18pt)
231 |                 if abs(size - SECTION_HEADER_SIZE) < 0.5:
    |                                                      ^^^
232 |                     if "armor" in text:
233 |                         category = "armor"
    |

PLR2004 Magic value used in comparison, consider replacing `0.5` with a constant variable
   --> src/srd_builder/extract_equipment.py:244:59
    |
243 |                 # Subsection header (13.92pt)
244 |                 elif abs(size - SUBSECTION_HEADER_SIZE) < 0.5:
    |                                                           ^^^
245 |                     if "armor" in text:
246 |                         # Armor subcategories also set the category
    |

PLR0911 Too many return statements (10 > 6)
   --> src/srd_builder/extract_equipment.py:272:5
    |
272 | def _is_equipment_row(row: list[str]) -> bool:  # noqa: C901
    |     ^^^^^^^^^^^^^^^^^
273 |     """Check if table row contains actual equipment (vs headers/descriptions).
    |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
   --> src/srd_builder/extract_equipment.py:282:30
    |
280 |     - Descriptive text
281 |     """
282 |     if not row or len(row) < 2:
    |                              ^
283 |         return False
    |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
   --> src/srd_builder/extract_equipment.py:315:20
    |
313 |     # Filter Food/Drink/Lodging incomplete extractions
314 |     # Single-word entries with only a price in second column are likely reference table fragments
315 |     if len(row) == 2 and len(name.split()) == 1:
    |                    ^
316 |         second_cell = row[1].strip()
317 |         # If second cell is just a price, this is likely a pricing reference, not equipment
    |

PLR2004 Magic value used in comparison, consider replacing `25` with a constant variable
   --> src/srd_builder/extract_equipment.py:346:74
    |
344 |         "ranged",
345 |     ]
346 |     if any(kw in name.lower() for kw in header_keywords) and len(name) < 25:
    |                                                                          ^^
347 |         return False
    |

PLR2004 Magic value used in comparison, consider replacing `100` with a constant variable
   --> src/srd_builder/extract_equipment.py:350:20
    |
349 |     # Skip descriptive text (usually long paragraphs)
350 |     if len(name) > 100:
    |                    ^^^
351 |         return False
    |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
   --> src/srd_builder/extract_equipment.py:364:19
    |
362 |     PyMuPDF sometimes splits names like "Longswor" + "d" → "Longsword"
363 |     """
364 |     if len(row) < 2:
    |                   ^
365 |         return row
    |

PLR2004 Magic value used in comparison, consider replacing `3` with a constant variable
   --> src/srd_builder/extract_equipment.py:371:34
    |
370 |     # If second column is very short (1-3 chars) and looks like a fragment, merge it
371 |     if second and len(second) <= 3 and second.isalpha() and not second.islower():
    |                                  ^
372 |         # Merge and remove second column
373 |         merged_name = first + second.lower()
    |

PLR2004 Magic value used in comparison, consider replacing `3` with a constant variable
   --> src/srd_builder/extract_equipment.py:377:34
    |
376 |     # If second column is very short and is lowercase, it's likely a fragment
377 |     if second and len(second) <= 3 and second.islower():
    |                                  ^
378 |         merged_name = first + second
379 |         return [merged_name] + row[2:]
    |

PLR2004 Magic value used in comparison, consider replacing `2.0` with a constant variable
   --> src/srd_builder/extract_monsters.py:265:31
    |
263 |     line_y = line["bbox"][1]  # Top Y of line
264 |     span_y = span["bbox"][1]  # Top Y of span
265 |     if abs(line_y - span_y) > 2.0:
    |                               ^^^
266 |         return False
    |

PLR2004 Magic value used in comparison, consider replacing `0.5` with a constant variable
   --> src/srd_builder/extract_monsters.py:272:43
    |
270 |     if line["font"] != span["font"]:
271 |         return False
272 |     if abs(line["size"] - span["size"]) > 0.5:
    |                                           ^^^
273 |         return False
    |

PLR2004 Magic value used in comparison, consider replacing `0.5` with a constant variable
   --> src/srd_builder/extract_monsters.py:385:60
    |
383 |         return False
384 |
385 |     if abs(line["size"] - config.monster_name_font_size) > 0.5:
    |                                                            ^^^
386 |         return False
    |

PLR2004 Magic value used in comparison, consider replacing `30` with a constant variable
   --> src/srd_builder/extract_monsters.py:444:33
    |
443 |         # Stop if we've gone too far vertically
444 |         if next_y - current_y > 30:
    |                                 ^^
445 |             break
    |

PLR2004 Magic value used in comparison, consider replacing `50` with a constant variable
   --> src/srd_builder/extract_monsters.py:496:46
    |
495 |     # Monster names are typically capitalized and not too long
496 |     return text[0].isupper() and len(text) < 50
    |                                              ^^
    |

PLC0415 `import` should be at the top-level of a file
   --> src/srd_builder/extract_monsters.py:596:5
    |
594 | def main() -> None:
595 |     """CLI entry point."""
596 |     import argparse
    |     ^^^^^^^^^^^^^^^
597 |
598 |     parser = argparse.ArgumentParser(description="Extract monsters from SRD PDF")
    |

PLC0415 `import` should be at the top-level of a file
   --> src/srd_builder/extract_pdf_metadata.py:102:5
    |
100 | def main() -> None:
101 |     """CLI entry point for testing."""
102 |     import argparse
    |     ^^^^^^^^^^^^^^^
103 |     import json
    |

PLC0415 `import` should be at the top-level of a file
   --> src/srd_builder/extract_pdf_metadata.py:103:5
    |
101 |     """CLI entry point for testing."""
102 |     import argparse
103 |     import json
    |     ^^^^^^^^^^^
104 |
105 |     parser = argparse.ArgumentParser(description="Extract metadata from SRD PDF")
    |

PLR0912 Too many branches (19 > 12)
   --> src/srd_builder/extract_spells.py:103:5
    |
103 | def _extract_page_spells(  # noqa: C901
    |     ^^^^^^^^^^^^^^^^^^^^
104 |     page: fitz.Page, page_num: int, config: ExtractionConfig
105 | ) -> list[dict[str, Any]]:
    |

PLR2004 Magic value used in comparison, consider replacing `0.5` with a constant variable
   --> src/srd_builder/extract_spells.py:135:92
    |
134 |                 # Detect spell name (12pt GillSans-SemiBold)
135 |                 if config.spell_name_font in font and abs(size - config.spell_name_size) < 0.5:
    |                                                                                            ^^^
136 |                     # Save previous spell
137 |                     if current_spell:
    |

PLR2004 Magic value used in comparison, consider replacing `50` with a constant variable
   --> src/srd_builder/extract_spells.py:253:28
    |
252 |             # Merge if: current incomplete AND next has no name (continuation)
253 |             if (desc_len < 50 or header_len < 30) and not next_has_name:
    |                            ^^
254 |                 # Merge with next spell's content
255 |                 current["header_text"] += " " + next_spell.get("header_text", "")
    |

PLR2004 Magic value used in comparison, consider replacing `30` with a constant variable
   --> src/srd_builder/extract_spells.py:253:47
    |
252 |             # Merge if: current incomplete AND next has no name (continuation)
253 |             if (desc_len < 50 or header_len < 30) and not next_has_name:
    |                                               ^^
254 |                 # Merge with next spell's content
255 |                 current["header_text"] += " " + next_spell.get("header_text", "")
    |

PLC0415 `import` should be at the top-level of a file
   --> src/srd_builder/extract_spells.py:271:5
    |
269 | def main() -> None:  # pragma: no cover
270 |     """CLI entry point for spell extraction."""
271 |     import sys
    |     ^^^^^^^^^^
272 |
273 |     if len(sys.argv) != 2:
    |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
   --> src/srd_builder/extract_spells.py:273:25
    |
271 |     import sys
272 |
273 |     if len(sys.argv) != 2:
    |                         ^
274 |         print(f"Usage: {sys.argv[0]} <pdf_path>")
275 |         sys.exit(1)
    |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
   --> src/srd_builder/extract_tables.py:208:33
    |
206 |         for table in tables:
207 |             extracted = table.extract()
208 |             if len(extracted) < 2:  # Need header + data
    |                                 ^
209 |                 continue
    |

PLR0911 Too many return statements (23 > 6)
   --> src/srd_builder/extract_tables.py:274:9
    |
272 |         )
273 |
274 |     def _extract_manual(
    |         ^^^^^^^^^^^^^^^
275 |         self, target: TableTarget, page: fitz.Page, page_num: int
276 |     ) -> RawTable:  # noqa: C901
    |

PLR0912 Too many branches (24 > 12)
   --> src/srd_builder/extract_tables.py:274:9
    |
272 |         )
273 |
274 |     def _extract_manual(
    |         ^^^^^^^^^^^^^^^
275 |         self, target: TableTarget, page: fitz.Page, page_num: int
276 |     ) -> RawTable:  # noqa: C901
    |

PLR2004 Magic value used in comparison, consider replacing `4` with a constant variable
   --> src/srd_builder/extract_tables.py:374:25
    |
372 |         rows = []
373 |         for level in range(1, 21):
374 |             if level <= 4:
    |                         ^
375 |                 bonus = "+2"
376 |             elif level <= 8:
    |

PLR2004 Magic value used in comparison, consider replacing `8` with a constant variable
   --> src/srd_builder/extract_tables.py:376:27
    |
374 |             if level <= 4:
375 |                 bonus = "+2"
376 |             elif level <= 8:
    |                           ^
377 |                 bonus = "+3"
378 |             elif level <= 12:
    |

PLR2004 Magic value used in comparison, consider replacing `12` with a constant variable
   --> src/srd_builder/extract_tables.py:378:27
    |
376 |             elif level <= 8:
377 |                 bonus = "+3"
378 |             elif level <= 12:
    |                           ^^
379 |                 bonus = "+4"
380 |             elif level <= 16:
    |

PLR2004 Magic value used in comparison, consider replacing `16` with a constant variable
   --> src/srd_builder/extract_tables.py:380:27
    |
378 |             elif level <= 12:
379 |                 bonus = "+4"
380 |             elif level <= 16:
    |                           ^^
381 |                 bonus = "+5"
382 |             else:
    |

PLC0415 `import` should be at the top-level of a file
    --> src/srd_builder/extract_tables.py:1450:5
     |
1448 |         skip_failures: If True, skip tables that fail extraction
1449 |     """
1450 |     import json
     |     ^^^^^^^^^^^
1451 |
1452 |     with TableExtractor(pdf_path) as extractor:
     |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
    --> src/srd_builder/extract_tables.py:1484:24
     |
1482 |     logging.basicConfig(level=logging.INFO, format="%(levelname)s: %(message)s")
1483 |
1484 |     if len(sys.argv) < 2:
     |                        ^
1485 |         print("Usage: python -m srd_builder.extract_tables <pdf_path> [output_path]")
1486 |         sys.exit(1)
     |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
    --> src/srd_builder/extract_tables.py:1489:50
     |
1488 |     pdf_path = sys.argv[1]
1489 |     output_path = sys.argv[2] if len(sys.argv) > 2 else "tables_raw.json"
     |                                                  ^
1490 |
1491 |     extract_tables_to_json(pdf_path, output_path)
     |

PLR0913 Too many arguments in function definition (7 > 5)
   --> src/srd_builder/indexer.py:379:5
    |
379 | def build_indexes(  # noqa: C901
    |     ^^^^^^^^^^^^^
380 |     monsters: list[dict[str, Any]],
381 |     spells: list[dict[str, Any]] | None = None,
    |

PLR0912 Too many branches (17 > 12)
   --> src/srd_builder/indexer.py:379:5
    |
379 | def build_indexes(  # noqa: C901
    |     ^^^^^^^^^^^^^
380 |     monsters: list[dict[str, Any]],
381 |     spells: list[dict[str, Any]] | None = None,
    |

PLR0915 Too many statements (83 > 50)
   --> src/srd_builder/indexer.py:379:5
    |
379 | def build_indexes(  # noqa: C901
    |     ^^^^^^^^^^^^^
380 |     monsters: list[dict[str, Any]],
381 |     spells: list[dict[str, Any]] | None = None,
    |

PLR0912 Too many branches (16 > 12)
  --> src/srd_builder/parse_actions.py:29:5
   |
29 | def parse_action_fields(action: dict[str, Any]) -> dict[str, Any]:  # noqa: C901
   |     ^^^^^^^^^^^^^^^^^^^
30 |     """Parse structured fields from action text.
   |

PLR0915 Too many statements (55 > 50)
  --> src/srd_builder/parse_actions.py:29:5
   |
29 | def parse_action_fields(action: dict[str, Any]) -> dict[str, Any]:  # noqa: C901
   |     ^^^^^^^^^^^^^^^^^^^
30 |     """Parse structured fields from action text.
   |

PLR0912 Too many branches (16 > 12)
  --> src/srd_builder/parse_equipment.py:30:5
   |
30 | def parse_equipment_records(raw_items: list[dict[str, Any]]) -> list[dict[str, Any]]:  # noqa: C901
   |     ^^^^^^^^^^^^^^^^^^^^^^^
31 |     """Parse raw equipment items into structured records."""
   |

PLR0911 Too many return statements (7 > 6)
  --> src/srd_builder/parse_monsters.py:32:5
   |
32 | def _coerce_int(value: Any) -> int | None:
   |     ^^^^^^^^^^^
33 |     if value is None:
34 |         return None
   |

PLR2004 Magic value used in comparison, consider replacing `9.0` with a constant variable
   --> src/srd_builder/parse_monsters.py:420:29
    |
419 |         # Only collect regular text blocks (9.84pt Calibri)
420 |         if text and size >= 9.0 and size <= 10.0 and "Calibri" in font:
    |                             ^^^
421 |             # Clean whitespace: tabs, newlines, carriage returns
422 |             cleaned_text = " ".join(text.split())
    |

PLR2004 Magic value used in comparison, consider replacing `10.0` with a constant variable
   --> src/srd_builder/parse_monsters.py:420:45
    |
419 |         # Only collect regular text blocks (9.84pt Calibri)
420 |         if text and size >= 9.0 and size <= 10.0 and "Calibri" in font:
    |                                             ^^^^
421 |             # Clean whitespace: tabs, newlines, carriage returns
422 |             cleaned_text = " ".join(text.split())
    |

PLR0912 Too many branches (46 > 12)
   --> src/srd_builder/parse_monsters.py:433:5
    |
433 | def parse_monster_from_blocks(monster: dict[str, Any]) -> dict[str, Any]:  # noqa: C901
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^
434 |     """Parse monster fields from blocks array (v0.3.0 extraction format).
    |

PLR0915 Too many statements (159 > 50)
   --> src/srd_builder/parse_monsters.py:433:5
    |
433 | def parse_monster_from_blocks(monster: dict[str, Any]) -> dict[str, Any]:  # noqa: C901
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^
434 |     """Parse monster fields from blocks array (v0.3.0 extraction format).
    |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
   --> src/srd_builder/parse_monsters.py:470:38
    |
468 |         # Size/type/alignment line (Calibri-Italic, right after name)
469 |         # Handle split across multiple Italic blocks (e.g., Kraken, Mummy, Unicorn)
470 |         if "Italic" in font and i <= 2:
    |                                      ^
471 |             # Collect all consecutive Italic blocks (may be split with comma blocks between)
472 |             italic_parts = [text]
    |

PLR2004 Magic value used in comparison, consider replacing `6` with a constant variable
   --> src/srd_builder/parse_monsters.py:514:42
    |
512 |                 # Case 1: Next block is Bold and looks like label continuation (e.g., "Sense" + "s")
513 |                 if "Bold" in peek_font and peek_text and not peek_text[0].isdigit():
514 |                     if len(peek_text) <= 6 and not any(c in peek_text for c in "():,"):
    |                                          ^
515 |                         label_clean += " " + " ".join(peek_text.split()).lower()
516 |                         j += 1
    |

PLR2004 Magic value used in comparison, consider replacing `6` with a constant variable
   --> src/srd_builder/parse_monsters.py:601:45
    |
600 |                     # Safety: stop after collecting reasonable amount (up to 6 blocks for edge cases)
601 |                     if len(values_parts) >= 6:
    |                                             ^
602 |                         break
    |

PLR1714 Consider merging multiple comparisons: `label_clean in {"senses", "sense s"}`.
   --> src/srd_builder/parse_monsters.py:626:16
    |
625 |             # Senses
626 |             if label_clean == "senses" or label_clean == "sense s":
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
627 |                 parsed["senses"] = next_text
628 |                 i = j
    |
help: Merge multiple comparisons

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
   --> src/srd_builder/parse_monsters.py:700:21
    |
699 |     parts = [p.strip() for p in text.split(",")]
700 |     if len(parts) < 2:
    |                     ^
701 |         return {}
    |

PLR2004 Magic value used in comparison, consider replacing `6` with a constant variable
   --> src/srd_builder/parse_monsters.py:730:23
    |
728 |         scores.append(int(match.group(1)))
729 |
730 |     if len(scores) != 6:
    |                       ^
731 |         return {}
    |

PLR0912 Too many branches (15 > 12)
   --> src/srd_builder/parse_monsters.py:743:5
    |
743 | def _parse_traits_and_actions(  # noqa: C901
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^
744 |     blocks: list[dict],
745 | ) -> tuple[list[dict], list[dict], list[dict], list[dict]]:
    |

PLR0915 Too many statements (62 > 50)
   --> src/srd_builder/parse_monsters.py:743:5
    |
743 | def _parse_traits_and_actions(  # noqa: C901
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^
744 |     blocks: list[dict],
745 | ) -> tuple[list[dict], list[dict], list[dict], list[dict]]:
    |

PLR2004 Magic value used in comparison, consider replacing `10.8` with a constant variable
   --> src/srd_builder/parse_monsters.py:775:25
    |
774 |         # Detect section headers
775 |         if font_size >= 10.8 and "bold" in font.lower():
    |                         ^^^^
776 |             if text.lower() == "actions":
777 |                 current_section = "actions"
    |

PLR2004 Magic value used in comparison, consider replacing `9.5` with a constant variable
   --> src/srd_builder/parse_monsters.py:796:26
    |
795 |         is_name_block = (
796 |             font_size >= 9.5
    |                          ^^^
797 |             and text.endswith(".")
798 |             and (is_bold_italic or (is_just_bold and is_legendary_section))
    |

PLR2004 Magic value used in comparison, consider replacing `10.8` with a constant variable
   --> src/srd_builder/parse_monsters.py:822:38
    |
821 |                 # Stop at section header
822 |                 if next_font_size >= 10.8 and "bold" in next_font.lower():
    |                                      ^^^^
823 |                     break
    |

PLR2004 Magic value used in comparison, consider replacing `9.5` with a constant variable
   --> src/srd_builder/parse_monsters.py:826:38
    |
825 |                 # Stop at next BoldItalic name (trait/action)
826 |                 if next_font_size >= 9.5 and next_is_bold_italic and next_text.endswith("."):
    |                                      ^^^
827 |                     break
    |

PLR2004 Magic value used in comparison, consider replacing `9.5` with a constant variable
   --> src/srd_builder/parse_monsters.py:831:39
    |
829 |                 # Stop at next Bold name (legendary action) if in legendary section
830 |                 if (
831 |                     next_font_size >= 9.5
    |                                       ^^^
832 |                     and next_is_just_bold
833 |                     and is_legendary_section
    |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
  --> src/srd_builder/parse_spells.py:50:30
   |
48 |             # Split at the SRD marker - everything after is the description
49 |             parts = re.split(r"System\s+Reference\s+Document\s+5\.1\s+\d+", header_text, maxsplit=1)
50 |             if len(parts) == 2:
   |                              ^
51 |                 header_text = parts[0].strip()
52 |                 extracted_desc = parts[1].strip()
   |

PLC0415 `import` should be at the top-level of a file
   --> src/srd_builder/parse_spells.py:140:5
    |
138 |         Tuple of (level, school)
139 |     """
140 |     import re
    |     ^^^^^^^^^
141 |
142 |     text = level_school_text.lower().strip()
    |

PLC0415 `import` should be at the top-level of a file
   --> src/srd_builder/parse_spells.py:182:5
    |
180 |         Structured range object or string for special cases
181 |     """
182 |     import re
    |     ^^^^^^^^^
183 |
184 |     text_lower = text.lower().strip()
    |

PLC0415 `import` should be at the top-level of a file
   --> src/srd_builder/parse_spells.py:242:5
    |
240 |         Components dict with verbal, somatic, material, material_description
241 |     """
242 |     import re
    |     ^^^^^^^^^
243 |
244 |     components: dict[str, Any] = {
    |

PLC0415 `import` should be at the top-level of a file
   --> src/srd_builder/parse_spells.py:267:5
    |
265 |         Effects dict (may be empty if no extractable effects)
266 |     """
267 |     import re
    |     ^^^^^^^^^
268 |
269 |     effects: dict[str, Any] = {}
    |

PLC0415 `import` should be at the top-level of a file
   --> src/srd_builder/parse_spells.py:345:5
    |
343 |         Scaling dict or None if spell doesn't scale
344 |     """
345 |     import re
    |     ^^^^^^^^^
346 |
347 |     # Check for "At Higher Levels" section (slot scaling)
    |

PLR0911 Too many return statements (8 > 6)
  --> src/srd_builder/parse_tables.py:32:5
   |
32 | def detect_column_type(values: list[Any]) -> str:
   |     ^^^^^^^^^^^^^^^^^^
33 |     """Detect the type of a column based on its values.
   |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
   --> src/srd_builder/parse_tables.py:176:24
    |
174 |     logging.basicConfig(level=logging.INFO, format="%(levelname)s: %(message)s")
175 |
176 |     if len(sys.argv) < 2:
    |                        ^
177 |         print("Usage: python -m srd_builder.parse_tables <raw_tables.json> [output.json]")
178 |         sys.exit(1)
    |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
   --> src/srd_builder/parse_tables.py:181:50
    |
180 |     raw_path = sys.argv[1]
181 |     output_path = sys.argv[2] if len(sys.argv) > 2 else "tables.json"
    |                                                  ^
182 |
183 |     parse_tables(raw_path, output_path)
    |

PLC0415 `import` should be at the top-level of a file
   --> src/srd_builder/postprocess.py:305:5
    |
303 |     action text while preserving original text for fallback.
304 |     """
305 |     from srd_builder.parse_actions import parse_action_fields
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
306 |
307 |     patched = {**monster}
    |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
   --> src/srd_builder/table_indexer.py:150:44
    |
148 |                 rows = table.extract()
149 |
150 |                 if not rows or len(rows) < 2:  # Need at least header + 1 data row
    |                                            ^
151 |                     continue
    |

PLR2004 Magic value used in comparison, consider replacing `18.0` with a constant variable
   --> src/srd_builder/table_indexer.py:208:36
    |
207 |                         # Large headers (18pt+) are usually section markers
208 |                         if size >= 18.0 and len(text) > 3:
    |                                    ^^^^
209 |                             return text
    |

PLR2004 Magic value used in comparison, consider replacing `3` with a constant variable
   --> src/srd_builder/table_indexer.py:208:57
    |
207 |                         # Large headers (18pt+) are usually section markers
208 |                         if size >= 18.0 and len(text) > 3:
    |                                                         ^
209 |                             return text
    |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
   --> src/srd_builder/table_indexer.py:250:27
    |
248 |             # Check if multiple keywords appear in headers
249 |             matches = sum(1 for kw in keywords if kw in header_text)
250 |             if matches >= 2:  # At least 2 keywords match
    |                           ^
251 |                 return table_id
    |

PLC0415 `import` should be at the top-level of a file
   --> src/srd_builder/table_indexer.py:328:17
    |
326 |         try:
327 |             try:
328 |                 from scripts.table_targets import TARGET_TABLES
    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
329 |             except ModuleNotFoundError:
330 |                 import sys
    |

PLC0415 `import` should be at the top-level of a file
   --> src/srd_builder/table_indexer.py:330:17
    |
328 |                 from scripts.table_targets import TARGET_TABLES
329 |             except ModuleNotFoundError:
330 |                 import sys
    |                 ^^^^^^^^^^
331 |                 from pathlib import Path
    |

PLC0415 `import` should be at the top-level of a file
   --> src/srd_builder/table_indexer.py:331:17
    |
329 |             except ModuleNotFoundError:
330 |                 import sys
331 |                 from pathlib import Path
    |                 ^^^^^^^^^^^^^^^^^^^^^^^^
332 |
333 |                 sys.path.insert(0, str(Path(__file__).parent.parent.parent))
    |

PLC0415 `import` should be at the top-level of a file
   --> src/srd_builder/table_indexer.py:334:17
    |
333 |                 sys.path.insert(0, str(Path(__file__).parent.parent.parent))
334 |                 from scripts.table_targets import TARGET_TABLES
    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
335 |
336 |             for target in TARGET_TABLES:
    |

PLC0415 `import` should be at the top-level of a file
   --> src/srd_builder/table_indexer.py:389:9
    |
387 |             output_path: Path for output JSON file
388 |         """
389 |         import json
    |         ^^^^^^^^^^^
390 |
391 |         report = self.generate_report()
    |

PLC0415 `import` should be at the top-level of a file
 --> tests/test_ability_modifiers.py:6:5
  |
4 | def test_add_ability_modifiers_calculates_correctly():
5 |     """Verify D&D 5e modifier formula: (score - 10) // 2."""
6 |     from srd_builder.postprocess import add_ability_modifiers
  |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
7 |
8 |     monster = {
  |

PLR2004 Magic value used in comparison, consider replacing `21` with a constant variable
  --> tests/test_ability_modifiers.py:22:52
   |
20 |     result = add_ability_modifiers(monster)
21 |
22 |     assert result["ability_scores"]["strength"] == 21
   |                                                    ^^
23 |     assert result["ability_scores"]["strength_modifier"] == 5
   |

PLR2004 Magic value used in comparison, consider replacing `5` with a constant variable
  --> tests/test_ability_modifiers.py:23:61
   |
22 |     assert result["ability_scores"]["strength"] == 21
23 |     assert result["ability_scores"]["strength_modifier"] == 5
   |                                                             ^
24 |
25 |     assert result["ability_scores"]["dexterity"] == 10
   |

PLR2004 Magic value used in comparison, consider replacing `10` with a constant variable
  --> tests/test_ability_modifiers.py:25:53
   |
23 |     assert result["ability_scores"]["strength_modifier"] == 5
24 |
25 |     assert result["ability_scores"]["dexterity"] == 10
   |                                                     ^^
26 |     assert result["ability_scores"]["dexterity_modifier"] == 0
   |

PLR2004 Magic value used in comparison, consider replacing `18` with a constant variable
  --> tests/test_ability_modifiers.py:28:56
   |
26 |     assert result["ability_scores"]["dexterity_modifier"] == 0
27 |
28 |     assert result["ability_scores"]["constitution"] == 18
   |                                                        ^^
29 |     assert result["ability_scores"]["constitution_modifier"] == 4
   |

PLR2004 Magic value used in comparison, consider replacing `4` with a constant variable
  --> tests/test_ability_modifiers.py:29:65
   |
28 |     assert result["ability_scores"]["constitution"] == 18
29 |     assert result["ability_scores"]["constitution_modifier"] == 4
   |                                                                 ^
30 |
31 |     assert result["ability_scores"]["intelligence"] == 8
   |

PLR2004 Magic value used in comparison, consider replacing `8` with a constant variable
  --> tests/test_ability_modifiers.py:31:56
   |
29 |     assert result["ability_scores"]["constitution_modifier"] == 4
30 |
31 |     assert result["ability_scores"]["intelligence"] == 8
   |                                                        ^
32 |     assert result["ability_scores"]["intelligence_modifier"] == -1
   |

PLR2004 Magic value used in comparison, consider replacing `13` with a constant variable
  --> tests/test_ability_modifiers.py:34:50
   |
32 |     assert result["ability_scores"]["intelligence_modifier"] == -1
33 |
34 |     assert result["ability_scores"]["wisdom"] == 13
   |                                                  ^^
35 |     assert result["ability_scores"]["wisdom_modifier"] == 1
   |

PLR2004 Magic value used in comparison, consider replacing `6` with a constant variable
  --> tests/test_ability_modifiers.py:37:52
   |
35 |     assert result["ability_scores"]["wisdom_modifier"] == 1
36 |
37 |     assert result["ability_scores"]["charisma"] == 6
   |                                                    ^
38 |     assert result["ability_scores"]["charisma_modifier"] == -2
   |

PLR2004 Magic value used in comparison, consider replacing `-2` with a constant variable
  --> tests/test_ability_modifiers.py:38:61
   |
37 |     assert result["ability_scores"]["charisma"] == 6
38 |     assert result["ability_scores"]["charisma_modifier"] == -2
   |                                                             ^^
   |

PLC0415 `import` should be at the top-level of a file
  --> tests/test_ability_modifiers.py:43:5
   |
41 | def test_add_ability_modifiers_handles_missing_scores():
42 |     """Handle monsters with no ability scores."""
43 |     from srd_builder.postprocess import add_ability_modifiers
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
44 |
45 |     monster = {"name": "Test", "ability_scores": {}}
   |

PLC0415 `import` should be at the top-level of a file
  --> tests/test_ability_modifiers.py:56:5
   |
54 | def test_add_ability_modifiers_handles_partial_scores():
55 |     """Handle monsters with only some ability scores."""
56 |     from srd_builder.postprocess import add_ability_modifiers
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
57 |
58 |     monster = {
   |

PLR2004 Magic value used in comparison, consider replacing `16` with a constant variable
  --> tests/test_ability_modifiers.py:68:52
   |
66 |     result = add_ability_modifiers(monster)
67 |
68 |     assert result["ability_scores"]["strength"] == 16
   |                                                    ^^
69 |     assert result["ability_scores"]["strength_modifier"] == 3
70 |     assert result["ability_scores"]["intelligence"] == 3
   |

PLR2004 Magic value used in comparison, consider replacing `3` with a constant variable
  --> tests/test_ability_modifiers.py:69:61
   |
68 |     assert result["ability_scores"]["strength"] == 16
69 |     assert result["ability_scores"]["strength_modifier"] == 3
   |                                                             ^
70 |     assert result["ability_scores"]["intelligence"] == 3
71 |     assert result["ability_scores"]["intelligence_modifier"] == -4
   |

PLR2004 Magic value used in comparison, consider replacing `3` with a constant variable
  --> tests/test_ability_modifiers.py:70:56
   |
68 |     assert result["ability_scores"]["strength"] == 16
69 |     assert result["ability_scores"]["strength_modifier"] == 3
70 |     assert result["ability_scores"]["intelligence"] == 3
   |                                                        ^
71 |     assert result["ability_scores"]["intelligence_modifier"] == -4
72 |     assert "dexterity_modifier" not in result["ability_scores"]
   |

PLR2004 Magic value used in comparison, consider replacing `-4` with a constant variable
  --> tests/test_ability_modifiers.py:71:65
   |
69 |     assert result["ability_scores"]["strength_modifier"] == 3
70 |     assert result["ability_scores"]["intelligence"] == 3
71 |     assert result["ability_scores"]["intelligence_modifier"] == -4
   |                                                                 ^^
72 |     assert "dexterity_modifier" not in result["ability_scores"]
   |

PLC0415 `import` should be at the top-level of a file
  --> tests/test_ability_modifiers.py:77:5
   |
75 | def test_add_ability_modifiers_in_pipeline():
76 |     """Verify modifiers are added during clean_monster_record."""
77 |     from srd_builder.postprocess import clean_monster_record
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
78 |
79 |     monster = {
   |

PLR2004 Magic value used in comparison, consider replacing `14` with a constant variable
   --> tests/test_ability_modifiers.py:99:52
    |
 98 |     # Verify original scores preserved
 99 |     assert result["ability_scores"]["strength"] == 14
    |                                                    ^^
100 |     assert result["ability_scores"]["wisdom"] == 8
    |

PLR2004 Magic value used in comparison, consider replacing `8` with a constant variable
   --> tests/test_ability_modifiers.py:100:50
    |
 98 |     # Verify original scores preserved
 99 |     assert result["ability_scores"]["strength"] == 14
100 |     assert result["ability_scores"]["wisdom"] == 8
    |                                                  ^
101 |
102 |     # Verify modifiers calculated
    |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
   --> tests/test_ability_modifiers.py:103:61
    |
102 |     # Verify modifiers calculated
103 |     assert result["ability_scores"]["strength_modifier"] == 2
    |                                                             ^
104 |     assert result["ability_scores"]["dexterity_modifier"] == 1
105 |     assert result["ability_scores"]["constitution_modifier"] == 3
    |

PLR2004 Magic value used in comparison, consider replacing `3` with a constant variable
   --> tests/test_ability_modifiers.py:105:65
    |
103 |     assert result["ability_scores"]["strength_modifier"] == 2
104 |     assert result["ability_scores"]["dexterity_modifier"] == 1
105 |     assert result["ability_scores"]["constitution_modifier"] == 3
    |                                                                 ^
106 |     assert result["ability_scores"]["intelligence_modifier"] == 0
107 |     assert result["ability_scores"]["wisdom_modifier"] == -1
    |

PLR2004 Magic value used in comparison, consider replacing `-2` with a constant variable
   --> tests/test_ability_modifiers.py:108:61
    |
106 |     assert result["ability_scores"]["intelligence_modifier"] == 0
107 |     assert result["ability_scores"]["wisdom_modifier"] == -1
108 |     assert result["ability_scores"]["charisma_modifier"] == -2
    |                                                             ^^
    |

PLC0415 `import` should be at the top-level of a file
   --> tests/test_ability_modifiers.py:113:5
    |
111 | def test_ability_modifiers_edge_cases():
112 |     """Test edge cases for ability scores."""
113 |     from srd_builder.postprocess import add_ability_modifiers
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
114 |
115 |     # Score of 1 (common for constructs' mental stats)
    |

PLR2004 Magic value used in comparison, consider replacing `-5` with a constant variable
   --> tests/test_ability_modifiers.py:118:65
    |
116 |     monster = {"ability_scores": {"intelligence": 1}}  # -5
117 |     result = add_ability_modifiers(monster)
118 |     assert result["ability_scores"]["intelligence_modifier"] == -5
    |                                                                 ^^
119 |
120 |     # Score of 30 (legendary creatures)
    |

PLR2004 Magic value used in comparison, consider replacing `10` with a constant variable
   --> tests/test_ability_modifiers.py:123:61
    |
121 |     monster = {"ability_scores": {"strength": 30}}  # +10
122 |     result = add_ability_modifiers(monster)
123 |     assert result["ability_scores"]["strength_modifier"] == 10
    |                                                             ^^
124 |
125 |     # Odd scores
    |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
   --> tests/test_ability_modifiers.py:128:62
    |
126 |     monster = {"ability_scores": {"dexterity": 15}}  # +2
127 |     result = add_ability_modifiers(monster)
128 |     assert result["ability_scores"]["dexterity_modifier"] == 2
    |                                                              ^
    |

PLR0915 Too many statements (57 > 50)
  --> tests/test_build_pipeline.py:11:5
   |
11 | def test_build_pipeline(tmp_path, monkeypatch):
   |     ^^^^^^^^^^^^^^^^^^^
12 |     class _DummyValidator:
13 |         def __init__(self, _schema):
   |

PLC0415 `import` should be at the top-level of a file
  --> tests/test_build_pipeline.py:21:5
   |
19 |     monkeypatch.setattr(jsonschema, "Draft202012Validator", _DummyValidator)
20 |
21 |     from srd_builder import validate as validate_module
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
22 |
23 |     ruleset = "srd_5_1"
   |

PLC0415 `import` should be at the top-level of a file
  --> tests/test_build_pipeline.py:41:5
   |
40 |     # Mock extract_monsters to avoid PDF parsing issues with fake PDF
41 |     from srd_builder import build as build_module
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
42 |
43 |     def mock_extract_monsters(_pdf_path):
   |

PLR2004 Magic value used in comparison, consider replacing `63` with a constant variable
  --> tests/test_context_tracker.py:21:40
   |
20 |     assert tracker.current() == {"category": "armor", "subcategory": "medium"}
21 |     assert tracker.history[-1].page == 63
   |                                        ^^
22 |     assert tracker.history[-1].subcategory == "medium"
   |

PLR2004 Magic value used in comparison, consider replacing `296` with a constant variable
  --> tests/test_extract_basic.py:31:33
   |
29 | def test_extraction_completeness(monsters_raw):
30 |     """Verify we extract the expected number of monsters."""
31 |     assert len(monsters_raw) == 296, f"Expected 296 monsters, got {len(monsters_raw)}"
   |                                 ^^^
   |

PLR2004 Magic value used in comparison, consider replacing `5` with a constant variable
  --> tests/test_extract_basic.py:81:31
   |
79 |     # Find Bold blocks (stat labels like "Armor Class", "Hit Points")
80 |     bold_blocks = [b for b in goblin["blocks"] if "Bold" in b.get("font", "")]
81 |     assert len(bold_blocks) > 5, "Goblin should have multiple Bold blocks for stat labels"
   |                               ^
82 |
83 |     # Find Italic blocks (size/type/alignment line)
   |

PLR2004 Magic value used in comparison, consider replacing `261` with a constant variable
   --> tests/test_extract_basic.py:110:20
    |
109 |         for page in pages:
110 |             assert 261 <= page <= 394, f"{name}: page {page} outside SRD monster section (261-394)"
    |                    ^^^
    |

PLR2004 Magic value used in comparison, consider replacing `394` with a constant variable
   --> tests/test_extract_basic.py:110:35
    |
109 |         for page in pages:
110 |             assert 261 <= page <= 394, f"{name}: page {page} outside SRD monster section (261-394)"
    |                                   ^^^
    |

PLR2004 Magic value used in comparison, consider replacing `0.05` with a constant variable
   --> tests/test_extract_basic.py:122:24
    |
120 |     warning_rate = len(monsters_with_warnings) / len(monsters_raw)
121 |     assert (
122 |         warning_rate < 0.05
    |                        ^^^^
123 |     ), f"Too many monsters with warnings: {len(monsters_with_warnings)}/296 ({warning_rate:.1%})"
    |

PLR2004 Magic value used in comparison, consider replacing `10` with a constant variable
   --> tests/test_extract_basic.py:130:31
    |
128 |     for name, monster in list(monsters_raw.items())[:50]:  # Sample 50 monsters
129 |         block_count = len(monster.get("blocks", []))
130 |         assert block_count >= 10, f"{name}: too few blocks ({block_count}), stat block incomplete?"
    |                               ^^
131 |         assert block_count <= 500, f"{name}: too many blocks ({block_count}), extraction error?"
    |

PLR2004 Magic value used in comparison, consider replacing `500` with a constant variable
   --> tests/test_extract_basic.py:131:31
    |
129 |         block_count = len(monster.get("blocks", []))
130 |         assert block_count >= 10, f"{name}: too few blocks ({block_count}), stat block incomplete?"
131 |         assert block_count <= 500, f"{name}: too many blocks ({block_count}), extraction error?"
    |                               ^^^
    |

PLR2004 Magic value used in comparison, consider replacing `8` with a constant variable
   --> tests/test_extract_basic.py:145:17
    |
143 |         if size > 0:  # Skip blocks without size info
144 |             assert (
145 |                 8 <= size <= 14
    |                 ^
146 |             ), f"Goblin block has unusual font size: {size}pt (text: {block.get('text', '')[:50]})"
    |

PLR2004 Magic value used in comparison, consider replacing `14` with a constant variable
   --> tests/test_extract_basic.py:145:30
    |
143 |         if size > 0:  # Skip blocks without size info
144 |             assert (
145 |                 8 <= size <= 14
    |                              ^^
146 |             ), f"Goblin block has unusual font size: {size}pt (text: {block.get('text', '')[:50]})"
    |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
  --> tests/test_extract_cross_page.py:38:34
   |
37 |     # Must span multiple pages
38 |     assert len(deva["pages"]) >= 2, f"Deva should span 2+ pages, got {deva['pages']}"
   |                                  ^
39 |     assert 261 in deva["pages"], "Deva should include page 261"
40 |     assert 262 in deva["pages"], "Deva should include page 262"
   |

PLR2004 Magic value used in comparison, consider replacing `261` with a constant variable
  --> tests/test_extract_cross_page.py:39:12
   |
37 |     # Must span multiple pages
38 |     assert len(deva["pages"]) >= 2, f"Deva should span 2+ pages, got {deva['pages']}"
39 |     assert 261 in deva["pages"], "Deva should include page 261"
   |            ^^^
40 |     assert 262 in deva["pages"], "Deva should include page 262"
   |

PLR2004 Magic value used in comparison, consider replacing `262` with a constant variable
  --> tests/test_extract_cross_page.py:40:12
   |
38 |     assert len(deva["pages"]) >= 2, f"Deva should span 2+ pages, got {deva['pages']}"
39 |     assert 261 in deva["pages"], "Deva should include page 261"
40 |     assert 262 in deva["pages"], "Deva should include page 262"
   |            ^^^
41 |
42 |     # Must have complete stat block (70+ blocks)
   |

PLR2004 Magic value used in comparison, consider replacing `70` with a constant variable
  --> tests/test_extract_cross_page.py:45:24
   |
43 |     block_count = len(deva["blocks"])
44 |     assert (
45 |         block_count >= 70
   |                        ^^
46 |     ), f"Deva should have 70+ blocks for complete stat block, got {block_count}"
   |

PLR2004 Magic value used in comparison, consider replacing `70` with a constant variable
  --> tests/test_extract_cross_page.py:67:24
   |
65 |     block_count = len(solar["blocks"])
66 |     assert (
67 |         block_count >= 70
   |                        ^^
68 |     ), f"Solar should have 70+ blocks for complete stat block, got {block_count}"
   |

PLR2004 Magic value used in comparison, consider replacing `70` with a constant variable
  --> tests/test_extract_cross_page.py:86:27
   |
84 |     # Must have substantial block count
85 |     block_count = len(planetar["blocks"])
86 |     assert block_count >= 70, f"Planetar should have 70+ blocks, got {block_count}"
   |                           ^^
   |

PLR2004 Magic value used in comparison, consider replacing `20` with a constant variable
   --> tests/test_extract_cross_page.py:99:26
    |
 97 |     for name, monster in monsters_raw.items():
 98 |         block_count = len(monster["blocks"])
 99 |         if block_count < 20:
    |                          ^^
100 |             too_short.append((name, block_count))
    |

PLR2004 Magic value used in comparison, consider replacing `30` with a constant variable
   --> tests/test_extract_cross_page.py:124:31
    |
122 |     for name, monster in cross_page_monsters:
123 |         block_count = len(monster["blocks"])
124 |         assert block_count >= 30, (
    |                               ^^
125 |             f"{name} spans pages {monster['pages']} but only has {block_count} blocks - "
126 |             "possible extraction truncation"
    |

PLR2004 Magic value used in comparison, consider replacing `296` with a constant variable
   --> tests/test_extract_cross_page.py:144:33
    |
142 | def test_extraction_coverage(monsters_raw):
143 |     """Verify we extracted all 296 expected monsters."""
144 |     assert len(monsters_raw) == 296, f"Expected 296 monsters, got {len(monsters_raw)}"
    |                                 ^^^
    |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
   --> tests/test_extract_cross_page.py:188:27
    |
186 |         for i in range(len(pages) - 1):
187 |             gap = pages[i + 1] - pages[i]
188 |             assert gap <= 2, (
    |                           ^
189 |                 f"{name} has suspicious page gap: {pages} "
190 |                 f"(gap of {gap} between pages {pages[i]} and {pages[i+1]})"
    |

PLC0415 `import` should be at the top-level of a file
 --> tests/test_indexer.py:2:5
  |
1 | def test_build_monster_index():
2 |     from srd_builder.indexer import build_monster_index
  |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
3 |
4 |     mons = [
  |

PLC0415 `import` should be at the top-level of a file
 --> tests/test_parse_actions.py:6:5
  |
4 | def test_parse_melee_weapon_attack():
5 |     """Parse typical melee weapon attack."""
6 |     from srd_builder.parse_actions import parse_action_fields
  |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
7 |
8 |     action = {
  |

PLR2004 Magic value used in comparison, consider replacing `7` with a constant variable
  --> tests/test_parse_actions.py:16:32
   |
15 |     assert result["attack_type"] == "melee_weapon"
16 |     assert result["to_hit"] == 7
   |                                ^
17 |     assert result["reach"] == 5
18 |     assert result["damage"] == {
   |

PLR2004 Magic value used in comparison, consider replacing `5` with a constant variable
  --> tests/test_parse_actions.py:17:31
   |
15 |     assert result["attack_type"] == "melee_weapon"
16 |     assert result["to_hit"] == 7
17 |     assert result["reach"] == 5
   |                               ^
18 |     assert result["damage"] == {
19 |         "average": 17,
   |

PLC0415 `import` should be at the top-level of a file
  --> tests/test_parse_actions.py:28:5
   |
26 | def test_parse_ranged_weapon_attack():
27 |     """Parse ranged weapon attack with range."""
28 |     from srd_builder.parse_actions import parse_action_fields
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
29 |
30 |     action = {
   |

PLR2004 Magic value used in comparison, consider replacing `4` with a constant variable
  --> tests/test_parse_actions.py:38:32
   |
37 |     assert result["attack_type"] == "ranged_weapon"
38 |     assert result["to_hit"] == 4
   |                                ^
39 |     assert result["range"] == {"normal": 150, "long": 600}
40 |     assert result["damage"] == {
   |

PLC0415 `import` should be at the top-level of a file
  --> tests/test_parse_actions.py:50:5
   |
48 | def test_parse_action_with_saving_throw():
49 |     """Parse action with DC saving throw."""
50 |     from srd_builder.parse_actions import parse_action_fields
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
51 |
52 |     action = {
   |

PLC0415 `import` should be at the top-level of a file
  --> tests/test_parse_actions.py:72:5
   |
70 | def test_parse_action_multiple_damage_types():
71 |     """Parse action with multiple damage instances."""
72 |     from srd_builder.parse_actions import parse_action_fields
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
73 |
74 |     action = {
   |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
  --> tests/test_parse_actions.py:87:45
   |
85 |     }
86 |     assert "damage_options" in result
87 |     assert len(result["damage_options"]) == 2
   |                                             ^
88 |     assert result["damage_options"][1] == {
89 |         "average": 3,
   |

PLC0415 `import` should be at the top-level of a file
  --> tests/test_parse_actions.py:97:5
   |
95 | def test_parse_melee_spell_attack():
96 |     """Parse melee spell attack."""
97 |     from srd_builder.parse_actions import parse_action_fields
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
98 |
99 |     action = {
   |

PLR2004 Magic value used in comparison, consider replacing `5` with a constant variable
   --> tests/test_parse_actions.py:107:32
    |
106 |     assert result["attack_type"] == "melee_spell"
107 |     assert result["to_hit"] == 5
    |                                ^
108 |     assert result["reach"] == 5
    |

PLR2004 Magic value used in comparison, consider replacing `5` with a constant variable
   --> tests/test_parse_actions.py:108:31
    |
106 |     assert result["attack_type"] == "melee_spell"
107 |     assert result["to_hit"] == 5
108 |     assert result["reach"] == 5
    |                               ^
    |

PLC0415 `import` should be at the top-level of a file
   --> tests/test_parse_actions.py:113:5
    |
111 | def test_parse_ranged_spell_attack():
112 |     """Parse ranged spell attack."""
113 |     from srd_builder.parse_actions import parse_action_fields
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
114 |
115 |     action = {
    |

PLR2004 Magic value used in comparison, consider replacing `7` with a constant variable
   --> tests/test_parse_actions.py:123:32
    |
122 |     assert result["attack_type"] == "ranged_spell"
123 |     assert result["to_hit"] == 7
    |                                ^
124 |     assert result["range"] == {"normal": 120, "long": 480}
    |

PLC0415 `import` should be at the top-level of a file
   --> tests/test_parse_actions.py:129:5
    |
127 | def test_parse_negative_to_hit():
128 |     """Parse action with negative to-hit modifier."""
129 |     from srd_builder.parse_actions import parse_action_fields
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
130 |
131 |     action = {
    |

PLC0415 `import` should be at the top-level of a file
   --> tests/test_parse_actions.py:144:5
    |
142 | def test_parse_action_without_attack():
143 |     """Non-attack actions should not be parsed."""
144 |     from srd_builder.parse_actions import parse_action_fields
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
145 |
146 |     action = {
    |

PLC0415 `import` should be at the top-level of a file
   --> tests/test_parse_actions.py:161:5
    |
159 | def test_parse_action_preserves_all_fields():
160 |     """Parsing should add fields without removing existing ones."""
161 |     from srd_builder.parse_actions import parse_action_fields
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
162 |
163 |     action = {
    |

PLR2004 Magic value used in comparison, consider replacing `10` with a constant variable
   --> tests/test_parse_actions.py:176:32
    |
174 |     assert result["custom_field"] == "should be preserved"
175 |     assert result["attack_type"] == "melee_weapon"
176 |     assert result["to_hit"] == 10
    |                                ^^
    |

PLC0415 `import` should be at the top-level of a file
   --> tests/test_parse_actions.py:181:5
    |
179 | def test_parse_action_in_pipeline():
180 |     """Test action parsing integrated into clean_monster_record."""
181 |     from srd_builder.postprocess import clean_monster_record
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
182 |
183 |     monster = {
    |

PLR2004 Magic value used in comparison, consider replacing `5` with a constant variable
   --> tests/test_parse_actions.py:205:32
    |
203 |     action = result["actions"][0]
204 |     assert action["attack_type"] == "melee_weapon"
205 |     assert action["to_hit"] == 5
    |                                ^
206 |     assert action["reach"] == 5
207 |     assert action["damage"]["dice"] == "1d8+3"
    |

PLR2004 Magic value used in comparison, consider replacing `5` with a constant variable
   --> tests/test_parse_actions.py:206:31
    |
204 |     assert action["attack_type"] == "melee_weapon"
205 |     assert action["to_hit"] == 5
206 |     assert action["reach"] == 5
    |                               ^
207 |     assert action["damage"]["dice"] == "1d8+3"
208 |     assert action["damage"]["type"] == "bludgeoning"
    |

PLC0415 `import` should be at the top-level of a file
   --> tests/test_parse_actions.py:213:5
    |
211 | def test_parse_legendary_actions():
212 |     """Test action parsing applies to legendary actions."""
213 |     from srd_builder.postprocess import clean_monster_record
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
214 |
215 |     monster = {
    |

PLR2004 Magic value used in comparison, consider replacing `15` with a constant variable
   --> tests/test_parse_actions.py:236:35
    |
234 |     legendary = result["legendary_actions"][0]
235 |     assert legendary["attack_type"] == "melee_weapon"
236 |     assert legendary["to_hit"] == 15
    |                                   ^^
237 |     assert legendary["reach"] == 20
    |

PLR2004 Magic value used in comparison, consider replacing `20` with a constant variable
   --> tests/test_parse_actions.py:237:34
    |
235 |     assert legendary["attack_type"] == "melee_weapon"
236 |     assert legendary["to_hit"] == 15
237 |     assert legendary["reach"] == 20
    |                                  ^^
    |

PLC0415 `import` should be at the top-level of a file
   --> tests/test_parse_actions.py:242:5
    |
240 | def test_parse_reactions():
241 |     """Test action parsing applies to reactions."""
242 |     from srd_builder.postprocess import clean_monster_record
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
243 |
244 |     monster = {
    |

PLR2004 Magic value used in comparison, consider replacing `8` with a constant variable
   --> tests/test_parse_actions.py:265:34
    |
263 |     reaction = result["reactions"][0]
264 |     assert reaction["attack_type"] == "melee_weapon"
265 |     assert reaction["to_hit"] == 8
    |                                  ^
    |

PLC0415 `import` should be at the top-level of a file
   --> tests/test_parse_actions.py:270:5
    |
268 | def test_parse_constitution_saving_throw():
269 |     """Test full ability name expansion from short form."""
270 |     from srd_builder.parse_actions import parse_action_fields
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
271 |
272 |     action = {
    |

PLC0415 `import` should be at the top-level of a file
   --> tests/test_parse_actions.py:287:5
    |
285 | def test_parse_damage_without_spacing():
286 |     """Test damage parsing handles various spacing."""
287 |     from srd_builder.parse_actions import parse_action_fields
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
288 |
289 |     # Compact formatting
    |

PLR2004 Magic value used in comparison, consider replacing `13` with a constant variable
  --> tests/test_parse_equipment.py:37:36
   |
35 |         "max_bonus": 2,
36 |     }
37 |     assert item["strength_req"] == 13
   |                                    ^^
38 |     assert item["stealth_disadvantage"] is True
39 |     assert item["weight_lb"] == 40.0
   |

PLR2004 Magic value used in comparison, consider replacing `40.0` with a constant variable
  --> tests/test_parse_equipment.py:39:33
   |
37 |     assert item["strength_req"] == 13
38 |     assert item["stealth_disadvantage"] is True
39 |     assert item["weight_lb"] == 40.0
   |                                 ^^^^
40 |     assert item["weight_raw"] == "40 lb."
41 |     assert item["cost"] == {"amount": 50, "currency": "gp"}
   |

PLR2004 Magic value used in comparison, consider replacing `3.0` with a constant variable
   --> tests/test_parse_equipment.py:108:33
    |
106 |     assert item["weapon_type"] == "melee"
107 |     assert item["sub_category"] == "martial_melee"
108 |     assert item["weight_lb"] == 3.0
    |                                 ^^^
109 |     assert item["weight_raw"] == "3 lb."
    |

PLR2004 Magic value used in comparison, consider replacing `0.5` with a constant variable
   --> tests/test_parse_equipment.py:122:33
    |
120 |     item = parse_equipment_records([raw_item])[0]
121 |
122 |     assert item["weight_lb"] == 0.5
    |                                 ^^^
123 |     assert item["weight_raw"] == "1/2 lb."
124 |     assert item["cost"] == {"amount": 25, "currency": "gp"}
    |

PLR2004 Magic value used in comparison, consider replacing `3` with a constant variable
   --> tests/test_parse_spells.py:108:36
    |
106 |     assert result is not None
107 |     assert result["type"] == "slot"
108 |     assert result["base_level"] == 3
    |                                    ^
109 |     assert "1d6" in result["formula"]
    |

PLC0415 `import` should be at the top-level of a file
 --> tests/test_postprocess.py:2:5
  |
1 | def test_clean_monster_record_basic():
2 |     from srd_builder.postprocess import clean_monster_record
  |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
3 |
4 |     m = {
  |

PLC0415 `import` should be at the top-level of a file
 --> tests/test_postprocess_cr.py:2:5
  |
1 | def test_standardize_challenge_handles_strings_and_fractions():
2 |     from srd_builder.postprocess import standardize_challenge
  |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
3 |
4 |     monster = {"challenge_rating": "1/2"}
  |

PLR2004 Magic value used in comparison, consider replacing `0.5` with a constant variable
 --> tests/test_postprocess_cr.py:5:66
  |
4 |     monster = {"challenge_rating": "1/2"}
5 |     assert standardize_challenge(monster)["challenge_rating"] == 0.5
  |                                                                  ^^^
6 |
7 |     monster = {"challenge_rating": "10"}
  |

PLR2004 Magic value used in comparison, consider replacing `10` with a constant variable
  --> tests/test_postprocess_cr.py:8:66
   |
 7 |     monster = {"challenge_rating": "10"}
 8 |     assert standardize_challenge(monster)["challenge_rating"] == 10
   |                                                                  ^^
 9 |
10 |     monster = {"challenge_rating": 3.0}
   |

PLR2004 Magic value used in comparison, consider replacing `3` with a constant variable
  --> tests/test_postprocess_cr.py:11:66
   |
10 |     monster = {"challenge_rating": 3.0}
11 |     assert standardize_challenge(monster)["challenge_rating"] == 3
   |                                                                  ^
   |

PLC0415 `import` should be at the top-level of a file
 --> tests/test_postprocess_defenses.py:2:5
  |
1 | def test_structure_defenses_normalizes_strings():
2 |     from srd_builder.postprocess import structure_defenses
  |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
3 |
4 |     monster = {
  |

PLR2004 Magic value used in comparison, consider replacing `0.5` with a constant variable
  --> tests/test_postprocess_functions.py:76:66
   |
74 | def test_standardize_challenge_handles_fraction_and_numeric() -> None:
75 |     monster: dict[str, Any] = {"challenge_rating": "1/2"}
76 |     assert standardize_challenge(monster)["challenge_rating"] == 0.5
   |                                                                  ^^^
77 |
78 |     monster = {"challenge_rating": "5"}
   |

PLR2004 Magic value used in comparison, consider replacing `5` with a constant variable
  --> tests/test_postprocess_functions.py:79:66
   |
78 |     monster = {"challenge_rating": "5"}
79 |     assert standardize_challenge(monster)["challenge_rating"] == 5
   |                                                                  ^
80 |
81 |     monster = {"challenge_rating": 7.0}
   |

PLR2004 Magic value used in comparison, consider replacing `7` with a constant variable
  --> tests/test_postprocess_functions.py:82:66
   |
81 |     monster = {"challenge_rating": 7.0}
82 |     assert standardize_challenge(monster)["challenge_rating"] == 7
   |                                                                  ^
   |

PLC0415 `import` should be at the top-level of a file
 --> tests/test_postprocess_ids.py:2:5
  |
1 | def test_unify_simple_name_updates_monster_and_children():
2 |     from srd_builder.postprocess import unify_simple_name
  |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
3 |
4 |     monster = {
  |

PLC0415 `import` should be at the top-level of a file
 --> tests/test_postprocess_legendary.py:2:5
  |
1 |   def test_split_legendary_moves_actions():
2 | /     from srd_builder.postprocess import (
3 | |         polish_text_fields,
4 | |         rename_abilities_to_traits,
5 | |         split_legendary,
6 | |     )
  | |_____^
7 |
8 |       monster = {
  |

PLC0415 `import` should be at the top-level of a file
 --> tests/test_postprocess_text.py:2:5
  |
1 | def test_polish_text_fields_cleans_boilerplate_and_spacing():
2 |     from srd_builder.postprocess import polish_text_fields
  |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
3 |
4 |     monster = {
  |

PLR2004 Magic value used in comparison, consider replacing `3` with a constant variable
  --> tests/test_schema_versions.py:30:30
   |
28 |         # Version should be semantic versioning format (e.g., "1.1.0")
29 |         parts = schema["version"].split(".")
30 |         assert len(parts) == 3, f"{schema_file.name} version must be MAJOR.MINOR.PATCH format"
   |                              ^
31 |         assert all(p.isdigit() for p in parts), f"{schema_file.name} version parts must be numeric"
   |

PLR2004 Magic value used in comparison, consider replacing `3` with a constant variable
   --> tests/test_schema_versions.py:99:26
    |
 97 |     version = meta["$schema_version"]
 98 |     parts = version.split(".")
 99 |     assert len(parts) == 3, "$schema_version must be MAJOR.MINOR.PATCH format"
    |                          ^
100 |     assert all(p.isdigit() for p in parts), "$schema_version parts must be numeric"
    |

PLR2004 Magic value used in comparison, consider replacing `6` with a constant variable
  --> tests/test_validate_monsters.py:84:42
   |
82 |     # Check that some categories pass
83 |     assert results["Giants"]["complete"] is True
84 |     assert results["Giants"]["found"] == 6
   |                                          ^
85 |     assert results["Giants"]["missing"] == []
   |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
   --> tests/test_validate_monsters.py:101:42
    |
 99 |     results = validate_category_completeness(incomplete)
100 |     assert results["Giants"]["complete"] is False
101 |     assert results["Giants"]["found"] == 2
    |                                          ^
102 |     assert len(results["Giants"]["missing"]) == 4
    |

PLR2004 Magic value used in comparison, consider replacing `4` with a constant variable
   --> tests/test_validate_monsters.py:102:49
    |
100 |     assert results["Giants"]["complete"] is False
101 |     assert results["Giants"]["found"] == 2
102 |     assert len(results["Giants"]["missing"]) == 4
    |                                                 ^
    |

PLR2004 Magic value used in comparison, consider replacing `295` with a constant variable
   --> tests/test_validate_monsters.py:111:31
    |
109 |     result = validate_monster_count(monsters)
110 |
111 |     assert result["count"] == 295
    |                               ^^^
112 |     assert result["in_range"] is True
    |

PLR2004 Magic value used in comparison, consider replacing `100` with a constant variable
   --> tests/test_validate_monsters.py:121:31
    |
119 |     result = validate_monster_count(monsters)
120 |
121 |     assert result["count"] == 100
    |                               ^^^
122 |     assert result["in_range"] is False
    |

PLR2004 Magic value used in comparison, consider replacing `3` with a constant variable
   --> tests/test_validate_monsters.py:135:31
    |
134 |     assert result["all_unique"] is True
135 |     assert result["total"] == 3
    |                               ^
136 |     assert result["unique"] == 3
137 |     assert result["duplicates"] == {}
    |

PLR2004 Magic value used in comparison, consider replacing `3` with a constant variable
   --> tests/test_validate_monsters.py:136:32
    |
134 |     assert result["all_unique"] is True
135 |     assert result["total"] == 3
136 |     assert result["unique"] == 3
    |                                ^
137 |     assert result["duplicates"] == {}
    |

PLR2004 Magic value used in comparison, consider replacing `3` with a constant variable
   --> tests/test_validate_monsters.py:150:31
    |
149 |     assert result["all_unique"] is False
150 |     assert result["total"] == 3
    |                               ^
151 |     assert result["unique"] == 2
152 |     assert result["duplicates"] == {"Dragon": 2}
    |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
   --> tests/test_validate_monsters.py:151:32
    |
149 |     assert result["all_unique"] is False
150 |     assert result["total"] == 3
151 |     assert result["unique"] == 2
    |                                ^
152 |     assert result["duplicates"] == {"Dragon": 2}
    |

PLR2004 Magic value used in comparison, consider replacing `2` with a constant variable
   --> tests/test_validate_monsters.py:165:27
    |
163 |     result = validate_alphabetic_coverage(monsters)
164 |
165 |     assert result["A"] == 2
    |                           ^
166 |     assert result["B"] == 1
167 |     assert result["G"] == 1
    |

Found 232 errors.
No fixes available (2 hidden fixes can be enabled with the `--unsafe-fixes` option).
Error: Process completed with exit code 1.
0s
