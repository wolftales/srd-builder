# Release Notes: v0.19.1 - Equipment v2.0.0

**Release Date:** 2025-12-23
**Schema Version:** 2.0.0 (equipment only)
**Status:** ‚ö†Ô∏è Breaking Changes - No Backward Compatibility

---

## Overview

v0.19.1 implements **equipment v2.0.0 schema** following the same structural patterns established in v0.19.0 for monsters. This release updates the equipment dataset to align with the hybrid flat+nested approach used across all v2.0.0 schemas.

**Scope:** This release updates **equipment only**. Other datasets will be updated in subsequent v0.19.x releases:
- v0.19.0 - Monsters v2.0.0 ‚úÖ
- v0.19.1 - Equipment v2.0.0 ‚úÖ
- v0.19.2 - Spells v2.0.0 (planned)
- v0.19.3 - Classes v2.0.0 (planned)

---

## Breaking Changes

### ‚ùå Removed Fields
- **`summary`** - Removed from schema (was never populated in equipment dataset)

### üÜï New Fields

#### damage.type_id
Added cross-reference identifier for damage types in weapon damage objects:

```json
// BEFORE (v1.4.0)
{
  "damage": {
    "dice": "1d8",
    "type": "slashing"
  }
}

// AFTER (v2.0.0)
{
  "damage": {
    "dice": "1d8",
    "type": "slashing",
    "type_id": "slashing"
  }
}
```

**Required Field:** All weapons with damage now include `type_id` matching their damage type.

**Purpose:** Enables cross-referencing with damage type datasets and filtering by damage type ID.

---

## Schema Changes

### Version Updates
- **Schema version:** 1.4.0 ‚Üí 2.0.0
- **last_modified:** 2025-11-03 ‚Üí 2025-12-23

### Field Structure
Equipment already used clean field names (`dice`/`type` not `damage_dice`/`damage_type`), so no field name changes were needed. The primary change is adding the `type_id` cross-reference field to damage objects.

### Existing Nested Structures (Unchanged)
These structures were already in v1.4.0 and remain the same:
- **cost:** `{amount, currency}`
- **armor_class:** `{base, dex_bonus?, max_bonus?}`
- **range:** `{normal, long?}`
- **versatile_damage:** `{dice}`

---

## Migration Guide

### Code Changes Required

#### 1. Update Damage Object Expectations

**Old code (v1.4.0):**
```python
weapon = {
    "damage": {
        "dice": "2d6",
        "type": "slashing"
    }
}

# Accessing damage type
damage_type = weapon["damage"]["type"]
```

**New code (v2.0.0):**
```python
weapon = {
    "damage": {
        "dice": "2d6",
        "type": "slashing",
        "type_id": "slashing"  # NEW: cross-reference ID
    }
}

# Accessing damage type (unchanged)
damage_type = weapon["damage"]["type"]

# NEW: Use type_id for filtering/cross-referencing
damage_type_id = weapon["damage"]["type_id"]
```

#### 2. Schema Validation

Update any custom validation code to expect `type_id` in damage objects:

```python
# NEW: type_id is required in damage objects
if "damage" in item:
    assert "type_id" in item["damage"]
```

### Data Migration

**Summary field:** If your code checks for `summary` field, remove those checks - field never contained data.

**damage.type_id:** Add this field to all weapons with damage using the damage type in lowercase.

---

## Testing

All tests passing:
- **188 tests passed** (unchanged from v0.19.0)
- **19 tests skipped** (unchanged from v0.19.0)
- **Equipment tests:** 5/5 passing
  - test_parse_equipment.py: All unit tests updated
  - test_golden_equipment.py: Fixture regenerated with v2.0.0 structure

**Code quality:**
- ‚úÖ All ruff checks passed
- ‚úÖ All pre-commit hooks passed
- ‚úÖ Schema validation passed for all 111 equipment items

---

## Datasets

### Equipment
- **Total items:** 111 equipment items
- **Items with damage:** 37 weapons
- **Schema version:** 2.0.0
- **File size:** ~45KB (unchanged)

### Changes
1. All weapon damage objects now include `type_id` field
2. Schema version bumped to 2.0.0
3. Summary field removed from schema definition

---

## Upgrade Checklist

For consumers upgrading from v1.4.0 to v2.0.0:

- [ ] Update code expecting damage structure to handle `type_id` field
- [ ] Remove any code checking for `summary` field (was never populated)
- [ ] Update schema validation to v2.0.0
- [ ] Test weapon parsing/filtering with new type_id field
- [ ] Verify any damage type cross-referencing logic uses type_id

---

## Related Releases

- **v0.19.0** - Monsters v2.0.0 (2025-12-23)
- **v0.19.2** - Spells v2.0.0 (planned)
- **v0.19.3** - Classes v2.0.0 (planned)

---

## Technical Details

### Parser Changes
- **src/srd_builder/parse/parse_equipment.py:** Updated `_parse_damage()` to add `type_id` field

### Schema Changes
- **schemas/equipment.schema.json:**
  - Version: 1.4.0 ‚Üí 2.0.0
  - last_modified: 2025-11-03 ‚Üí 2025-12-23
  - Removed: `summary` field definition
  - Updated: `damage` object requires `type_id` field

### Test Updates
- **tests/test_parse_equipment.py:** Updated damage expectations to include `type_id`
- **tests/fixtures/srd_5_1/normalized/equipment.json:** Regenerated with v2.0.0 structure

### Build Output
- **dist/srd_5_1/equipment.json:** Rebuilt with v2.0.0 schema
- All 111 items validated against schema v2.0.0

---

## Breaking Change Summary

| Change | Type | Impact |
|--------|------|--------|
| `damage.type_id` added | New required field | Medium - affects all weapon damage objects |
| `summary` removed from schema | Field removal | Low - field was never populated |
| Schema version ‚Üí 2.0.0 | Version bump | Low - metadata change only |

**Migration Effort:** Low (1-2 hours)
- Most code unchanged (field names already clean)
- Main change: handle new `type_id` field in damage objects
- Summary field removal has no impact (never used)
