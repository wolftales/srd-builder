# Release v0.19.4 - Schema v2.0.0 (Remaining Datasets)

**Release Date:** December 23, 2025
**Package Version:** 0.19.4
**Breaking Changes:** Yes (schema version 2.0.0 for 8 datasets)

## Overview

This release completes the v2.0.0 schema migration by updating the remaining 8 datasets that were not covered in v0.19.0-v0.19.3. All 13 datasets in srd-builder now use schema v2.0.0, establishing a stable baseline for future development.

## Datasets Updated

### v2.0.0 Schema Migration (8 datasets)

1. **Conditions** (15 items) - v1.4.0 → v2.0.0
2. **Diseases** (3 items) - v1.4.0 → v2.0.0
3. **Features** (246 items) - v1.4.0 → v2.0.0
4. **Lineages** (13 items) - v1.4.0 → v2.0.0
5. **Magic Items** (240 items) - v1.1.0 → v2.0.0
6. **Poisons** (14 items) - v1.4.0 → v2.0.0
7. **Rules** (172 items) - v1.3.0 → v2.0.0
8. **Tables** (38 items) - v1.4.0 → v2.0.0

**Total:** 741 items across 8 datasets

## Breaking Changes

All 8 datasets now conform to the v2.0.0 schema standard:

### Removed Fields
- **`summary`** - Removed from all datasets (unused field eliminated)
  - Affected: conditions, diseases, features, magic_items, poisons, rules, tables
  - Note: lineages never had summary field

### Added Fields
- **`damage.type_id`** - Added cross-reference IDs to damage objects
  - Affected: poisons (7 items with damage)
  - Format: `"type_id": "damage_type:poison"`
  - Enables cross-referencing to damage type definitions

### Metadata Updates
- Schema version: `2.0.0` for all 8 datasets
- Last modified: `2025-12-23`

## Dataset Details

### Conditions (15 items)
Standard game conditions from Appendix PH-A: Blinded, Charmed, Deafened, Exhaustion, Frightened, Grappled, Incapacitated, Invisible, Paralyzed, Petrified, Poisoned, Prone, Restrained, Stunned, Unconscious.

**Changes:**
- Removed unused `summary` field
- Updated to schema v2.0.0

### Diseases (3 items)
Diseases with transmission, effects, and recovery mechanics: Cackle Fever, Sewer Plague, Sight Rot.

**Changes:**
- Removed unused `summary` field
- Updated to schema v2.0.0

### Features (246 items)
Class features and lineage traits (154 class + 92 lineage).

**Changes:**
- Removed unused `summary` field
- Updated to schema v2.0.0

### Lineages (13 items)
Character races/ancestries: Dwarf, Hill Dwarf, Elf, High Elf, Halfling, Lightfoot Halfling, Human, Dragonborn, Gnome, Rock Gnome, and others.

**Changes:**
- Updated to schema v2.0.0
- No summary field to remove (never had one)

**Note:** Lineages represent character ancestries/races, distinct from classes (Barbarian, Fighter, etc.).

### Magic Items (240 items)
Magic items from SRD 5.1 with types, rarity, attunement requirements, and descriptions.

**Changes:**
- Removed unused `summary` field
- Updated from v1.1.0 → v2.0.0 (largest version jump)

### Poisons (14 items)
Poisons with application methods, effects, costs, and saving throws: Assassin's Blood, Burnt Othur Fumes, Crawler Mucus, Drow Poison, Essence of Ether, Malice, Midnight Tears, Oil of Taggit, Pale Tincture, Purple Worm Poison, Serpent Venom, Torpor, Truth Serum, Wyvern Poison.

**Changes:**
- Removed unused `summary` field
- **Added `damage.type_id`** to 7 poisons with damage
- Updated to schema v2.0.0

**Damage Updates:**
7 poisons now include cross-reference IDs:
```json
"damage": {
  "average": 10,
  "formula": "3d6",
  "type": "poison",
  "type_id": "damage_type:poison"  // NEW
}
```

### Rules (172 items)
Game rules and mechanics from SRD 5.1 chapters.

**Changes:**
- Removed unused `summary` field
- Updated from v1.3.0 → v2.0.0

### Tables (38 items)
Reference tables (experience by CR, spell slots, proficiency bonus, etc.).

**Changes:**
- Removed unused `summary` field
- Updated to schema v2.0.0

## Migration Impact

### v0.19 Series Summary
The complete v0.19 series (v0.19.0 through v0.19.4) migrated **ALL 13 datasets** to schema v2.0.0:

| Release | Datasets | Items | Total |
|---------|----------|-------|-------|
| v0.19.0 | Monsters | 317 | 317 |
| v0.19.1 | Equipment | 111 | 111 |
| v0.19.2 | Spells | 319 | 319 |
| v0.19.3 | Classes | 12 | 12 |
| v0.19.4 | Conditions, Diseases, Features, Lineages, Magic Items, Poisons, Rules, Tables | 741 | 741 |
| **Total** | **13 datasets** | **1,500 items** | **1,500** |

### Schema Consistency
- All 13 datasets now at schema v2.0.0
- Consistent cross-referencing patterns (type_id fields)
- No unused fields (summary eliminated)
- Stable baseline for v0.20.0+ development

## Technical Notes

### Poison Data Sources
Poisons combine data from two sources:
1. **Table data** (pages 204-205): Type, price from reference table
2. **Manual descriptions**: Effects, saves, damage (PDF text corrupted, manually transcribed)

The damage `type_id` field was added to manual poison descriptions and flows through the build pipeline.

### Extraction Metadata
Updated schema versions in `extraction_metadata.py` for:
- conditions, diseases (prose datasets)
- poison_descriptions, equipment_descriptions (prose extraction for merging)

These prose datasets use the same schema version as their corresponding final datasets for consistency.

## Testing

- ✅ 188 tests passing
- ✅ 19 tests skipped
- ✅ All ruff checks passing
- ✅ All fixtures regenerated with v2.0.0
- ✅ Schema validation passing

## Files Changed

### Schemas
- `schemas/condition.schema.json` - v1.4.0 → v2.0.0
- `schemas/disease.schema.json` - v1.4.0 → v2.0.0
- `schemas/features.schema.json` - v1.4.0 → v2.0.0
- `schemas/lineage.schema.json` - v1.4.0 → v2.0.0
- `schemas/magic_item.schema.json` - v1.1.0 → v2.0.0
- `schemas/poison.schema.json` - v1.4.0 → v2.0.0 (+ damage.type_id)
- `schemas/rule.schema.json` - v1.3.0 → v2.0.0
- `schemas/table.schema.json` - v1.4.0 → v2.0.0

### Parsers
- `src/srd_builder/parse/parse_poisons.py` - Removed summary generation, added type_id to damage

### Data
- `src/srd_builder/data/poison_descriptions_manual.py` - Added type_id to all damage objects

### Extraction Configuration
- `src/srd_builder/extraction/extraction_metadata.py` - Updated schema versions for prose datasets

### Fixtures
All 8 dataset fixtures regenerated:
- `tests/fixtures/srd_5_1/normalized/conditions.json`
- `tests/fixtures/srd_5_1/normalized/diseases.json`
- `tests/fixtures/srd_5_1/normalized/features.json`
- `tests/fixtures/srd_5_1/normalized/lineages.json`
- `tests/fixtures/srd_5_1/normalized/magic_items.json`
- `tests/fixtures/srd_5_1/normalized/poisons.json`
- `tests/fixtures/srd_5_1/normalized/rules.json`
- `tests/fixtures/srd_5_1/normalized/tables.json`

## Upgrade Guide

### For Consumers

All datasets now follow consistent v2.0.0 patterns:

1. **No more `summary` fields** - Use `description` or `text` instead
2. **Cross-references use `type_id`** - Damage objects now include `damage.type_id` for linking to damage type definitions
3. **Version checking** - Check `_meta.schema_version` to ensure compatibility

Example poison damage before/after:
```json
// v1.4.0
"damage": {
  "average": 10,
  "formula": "3d6",
  "type": "poison"
}

// v2.0.0
"damage": {
  "average": 10,
  "formula": "3d6",
  "type": "poison",
  "type_id": "damage_type:poison"
}
```

### For Contributors

- All schemas now at v2.0.0
- Summary field eliminated project-wide
- Damage objects require type_id when present
- Fixtures automatically regenerated via `scripts/bump_version.py`

## Next Steps

With all 13 datasets at v2.0.0:
- v0.20.0+: Focus on feature additions, not schema migrations
- Consider merging equipment_descriptions/poison_descriptions into parent datasets (future enhancement)
- Stable baseline enables engine/consumer development

## Acknowledgments

This release completes the comprehensive v2.0.0 migration started in v0.19.0, bringing all 1,500 items across 13 datasets to a consistent, modern schema baseline.
