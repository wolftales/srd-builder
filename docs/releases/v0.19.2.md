# Release Notes: v0.19.2 - Spells v2.0.0

**Release Date:** 2025-12-23
**Schema Version:** 2.0.0 (spells only)
**Status:** ‚ö†Ô∏è Breaking Changes - No Backward Compatibility

---

## Overview

v0.19.2 implements **spells v2.0.0 schema** following the same structural patterns established in v0.19.0 (monsters) and v0.19.1 (equipment). This release updates the spells dataset to align with the hybrid flat+nested approach used across all v2.0.0 schemas.

**Scope:** This release updates **spells only**. Other datasets will be updated in subsequent v0.19.x releases:
- v0.19.0 - Monsters v2.0.0 ‚úÖ
- v0.19.1 - Equipment v2.0.0 ‚úÖ
- v0.19.2 - Spells v2.0.0 ‚úÖ
- v0.19.3 - Classes v2.0.0 (planned)

---

## Breaking Changes

### ‚ùå Removed Fields
- **`summary`** - Removed from schema (was never populated in spells dataset)

### üÜï New Fields

#### effects.damage.type_id
Added cross-reference identifier for damage types in spell damage objects:

```json
// BEFORE (v1.5.0)
{
  "effects": {
    "damage": {
      "dice": "8d6",
      "type": "fire"
    }
  }
}

// AFTER (v2.0.0)
{
  "effects": {
    "damage": {
      "dice": "8d6",
      "type": "fire",
      "type_id": "fire"
    }
  }
}
```

**Required Field:** All spells with damage now include `type_id` in the damage object.

**Purpose:** Enables cross-referencing with damage type datasets and filtering by damage type ID, consistent with monsters and equipment.

---

## Schema Changes

### Version Updates
- **Schema version:** 1.5.0 ‚Üí 2.0.0
- **last_modified:** 2025-01-28 ‚Üí 2025-12-23

### Field Structure
Spells already used clean, nested field names, so no structural changes were needed beyond adding `type_id`. The schema maintains the sophisticated nested structure for:
- **casting:** `{time, range: {type, distance?, area?}, ritual}`
- **duration:** `{requires_concentration, length}`
- **components:** `{verbal, somatic, material, material_description?}`
- **effects:** `{damage?, healing?, save?, attack?, area?, conditions?}`
- **scaling:** `{type, base_level?, formula}`

---

## Migration Guide

### Code Changes Required

#### 1. Update Damage Object Expectations

**Old code (v1.5.0):**
```python
spell = {
    "effects": {
        "damage": {
            "dice": "8d6",
            "type": "fire"
        }
    }
}

# Accessing damage type
damage_type = spell["effects"]["damage"]["type"]
```

**New code (v2.0.0):**
```python
spell = {
    "effects": {
        "damage": {
            "dice": "8d6",
            "type": "fire",
            "type_id": "fire"  # NEW: cross-reference ID
        }
    }
}

# Accessing damage type (unchanged)
damage_type = spell["effects"]["damage"]["type"]

# NEW: Use type_id for filtering/cross-referencing
damage_type_id = spell["effects"]["damage"]["type_id"]
```

#### 2. Schema Validation

Update any custom validation code to expect `type_id` in damage objects:

```python
# NEW: type_id is required in damage objects
if "effects" in spell and "damage" in spell["effects"]:
    assert "type_id" in spell["effects"]["damage"]
```

### Data Migration

**Summary field:** If your code checks for `summary` field, remove those checks - field never contained data.

**damage.type_id:** Add this field to all spells with damage using the damage type in lowercase.

---

## Testing

All tests passing:
- **188 tests passed** (unchanged from v0.19.0/v0.19.1)
- **19 tests skipped** (unchanged from v0.19.0/v0.19.1)
- **Spell tests:** 31/31 passing
  - test_parse_spells.py: All unit tests passing
  - test_golden_spells.py: Fixture regenerated with v2.0.0 structure

**Code quality:**
- ‚úÖ All ruff checks passed
- ‚úÖ All pre-commit hooks passed
- ‚úÖ Schema validation passed for all 319 spells

---

## Datasets

### Spells
- **Total items:** 319 spells
- **Spells with damage:** ~150 spells
- **Schema version:** 2.0.0
- **File size:** ~860KB (unchanged)

### Changes
1. All spell damage objects now include `type_id` field
2. Schema version bumped to 2.0.0
3. Summary field removed from schema definition

---

## Upgrade Checklist

For consumers upgrading from v1.5.0 to v2.0.0:

- [ ] Update code expecting damage structure to handle `type_id` field
- [ ] Remove any code checking for `summary` field (was never populated)
- [ ] Update schema validation to v2.0.0
- [ ] Test spell parsing/filtering with new type_id field
- [ ] Verify any damage type cross-referencing logic uses type_id

---

## Related Releases

- **v0.19.0** - Monsters v2.0.0 (2025-12-23)
- **v0.19.1** - Equipment v2.0.0 (2025-12-23)
- **v0.19.3** - Classes v2.0.0 (planned)

---

## Technical Details

### Parser Changes
- **src/srd_builder/parse/parse_spells.py:** Updated `_extract_damage()` to add `type_id` field

### Schema Changes
- **schemas/spell.schema.json:**
  - Version: 1.5.0 ‚Üí 2.0.0
  - last_modified: 2025-01-28 ‚Üí 2025-12-23
  - Removed: `summary` field definition
  - Updated: `effects.damage` object requires `type_id` field

### Test Updates
- **tests/fixtures/srd_5_1/normalized/spells.json:** Regenerated with v2.0.0 structure

### Build Output
- **dist/srd_5_1/spells.json:** Rebuilt with v2.0.0 schema
- All 319 spells validated against schema v2.0.0

---

## Breaking Change Summary

| Change | Type | Impact |
|--------|------|--------|
| `effects.damage.type_id` added | New required field | Medium - affects all spell damage objects |
| `summary` removed from schema | Field removal | Low - field was never populated |
| Schema version ‚Üí 2.0.0 | Version bump | Low - metadata change only |

**Migration Effort:** Low (1-2 hours)
- Most code unchanged (existing nested structure preserved)
- Main change: handle new `type_id` field in damage objects
- Summary field removal has no impact (never used)

---

## v0.19 Series Progress

**Completed:**
- ‚úÖ v0.19.0 - Monsters v2.0.0 (317 monsters)
  - Nested ability_scores {value, modifier}
  - Simplified field names (dice/type)
  - Pure hit_dice format
  - Cross-reference IDs

- ‚úÖ v0.19.1 - Equipment v2.0.0 (111 items)
  - damage.type_id cross-reference
  - Summary field removed

- ‚úÖ v0.19.2 - Spells v2.0.0 (319 spells)
  - effects.damage.type_id cross-reference
  - Summary field removed

**Planned:**
- ‚è≥ v0.19.3 - Classes v2.0.0
  - Cross-reference IDs for features, spells
  - Structured progression tables
  - Consistent nested objects

All v2.0.0 schemas follow the same patterns:
- Hybrid flat+nested structure for complex fields
- Cross-reference IDs (type_id, etc.)
- Clean field names without redundant prefixes
- No summary fields (unused metadata removed)
