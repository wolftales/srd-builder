# v0.18.1 Release Notes — Critical Spell Bug Fix

**Status:** ✅ Complete
**Released:** December 22, 2024

## Overview
Fixed critical bug where 5 spells were missing descriptions due to PDF page boundaries. Also enhanced equipment pack tests and improved automation tooling.

## Critical Fixes

### Spell Description Bug ✅ FIXED
**Issue:** 5 spells had empty description arrays:
- Branding Smite
- Blinding Smite
- Staggering Smite
- Banishing Smite
- Astral Projection

**Root Cause:** PDF text extraction stopped at page boundaries. When spell descriptions started on one page and continued on the next, only the first page was captured. If the first page had no description text (only name/metadata), the description would be empty.

**Solution:** Implemented cross-page carry-over in [src/srd_builder/extract/extract_spells.py](../../src/srd_builder/extract/extract_spells.py)
- Added `_build_cross_page_index()` to map spells spanning pages
- Added `_get_next_page_text()` to capture continuation text
- Modified `extract_spell_blocks()` to stitch cross-page descriptions
- All 5 spells now have complete descriptions

**Commits:**
- 921ba06: Initial fix (added cross-page detection)
- 89ebb88: Enhanced fix (improved page boundary handling)

### Equipment Pack Integrity ✅ ENHANCED
**Added Tests:** 5 new test cases in [tests/test_golden_equipment.py](../../tests/test_golden_equipment.py)
1. Pack integrity (all items valid)
2. Pack uniqueness (no duplicate pack IDs)
3. Bundle validation (all bundle items exist)
4. Cost consistency (pack cost matches individual items)
5. Container validation (all containers have proper capacity)

**Commits:**
- a4b2860: Added comprehensive equipment pack tests

## Tooling Improvements

### Version Automation ✅ COMPLETE
**Issue:** `scripts/bump_version.py` only regenerated 3 of 12 dataset fixtures (monsters, equipment, spells), forcing manual updates for the 9 datasets added in v0.18.0.

**Solution:** Updated [scripts/bump_version.py](../../scripts/bump_version.py) to regenerate all 12 datasets:
- Added: classes, conditions, diseases, features, lineages, magic_items, poisons, rules, tables
- Fixed output_key for features dataset (uses 'features', not 'items')
- Simplified configuration using lambda-based process functions
- Updated commit message template to list all 12 fixtures

**Commits:**
- cd027a3: FIX: Update bump_version.py to regenerate all 12 dataset fixtures

## Breaking Changes
(None - all changes backward compatible)

## Testing Status
- Local: All 180+ tests passing
- CI: All tests passing
- Pre-commit hooks: Passing
- Linting: ruff format + ruff check passing

## Files Changed
- src/srd_builder/extract/extract_spells.py (spell bug fix)
- tests/test_golden_equipment.py (pack integrity tests)
- scripts/bump_version.py (automation improvements)
- All 12 dataset fixtures (version bump to v0.18.1)

## Validation Checklist
- ✅ All 5 broken spells now have descriptions
- ✅ Equipment pack tests passing
- ✅ Version automation regenerates all 12 fixtures
- ✅ All tests passing (180+ tests)
- ✅ Linting passing (ruff format + check)
- ✅ Pre-commit hooks passing
- ✅ Schema validation passing
- ✅ Golden tests matching normalized fixtures
